/*
 * Amplify Store - Persistent Client-Side Storage @VERSION
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */
(function(a,g){var b=a.store=function(i,k,e,j){var j=b.type;if(e&&e.type&&e.type in b.types){j=e.type}return b.types[j](i,k,e||{})};b.types={};b.type=null;b.addType=function(e,i){if(!b.type){b.type=e}b.types[e]=i;b[e]=function(k,l,j){j=j||{};j.type=e;return b(k,l,j)}};b.error=function(){return"amplify.store quota exceeded"};var h=/^__amplify__/;function d(e,i){b.addType(e,function(r,q,s){var k,p,l,m,n=q,j=(new Date()).getTime();if(!r){n={};m=[];l=0;try{r=i.length;while(r=i.key(l++)){if(h.test(r)){p=JSON.parse(i.getItem(r));if(p.expires&&p.expires<=j){m.push(r)}else{n[r.replace(h,"")]=p.data}}}while(r=m.pop()){i.removeItem(r)}}catch(o){}return n}r="__amplify__"+r;if(q===g){k=i.getItem(r);p=k?JSON.parse(k):{expires:-1};if(p.expires&&p.expires<=j){i.removeItem(r)}else{return p.data}}else{if(q===null){i.removeItem(r)}else{p=JSON.stringify({data:q,expires:s.expires?j+s.expires:null});try{i.setItem(r,p)}catch(o){b[e]();try{i.setItem(r,p)}catch(o){throw b.error()}}}}return n})}for(var c in {localStorage:1,sessionStorage:1}){try{if(window[c].getItem){d(c,window[c])}}catch(f){}}if(window.globalStorage){try{d("globalStorage",window.globalStorage[window.location.hostname]);if(b.type==="sessionStorage"){b.type="globalStorage"}}catch(f){}}(function(){if(b.types.localStorage){return}var i=document.createElement("div"),e="amplify";i.style.display="none";document.getElementsByTagName("head")[0].appendChild(i);if(i.addBehavior){i.addBehavior("#default#userdata");b.addType("userData",function(s,r,t){i.load(e);var o,q,m,k,l,n=r,j=(new Date()).getTime();if(!s){n={};l=[];k=0;while(o=i.XMLDocument.documentElement.attributes[k++]){q=JSON.parse(o.value);if(q.expires&&q.expires<=j){l.push(o.name)}else{n[o.name]=q.data}}while(s=l.pop()){i.removeAttribute(s)}i.save(e);return n}s=s.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(r===g){o=i.getAttribute(s);q=o?JSON.parse(o):{expires:-1};if(q.expires&&q.expires<=j){i.removeAttribute(s)}else{return q.data}}else{if(r===null){i.removeAttribute(s)}else{m=i.getAttribute(s);q=JSON.stringify({data:r,expires:(t.expires?(j+t.expires):null)});i.setAttribute(s,q)}}try{i.save(e)}catch(p){if(m===null){i.removeAttribute(s)}else{i.setAttribute(s,m)}b.userData();try{i.setAttribute(s,q);i.save(e)}catch(p){if(m===null){i.removeAttribute(s)}else{i.setAttribute(s,m)}throw b.error()}}return n})}}());(function(){var i={};function e(j){return j===g?g:JSON.parse(JSON.stringify(j))}b.addType("memory",function(k,l,j){if(!k){return e(i)}if(l===g){return e(i[k])}if(l===null){delete i[k];return null}i[k]=l;if(j.expires){setTimeout(function(){delete i[k]},j.expires)}return l})}())}(this.amplify=this.amplify||{}));