Ext.define("Ozone.data.Dashboard",{extend:"Ext.data.Model",idProperty:"guid",fields:["alteredByAdmin","guid",{name:"id",mapping:"guid"},{name:"isdefault",type:"boolean",defaultValue:false},{name:"dashboardPosition",type:"int"},"EDashboardLayoutList","name",{name:"state",defaultValue:[]},"removed","groups","isGroupDashboard","description","createdDate","prettyCreatedDate","editedDate","prettyEditedDate",{name:"stack",defaultValue:null},{name:"locked",type:"boolean",defaultValue:false},{name:"layoutConfig",defaultValue:null},{name:"createdBy",model:"User"},{name:"user",model:"User"}],constructor:function(b,c,a){if(b.layoutConfig&&typeof b.layoutConfig==="string"&&b.layoutConfig!==Object.prototype.toString()){b.layoutConfig=Ext.JSON.decode(b.layoutConfig)}if(b.layoutConfig===Object.prototype.toString()){b.layoutConfig=""}if(!b.guid){b.guid=guid.util.guid()}this.callParent(arguments)}});Ext.define("Ozone.data.stores.AdminDashboardStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Dashboard",alias:"store.admindashboardstore",remoteSort:true,totalProperty:"results",sorters:[{property:"dashboardPosition",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/dashboard",create:"/dashboard",update:"/dashboard",destroy:"/dashboard"},reader:{root:"data"},writer:{root:"data"}});this.callParent(arguments)},reorder:function(){if(this.getCount()>0){for(var b=0;b<this.getCount();b++){var a=this.getAt(b);a.set("dashboardPosition",b+1)}}}});Ext.define("Ozone.data.Group",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"name",type:"string"},{name:"id",type:"int"},{name:"description",type:"string"},{name:"totalWidgets",type:"int"},{name:"totalUsers",type:"int"},{name:"totalStacks",type:"int"},{name:"automatic",type:"boolean"},{name:"stackDefault",type:"boolean"},{name:"status",type:"string"},{name:"displayName",type:"string"},{name:"email",type:"string"},{name:"title",mapping:"displayName"}]});Ext.define("Ozone.data.GroupStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Group",sorters:[{property:"displayName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/group",create:"/group",update:"/group",destroy:"/group"},fields:["id","name","description","totalWidgets","totalUsers","totalStacks","automatic","stackDefault","status","displayName","email"],autoDestroy:true});this.callParent(arguments)}});Ext.define("Ozone.data.User",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id"},{name:"username"},{name:"userRealName"},{name:"email"},{name:"totalGroups"},{name:"totalWidgets"},{name:"totalDashboards"},{name:"totalStacks"},{name:"lastLogin"},{name:"title",mapping:"userRealName"}]});Ext.define("Ozone.data.UserStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.User",alias:"store.userstore",sorters:[{property:"userRealName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/user",create:"/user",update:"/user",destroy:"/user"},fields:["id","username","userRealName","email","totalWidgets","totalGroups","totalDashboards","lastLogin"],autoDestroy:true});Ozone.data.UserStore.superclass.constructor.call(this,a)}});Ext.define("Ozone.data.Stack",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id",type:"int",defaultValue:-1},{name:"name",type:"string"},{name:"description",type:"string"},{name:"stackContext",type:"string"},{name:"descriptorUrl",type:"string"},{name:"totalDashboards",type:"int"},{name:"totalUsers",type:"int"},{name:"totalGroups",type:"int"},{name:"totalWidgets",type:"int"}]});Ext.define("Ozone.data.StackStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Stack",sorters:[{property:"name",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/stack",create:"/stack",update:"/stack",destroy:"/stack"},fields:["id","name","description","stackContext","descriptorUrl","totalDashboards","totalUsers","totalGroups","totalWidgets"],autoDestroy:true});this.callParent(arguments)}});Ext.define("Ozone.data.WidgetDefinition",{extend:"Ext.data.Model",idProperty:"widgetGuid",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"value.namespace"},{name:"originalName",mapping:"value.originalName"},{name:"version",mapping:"value.widgetVersion"},{name:"description",mapping:"value.description"},{name:"url",mapping:"value.url"},{name:"headerIcon",mapping:"value.headerIcon"},{name:"image",mapping:"value.image"},{name:"width",mapping:"value.width"},{name:"height",mapping:"value.height"},{name:"widgetGuid",mapping:"path"},{name:"universalName",mapping:"value.universalName"},{name:"maximized",mapping:"value.maximized"},{name:"minimized",mapping:"value.minimized"},{name:"x",mapping:"value.x"},{name:"y",mapping:"value.y"},{name:"visible",mapping:"value.visible"},{name:"definitionVisible",mapping:"value.definitionVisible"},{name:"background",mapping:"value.background"},{name:"disabled",mapping:"value.disabled"},{name:"editable",mapping:"value.editable"},{name:"tags",mapping:"value.tags"},{name:"singleton",mapping:"value.singleton"},{name:"allRequired",mapping:"value.allRequired"},{name:"directRequired",mapping:"value.directRequired"},{name:"userId",mapping:"value.userId"},{name:"userRealName",mapping:"value.userRealName"},{name:"totalUsers",mapping:"value.totalUsers"},{name:"totalGroups",mapping:"value.totalGroups"},{name:"widgetTypes",mapping:"value.widgetTypes"},{name:"descriptorUrl",mapping:"value.descriptorUrl"},{name:"intents",mapping:"value.intents"},{name:"title",mapping:"value.namespace"},{name:"groups",mapping:"value.groups"},{name:"disabled",mapping:"value.disabled"}]});Ext.define("Ozone.data.stores.AdminWidgetStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.WidgetDefinition",alias:"store.adminwidgetstore",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/widget",create:"/widget",update:"/widget",destroy:"/widget"}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.grid.DashboardsGrid",{extend:"Ext.grid.Panel",alias:["widget.dashboardsgrid"],quickSearchFields:["name"],plugins:new Ozone.components.focusable.FocusableGridPanel(),mixins:["Ozone.components.WidgetAlerts"],cls:"grid-dashboard",defaultPageSize:50,forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"admindashboardstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"guid",header:"GUID",dataIndex:"guid",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"name",header:"Dashboard Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(j,b,d,g,e,k,h){var i=j;var a=d.get("EDashboardLayoutList");var c=d.get("layout");var f="grid-dashboard-default-icon-layout";return'<p class="grid-dashboard-title '+f+'">'+Ext.htmlEncode(i)+"</p>"}},{itemId:"widgets",header:"Widgets",dataIndex:"layoutConfig",width:250,sortable:false,renderer:function(g,a,c,e,d,h,f){var b=0;if(g){var i=function(k){if(!k||!k.items){return}if(k.items.length===0){if(k.widgets&&k.widgets.length>0){b+=k.widgets.length}}else{for(var l=0,j=k.items.length;l<j;l++){i(k.items[l])}}return b};b=i(g)}return'<div class="grid-text grid-dashboard-widget-count">'+b+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"dashboard-grid-paging"})]});this.callParent(arguments)},getSelectedDashboards:function(){return this.getSelectionModel().getSelection()},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},doMoveRow:function(h){var g=this.getSelectedDashboards();if(g&&g.length>0){var c=this.store;g.sort(function(j,i){return j.get("dashboardPosition")-i.get("dashboardPosition")});if("up"===h){var f=1;for(var e=0;e<g.length;e++){if(g[e].get("dashboardPosition")===f){f++}else{var a=g[e].get("dashboardPosition"),d=a-1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==d){i.set("dashboardPosition",a)}else{if(j==a){i.set("dashboardPosition",d)}}}})}}}else{var b=c.getCount();for(var e=g.length-1;e>=0;e--){if(g[e].get("dashboardPosition")===b){b--}else{var a=g[e].get("dashboardPosition"),d=a+1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==a){i.set("dashboardPosition",d)}else{if(j==d){i.set("dashboardPosition",a)}}}})}}}if(c.getUpdatedRecords().length){c.sync();c.on("write",function(){this.refresh()},this,{single:true});c.on("load",function(l,k,n,j){for(var m=0;m<g.length;m++){this.getSelectionModel().select(l.indexOfId(g[m].get("id")),true)}},this,{single:true})}}else{this.showAlert("Error","You must select at least one dashboard to move.")}}});Ext.define("Ozone.components.admin.StacksGrid",{extend:"Ext.grid.Panel",alias:["widget.stacksgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-stack",title:"Stacks",columns:[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"Title",dataIndex:"name",flex:8,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"URL Name",dataIndex:"stackContext",flex:4,hidden:true,renderer:function(e,b,a,f,d,c){return Ext.htmlEncode(e)}},{header:"Dashboards",dataIndex:"totalDashboards",flex:3,sortable:false},{header:"Widgets",dataIndex:"totalWidgets",flex:3,sortable:false},{header:"Groups",dataIndex:"totalGroups",flex:3,sortable:false},{header:"Users",dataIndex:"totalUsers",flex:3,sortable:false}],defaultPageSize:50,multiSelect:true,initComponent:function(){Ext.apply(this,{columnLines:true});this.store=Ext.create("Ozone.data.StackStore",{id:"stackstore",autoLoad:false,pageSize:this.defaultPageSize});this.bbar=Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",store:this.store,pageSize:this.pageSize,displayInfo:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.pageSize}})},clearFilter:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)}});Ext.define("Ozone.components.UsersGrid",{extend:"Ext.grid.Panel",alias:["widget.usersgrid","widget.Ozone.components.UsersGrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),store:null,baseParams:{},quickSearchFields:["userRealName","username","email"],showHeaderBar:true,viewConfig:{forceFit:true},defaultPageSize:50,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"userstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}this.columns=[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"User Name",dataIndex:"username",flex:2,sortable:true,editable:false,hidden:true,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"Full Name",dataIndex:"userRealName",flex:2,sortable:true,editable:false,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"Last Sign In",dataIndex:"lastLogin",flex:2,sortable:true,editable:false,renderer:function(a){return a?Ext.Date.format(new Date(a),"m-d-Y H:i"):""}},{header:"Groups",dataIndex:"totalGroups",flex:1,sortable:false,editable:false},{header:"Widgets",dataIndex:"totalWidgets",flex:1,sortable:false,editable:false},{header:"Dashboards",dataIndex:"totalDashboards",flex:1,sortable:false,editable:false},{header:"Stacks",dataIndex:"totalStacks",flex:1,sortable:false,editable:false}];Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",dock:"bottom",store:this.store,pageSize:this.pageSize,displayInfo:true,hidden:this.hidePagingToolbar})],columnLines:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},applyFilter:function(d,a){this.store.proxy.extraParams={};Ext.apply(this.store.proxy.extraParams,this.baseParams);if(!Ext.isEmpty(d)){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}Ext.apply(this.store.proxy.extraParams,{filters:Ext.JSON.encode(c),filterOperator:"OR"})}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]}});Ext.define("Ozone.components.admin.grid.WidgetsGrid",{extend:"Ext.grid.Panel",alias:["widget.widgetsgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-widget",defaultPageSize:50,forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"adminwidgetstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"universalName",header:"Universal Name",dataIndex:"universalName",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f?Ext.htmlEncode(f):"</div>"}},{itemId:"widgetGuid",header:"GUID",dataIndex:"widgetGuid",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"name",header:"Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(m,b,f,j,g,n,k){var l=m;var a=f.get("headerIcon");var d=Ozone.util.contextPath();if(!a.match(new RegExp("^/?"+d+"/.*$","i"))&&!a.match(new RegExp("^https?://.*","i"))){if(a.indexOf("/")==0){a=d+a}else{a=d+"/"+a}var i=/admin\/64x64_blue_dashboard.png/g;var h=/admin\/64x64_blue_group.png/g;var e=/admin\/64x64_blue_user.png/g;var o=/admin\/64x64_blue_widget.png/g;if(a.match(i)){a=a.replace(i,"admin/24x24_blue_dashboard.png")}else{if(a.match(h)){a=a.replace(h,"admin/24x24_blue_group.png")}else{if(a.match(e)){a=a.replace(e,"admin/24x24_blue_user.png")}else{if(a.match(o)){a=a.replace(o,"admin/24x24_blue_widget.png")}}}}}var c='<div class="grid-icon-and-text-title-box"><div class="grid-icon-and-text-icon"><img class="grid-icon-and-text-icon-image" src="'+Ext.htmlEncode(a)+'">';c+="</div>";c+='<div class="grid-icon-and-text-title">'+Ext.htmlEncode(l)+"</div>";return c}},{itemId:"widgetUrl",header:"URL",dataIndex:"url",width:250,sortable:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"type",header:"Type",dataIndex:"widgetTypes",width:75,sortable:false,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f[0]?f[0].name:"</div>"}},{itemId:"version",header:"Version",dataIndex:"version",width:75,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"totalUsers",header:"Users",dataIndex:"totalUsers",width:75,hidden:this.hideTotalUsersCol,sortable:false,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"totalGroups",header:"Groups",dataIndex:"totalGroups",width:75,hidden:this.hideTotalGroupsCol,sortable:false,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"widget-grid-paging"})]});this.callParent(arguments)},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}}});Ext.define("Ozone.components.admin.DashboardsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.dashboardstabpanel"],layout:{type:"fit"},preventHeader:true,border:true,padding:5,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,isGroupDashboard:false,editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{items:[{xtype:"dashboardsgrid",itemId:"dashboardsgrid",preventHeader:true,border:false,listeners:{itemdblclick:{fn:this.doEdit,scope:this}}}],dockedItems:[{xtype:"toolbar",itemId:"tbDashboardsGridHdr",cls:"tbDashboardsGridHdr",dock:"top",items:[{xtype:"tbtext",cls:"tbDashboardsGridHdr",itemId:"lblDashboardsGrid",text:"Dashboards"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("dashboardsgrid");if(b!=null){b.applyFilter(d,["name"])}},scope:this}}}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("dashboardsgrid");var e=i.getDockedComponent("tbDashboardsGridHdr");var h=e.getComponent("lblDashboardsGrid");var g=i.ownerCt;var j=-1;c.setStore(Ext.create("Ozone.data.stores.AdminDashboardStore",i.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"dashboards",adminEnabled:true};d[i.componentId]=j;c.setBaseParams(d)}},single:true}});this.on({activate:{fn:function(f,e){var d=f.getComponent("dashboardsgrid");var c=d.getStore();if(f.ownerCt.record){var b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("title"),25));if(!b){b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("name"),25))||"Dashboards"}var g=this.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblDashboardsGrid");g.setText(b)}if(c){c.load({params:{offset:0,max:c.pageSize}})}},scope:this}});OWF.Preferences.getUserPreference({namespace:"owf.admin.DashboardEditCopy",name:"guid_to_launch",onSuccess:function(b){a.guid_DashboardEditCopyWidget=b.value},onFailure:function(b){a.editPanel.showAlert("Preferences Error","Error looking up Dashboard Editor: "+b)}});this.callParent()},launchFailedHandler:function(a){if(a.error){this.editPanel.showAlert("Launch Error","Dashboard Editor Launch Failed: "+a.message)}},onStoreException:function(f,c,b,d){var a;try{a=Ext.JSON.decode(c)}catch(g){a=c}a&&this.editPanel.showAlert("Server Error",a)},onAddClicked:function(){var a=Ext.widget("admineditoraddwindow",{addType:"Dashboard",itemName:this.ownerCt.record.get("displayName"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("dashboardsgrid").getStore(),grid:Ext.widget("dashboardsgrid",{itemId:"dashboardsaddgrid",border:false,enableColumnHide:false,sortableColumns:false,listeners:{render:{fn:function(b){b.setBaseParams({adminEnabled:true,isGroupDashboard:true,isStackDashboard:false})},scope:this}}})});a.show()},doEdit:function(k,f,l,h,j){var a=this.getComponent("dashboardsgrid");var c=a.getSelectedDashboards();if(c&&c.length>0){for(var d=0;d<c.length;d++){var b=c[d].data.guid;var g=Ozone.util.toString({id:b,copyFlag:false,isGroupDashboard:this.isGroupDashboard});OWF.Launcher.launch({guid:this.guid_DashboardEditCopyWidget,title:"$1 - "+c[d].get("name"),titleRegex:/(.*)/,launchOnlyIfClosed:false,data:g},this.launchFailedHandler)}}else{this.editPanel.showAlert("Error","You must select at least one dashboard to edit")}},doDelete:function(d,f){var c=this.getComponent("dashboardsgrid");var b=c.getStore();var a=c.getSelectedDashboards();if(a&&a.length>0){b.remove(a);b.save()}else{this.editPanel.showAlert("Error","You must select at least one dashboard to remove.")}}});Ext.define("Ozone.components.EditWidgetPanel",{extend:"Ext.panel.Panel",alias:["widget.editwidgetpanel","widget.Ozone.components.EditWidgetPanel"],layout:"card",bodyCls:"editpanel-body",initComponent:function(){this.addEvents("itemcreated","itemupdated","initialdataloaded");this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();OWF.Eventing.subscribe(this.channel,Ext.bind(this.handleSubscriptionEvent,this));this.launchConfig=OWF.Launcher.getLaunchData();if(this.launchConfig!=null){this.launchData=Ozone.util.parseJson(this.launchConfig)}this.widgetState=Ozone.state.WidgetState.getInstance({autoInit:true,onStateEventReceived:Ext.bind(this.handleStateEvent,this)});this.store.on("write",function(d,e,a,c,b){OWF.Eventing.publish(this.channel,{action:e,domain:this.domain,records:a})},this);this.on("itemcreated",function(a){this.recordId=a;OWF.Eventing.publish(this.channel,{action:"created",id:a})},this);this.on("itemupdated",function(a){OWF.Eventing.publish(this.channel,{action:"modified",id:a})},this);this.on("afterrender",function(a,c){if(this.launchConfig!=null){if(!this.launchData.isCreate){this.store.load({params:{id:this.launchData.id},callback:function(){this.record=this.store.getById(this.launchData.id);this.recordId=this.record?this.record.getId():null;this.fireEvent("initialdataloaded",this.record);this.enableTabs()},scope:this})}}else{this.record={};this.fireEvent("initialdataloaded",this.record)}var d=[];for(var b=0;this.items&&b<this.items.getCount();b++){d.push({xtype:"button",pressed:b==0,disabled:this.items.getAt(b).initDisabled,toggleGroup:"editorTabs",allowDepress:false,text:this.items.getAt(b).title,iconCls:this.items.getAt(b).iconCls,icon:this.items.getAt(b).iconCls==undefined?this.items.getAt(b).icon:undefined,iconAlign:"top",scale:"xlarge",index:b,handler:function(f,g){this.getLayout().setActiveItem(f.index)},scope:this})}this.addDocked([{itemId:"editorToolbar",hidden:this.hideEditorToolbar,xtype:"toolbar",cls:"editor-tabs",dock:"top",items:d,enableOverflow:true,listeners:{afterlayout:function(e){e.setHeight(e.getHeight())}}}])},this);this.callParent(arguments)},handleStateEvent:function(a,b){if(b.eventName.indexOf("afterEventIntercept_")==-1){if(b.eventName=="beforeclose"){this.widgetState.removeStateEventOverrides({events:["beforeclose"],callback:Ext.bind(function(){this.widgetState.closeWidget()},this)})}}},handleSubscriptionEvent:function(a,b){if(b.action=="delete"&&b.id==this.recordId){this.closeWidget()}},closeWidget:function(){this.widgetStateHandler.handleWidgetRequest({fn:"closeWidget",params:{guid:Ozone.getInstanceId()}})},enableTabs:function(){var a=this.getDockedComponent("editorToolbar");for(var c=0;a.items&&c<a.items.getCount();c++){var b=a.items.getAt(c);if(b){b.setDisabled(false)}}}});Ext.define("Ozone.components.PropertiesPanel",{extend:"Ext.form.Panel",alias:["widget.propertiespanel","widget.Ozone.components.PropertiesPanel"],layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,editPanel:null,initComponent:function(){var b=this;b.buttonAlign=b.buttonAlign||"left";b.buttons=[{text:"Apply",itemId:"apply",handler:b.onApply,scope:b}];b.defaults=Ext.apply(b.defaults||{},{labelSeparator:"",margin:"5 5 0 5",msgTarget:"side",anchor:"100%",listeners:{blur:{fn:b.handleBlur},change:{fn:b.handleChange},afterrender:{fn:function(e,c){var d=e.getComponentLayout();if(d.errorStrategies!=null){d.previousBeforeLayout=d.beforeLayout;d.beforeLayout=function(g,f){return this.previousBeforeLayout()||!this.owner.preventMark};d.errorStrategies.side={prepare:function(f){var h=f.findParentByType("widgeteditpropertiestab");var g=h?h.loadedFromDescriptor:false;var j=f.errorEl;var i=f.fieldLabel.indexOf("required-label")<0?false:true;if((f.hasActiveError()&&f.changed)||(i&&Ext.isEmpty(f.getValue())&&g)){j.removeCls(["owf-form-valid-field","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls(Ext.baseCSSPrefix+"form-invalid-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveError()||"");if(i&&Ext.isEmpty(f.getValue())){j.setDisplayed(true)}else{j.setDisplayed(f.hasActiveError())}}else{if(f.hasActiveWarning&&f.hasActiveWarning()&&f.changed){j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","owf-form-valid-field","owf-form-unchanged-field"]);j.addCls("x-form-warning-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveWarning()||"");j.setDisplayed(f.hasActiveWarning())}else{if(f.changed&&!g){if(d.tip){d.tip.unregister(j)}j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls("owf-form-valid-field");j.dom.setAttribute("data-errorqtip","");j.setDisplayed(true)}else{j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-valid-field"]);j.dom.setAttribute("data-errorqtip","");j.setDisplayed(false)}}}},adjustHorizInsets:function(f,g){if(f.autoFitErrors){g.insets.right+=f.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(f,g){f.errorEl.setStyle("left",g.width-g.insets.right+"px")},layoutVert:function(f,g){f.errorEl.setStyle("top",g.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:b}}});b.on("afterrender",function(d){var e=d.ownerCt;if(e.record){d.initFieldValues(e.record)}else{e.on("initialdataloaded",d.initFieldValues,d)}if(e.store){e.store.on("write",function(g,f,i){var h=f.getRecords();if(h){var j=h[0];if(j){var k=j.get("id");if(k){e.recordId=k}}}e.enableTabs();b.showApplyAlert("Your changes have been saved.")});if(e.store.proxy){var c=d;e.store.proxy.on("exception",function(j,g,f,i){if("create"==f.action){e.store.removeAll();if(Ext.isFunction(c.initFieldValues)){c.initFieldValues({})}}var h;try{h=(typeof g)=="string"?Ext.JSON.decode(g):g}catch(k){h={errorMsg:g}}b.editPanel.showAlert("Server Error!",Ext.htmlEncode(h.errorMsg))})}}});if(Ozone.config.freeTextEntryWarningMessage!=null&&Ozone.config.freeTextEntryWarningMessage!=""){var a=Ozone.config.freeTextEntryWarningMessage;this.items=this.items||[];this.items.splice(0,0,{xtype:"component",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(a&&a.length>0)?"dialogHeader":"",message:a?a:""}})}this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();b.callParent()},initFieldValues:Ext.emptyFn,handleBlur:function(a){a.changed=true;a.doComponentLayout();if(a.getXType()=="textfield"){a.setValue(Ext.String.trim(a.getValue()))}},handleChange:function(d,c,a,b){if(!d.changed&&d.isDirty()){d.changed=true}},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},onApply:function(){this.validateFields();if(!this.getForm().hasInvalidField()){var b=this;var c=b.ownerCt;var e=this.getValues();if(c.store.data.length>0){var a=c.store.getById(c.recordId);a.beginEdit();for(var d in e){if(!Ext.isFunction(d)){a.set(d,e[d])}}a.endEdit()}else{c.store.add(e);c.store.data.items[0].phantom=true;if(Ext.isFunction(b.initFieldValues)){b.initFieldValues(c.store.data.items[0])}}if(c.store.getNewRecords().length===0&&c.store.getUpdatedRecords().length===0){b.showApplyAlert("Your changes have been saved.")}c.store.save()}else{this.showApplyAlert("Invalid field, changes cannot be saved.",3000)}},showApplyAlert:function(d,c){var b=this,a=this.getDockedItems()[0];if(!a.getComponent(b.applyAlert)){b.applyAlert=Ext.widget("displayfield",{itemId:"applyAlert",name:"applyAlert",cls:"applyAlert",width:450,html:d});a.add(b.applyAlert);Ext.defer(function(){a.remove(b.applyAlert)},c?c:2000)}},validateFields:function(){var a=this.query("textfield");for(var b=0;b<a.length;b++){var c=a[b];if(!Ext.isFunction(c)){c.isValid();this.handleBlur(c)}}}});Ext.define("Ozone.components.admin.StacksTabPanel",{extend:"Ext.panel.Panel",alias:["widget.stackstabpanel","widget.Ozone.components.admin.StacksTabPanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:"fit",preventHeader:true,border:true,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,items:[{xtype:"stacksgrid",itemId:"stacksgrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbStacksGridHdr",cls:"tbStacksGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblStacksGrid",cls:"tbStacksGridHdr",text:"Stacks"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("stacksgrid");if(b!=null){b.applyFilter(d,["name","description"])}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"addButton",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"removeButton",handler:function(){var d=this.down("#stacksgrid");if(d){var c=d.getSelectionModel().getSelection();if(c&&c.length>0){var b=d.store;b.remove(c);b.on({save:{fn:function(f,e,g){b.reload()}}});b.save()}else{a.editPanel.showAlert("Error","You must select at least one stack to remove.")}}},scope:this}]}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(g,b){var e=g.ownerCt;var c=g.down("#stacksgrid");c.setStore(Ext.create("Ozone.data.StackStore",g.storeCfg));var f=function(k){g.refreshWidgetLaunchMenu();if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&e){e.record=e.recordId?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}if(e.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("title"),25))||"Stacks";var h=g.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblStacksGrid");h.setText(j)}OWF.Preferences.getUserPreference({namespace:"owf.admin.StackEditCopy",name:"guid_to_launch",onSuccess:function(k){g.guid_EditCopyWidget=k.value},onFailure:function(k){a.editPanel.showAlert("Preferences Error","Error looking up Stack Editor: "+k)}});if(c&&e){var i=e.recordId?e.recordId:-1;var d={tab:"stacks"};d[g.componentId]=i;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){g.doEdit(k[l].data.id,k[l].data.name)}}else{a.editPanel.showAlert("Error","You must select at least one stack to edit.")}},scope:this}})}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("stacksgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent()},onAddClicked:function(b,f){var a=this.ownerCt.record,c=a.get("name")?a.get("name"):a.get("userRealName");var d=Ext.widget("admineditoraddwindow",{addType:"Stack",itemName:c,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("stacksgrid").getStore(),searchFields:["displayName"],grid:Ext.widget("stacksgrid",{itemId:"stacksaddgrid",border:false,preventHeader:true,enableColumnHide:false,sortableColumns:false})});d.show()},doEdit:function(d,c){var a=this;var b=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+c,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:b},function(e){if(e.error){a.editPanel.showAlert("Launch Error","Stack Editor Launch Failed: "+e.message)}})},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}}});Ext.define("Ozone.components.admin.UsersTabPanel",{extend:"Ext.panel.Panel",alias:["widget.userstabpanel"],layout:{type:"fit"},preventHeader:true,border:true,padding:5,initDisabled:true,editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{dockedItems:[{xtype:"toolbar",itemId:"usersHeader",cls:"tbUsersGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"usersHeaderLabel",cls:"tbUsersGridHdr",text:"Users"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("usersgrid");if(b!=null){b.applyFilter(d,b.quickSearchFields)}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",itemId:"usersFooter",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"add",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"remove",handler:function(){var d=this.getComponent("usersgrid");var c=d.getStore();var b=d.getSelectionModel().getSelection();if(b&&b.length>0){c.remove(b);c.save()}else{a.editPanel.showAlert("Error","You must select at least one user to remove.")}},scope:this}]}],items:[{xtype:"usersgrid",itemId:"usersgrid",preventHeader:true,border:false}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(j,b){var c=j.getComponent("usersgrid");var h=j.ownerCt;var l=-1;var i=j.getDockedComponent("usersFooter");var e=i.getComponent("add");var m=i.getComponent("remove");var g=h.store.getAt(h.store.findExact("id",h.recordId));if(g.data.automatic){e.setDisabled(true);m.setDisabled(true)}OWF.Preferences.getUserPreference({namespace:"owf.admin.UserEditCopy",name:"guid_to_launch",onSuccess:function(o){j.guid_EditCopyWidget=o.value},onFailure:function(o){a.editPanel.showAlert("Preferences Error","Error looking up User Editor: "+o)}});c.setStore(Ext.create("Ozone.data.UserStore",j.storeCfg));var f=function(o){if(o.action=="destroy"||o.action=="create"){var p=c.getBottomToolbar();p.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(r,s,o,q,p){OWF.Eventing.publish(this.ownerCt.channel,{action:s,domain:this.ownerCt.domain,records:o})},this);if(c&&h){if(Ext.isNumeric(h.recordId)){h.record=h.recordId>-1?h.store.getAt(h.store.findExact("id",h.recordId)):undefined;l=h.recordId>-1?h.recordId:-1}else{h.record=h.recordId?h.store.getAt(h.store.findExact("id",h.recordId)):undefined;l=h.recordId?h.recordId:-1}var d={tab:"users"};d[j.componentId]=l;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var o=c.getSelectionModel().getSelection();if(o&&o.length>0){for(var p=0;p<o.length;p++){j.doEdit(o[p].data.id,o[p].data.userRealName)}}else{a.editPanel.showAlert("Error","You must select at least one user to edit.")}},scope:this}})}if(h.record){var n=Ext.htmlEncode(Ext.util.Format.ellipsis(h.record.get("title"),25));if(!n){n=Ext.htmlEncode(Ext.util.Format.ellipsis(h.record.get("name"),25))||"Users"}var k=j.getDockedItems('toolbar[dock="top"]')[0].getComponent("usersHeaderLabel");k.setText(n)}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("usersgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},onAddClicked:function(a,d){var b=this.ownerCt.record.get("title");if(!b){b=this.ownerCt.record.get("name")}var c=Ext.widget("admineditoraddwindow",{addType:"User",itemName:b,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("usersgrid").getStore(),grid:Ext.widget("usersgrid",{itemId:"usersaddgrid",border:false,enableColumnHide:false,sortableColumns:false})});c.show()},doEdit:function(c,b){var a=Ozone.util.toString({id:c,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+b,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(d){if(d.error){this.editPanel.showAlert("Launch Error","User Editor Launch Failed: "+d.message)}})}});Ext.define("Ozone.components.admin.grid.WidgetsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.widgetstabpanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:{type:"fit"},preventHeader:true,border:true,padding:5,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,initDisabled:true,items:[{xtype:"widgetsgrid",itemId:"widgetsGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbWidgetsGridHdr",cls:"tbWidgetsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblWidgetsGrid",cls:"tbWidgetsGridHdr",text:"Widgets"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("widgetsGrid");if(b!=null){b.applyFilter(d,["displayName","universalName"])}},scope:this}}}]},{xtype:"toolbar",itemId:"tbWidgetsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",itemId:"btnAdd",text:"Add",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",itemId:"btnRemove",text:"Remove",handler:function(){var d=this.getComponent("widgetsGrid");var c=d.store;var b=d.getSelectionModel().getSelection();if(b&&b.length>0){c.remove(b);c.save()}else{a.editPanel.showAlert("Error","You must select at least one widget to remove.")}},scope:this}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("widgetsGrid");var e=i.getDockedComponent("tbWidgetsGridHdr");var h=e.getComponent("lblWidgetsGrid");var g=i.ownerCt;var j=-1;OWF.Preferences.getUserPreference({namespace:"owf.admin.WidgetEditCopy",name:"guid_to_launch",onSuccess:function(l){i.guid_EditCopyWidget=l.value},onFailure:function(l){a.editPanel.showAlert("Preferences Error","Error looking up Widget Editor: "+l)}});c.setStore(Ext.create("Ozone.data.stores.AdminWidgetStore",i.storeCfg));var f=function(l){i.refreshWidgetLaunchMenu();if(l.action=="destroy"||l.action=="create"){var m=c.getBottomToolbar();m.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(o,p,l,n,m){OWF.Eventing.publish(this.ownerCt.channel,{action:p,domain:this.ownerCt.domain,records:l})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"widgets"};d[i.componentId]=j;c.setBaseParams(d)}if(g.record){var k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("title"),25));if(!k){k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("name"),25))||"Widgets"}h.setText(k)}if(c!=null){c.on({itemdblclick:{fn:function(){var l=c.getSelectionModel().getSelection();if(l&&l.length>0){for(var m=0;m<l.length;m++){i.doEdit(l[m].data.id,l[m].data.name)}}else{a.editPanel.showAlert("Error","You must select at least one widget to edit.")}},scope:this}})}},single:true}});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{fn:function(){var c=this.getComponent("widgetsGrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},doEdit:function(d,c){var b=this;var a=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+c,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(e){if(e.error){b.editPanel.showAlert("Launch Error","Widget Editor Launch Failed: "+e.message)}})},onAddClicked:function(a,c){var b=Ext.widget("admineditoraddwindow",{addType:"Widget",itemName:this.ownerCt.record.get("title"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("widgetsGrid").getStore(),searchFields:["displayName"],grid:Ext.widget("widgetsgrid",{itemId:"widgetsaddgrid",border:false,enableColumnHide:false,sortableColumns:false})});b.show()}});Ext.define("Ozone.components.admin.dashboard.DashboardDetailPanel",{extend:"Ext.panel.Panel",alias:["widget.dashboarddetailpanel","widget.dashboarddetail"],viewDashboard:null,loadedRecord:null,initComponent:function(){Ext.tip.QuickTipManager.init(true,{dismissDelay:60000,showDelay:2000});this.viewDashboard=Ext.create("Ext.view.View",{store:Ext.create("Ext.data.Store",{storeId:"storeDashboardItem",fields:[{name:"name",type:"string"},{name:"layout",type:"string"},{name:"EDashboardLayoutList",type:"string"},{name:"isGroupDashboard",type:"boolean"},{name:"groups",model:"Group"},{name:"description",type:"string"},{name:"createdDate",type:"string"},{name:"prettyCreatedDate",type:"string"},{name:"editedDate",type:"string"},{name:"prettyEditedDate",type:"string"},{name:"createdBy",model:"User"},{name:"stack",model:"Stack"}]}),deferEmptyText:false,tpl:new Ext.XTemplate('<tpl for=".">','<div class="selector">','<div id="detail-info" class="detail-info">','<div class="dashboard-detail-icon-block">',"{[this.renderIconBlock(values)]}","</div>",'<div class="dashboard-detail-info-block">','<div class="detail-header-block">',"{[this.renderDetailHeaderBlock(values)]}","</div>",'<div class="detail-block">','<div><span class="detail-label">Description:</span> {description:htmlEncode}</span></div><br>','<div><span class="detail-label">Groups:</span> {[this.renderGroups(values)]}</div>','<div><span class="detail-label">Created:</span> <span {createdDate:this.renderToolTip}>{prettyCreatedDate:this.renderDate}</span></div>','<div><span class="detail-label">Author:</span> {[this.renderUserRealName(values)]}</div>','<div><span class="detail-label">Last Modified:</span> <span {editedDate:this.renderToolTip}>{prettyEditedDate:this.renderDate}</span></div>',"</div>","</div>","</div>","</div>","</tpl>",{compiled:true,renderDate:function(a){return a?a:""},renderToolTip:function(a){var b='data-qtip="'+a+'"';return b},renderUserRealName:function(a){var b=a.createdBy;return(b.userRealName?Ext.htmlEncode(b.userRealName):"")},renderGroups:function(c){var b=c.groups;var a=c.stack;var e="";if(!a&&b&&b.length>0){for(var d=-1;++d<b.length;){e+=Ext.htmlEncode(b[d].name)+", "}e=e.substring(0,e.length-2)}return e},renderIconBlock:function(b){var a="dashboard-default-icon-layout";var c='<div class="dashboard-icon '+a+'"></div>';return c},renderDetailHeaderBlock:function(a){var b=a.isGroupDashboard;var d=a.name;var c='<div class="dashboard-title-block">';c+='<div class="dashboard-title detail-title">'+Ext.htmlEncode(d)+"</div>";c+=(b)?"<div>This is a group dashboard.</div>":"";c+="</div>";return c}}),emptyText:"No dashboard selected",itemSelector:"div.selector",autoScroll:"true"});this.items=[this.viewDashboard];this.callParent(arguments)},loadData:function(a){this.viewDashboard.store.loadData([a],false);this.loadedRecord=a},removeData:function(){this.viewDashboard.store.removeAll(false);this.loadedRecord=null}});Ext.define("Ozone.components.admin.group.GroupEditDashboardsTab",{extend:"Ozone.components.admin.DashboardsTabPanel",alias:["widget.groupeditdashboards","widget.groupeditdashboardstab","widget.Ozone.components.admin.group.GroupEditDashboardsTab"],cls:"groupeditdashboardstab",isGroupDashboard:true,initComponent:function(){Ext.applyIf(this,{layout:"fit",itemId:"tabDashboards",title:"Dashboards",iconCls:"dashboard-tab",editor:"Group",componentId:"group_id",storeCfg:{api:{read:"/dashboard",create:"/group",update:"/dashboard",destroy:"/group"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments);this.addDocked({xtype:"toolbar",itemId:"tbDashboardsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"btnAdd",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"btnRemove",handler:function(){this.doDelete()},scope:this}]})}});Ext.define("Ozone.components.admin.group.GroupEditPropertiesTab",{extend:"Ozone.components.PropertiesPanel",alias:["widget.groupeditproperties","widget.groupeditpropertiestab","widget.Ozone.components.admin.group.GroupEditPropertiesTab"],cls:"groupeditpropertiestab",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",title:"Properties",iconCls:"properties-tab",items:[{xtype:"textfield",name:"name",fieldLabel:Ozone.util.createRequiredLabel("Name"),labelWidth:150,allowBlank:false,maxLength:200,enforceMaxLength:true,disabledCls:"properties-field-disabled",disable:function(b){var c=this;if(c.rendered){c.el.addCls(c.disabledCls);c.onDisable()}c.disabled=true;if(b!==true){c.fireEvent("disable",c)}return c},itemId:"name"},{xtype:"textfield",name:"displayName",fieldLabel:"Display Name",allowBlank:true,maxLength:200,enforceMaxLength:true,itemId:"displayName",labelWidth:150},{xtype:"textarea",fieldLabel:"Description",labelWidth:150,name:"description",itemId:"description",height:100,allowBlank:true,maxLength:255,enforceMaxLength:true},{xtype:"checkbox",name:"automatic",submitValue:true,inputValue:true,disabledCls:"properties-checkboxfield-disabled",fieldLabel:"User Management",labelWidth:150,boxLabel:"Automatic",preventMark:true,disable:function(b){var c=this;if(c.rendered){c.el.addCls(c.disabledCls);c.onDisable()}c.disabled=true;if(b!==true){c.fireEvent("disable",c)}return c},itemId:"automatic"},{xtype:"checkbox",name:"activated",submitValue:false,fieldLabel:"Active",labelWidth:150,itemId:"activated",boxLabel:"True",preventMark:true,listeners:{change:function(f,e,b,d){var c=a.getComponent("status");if(c){if(e){c.setValue("active")}else{c.setValue("inactive")}}}}},{xtype:"hidden",name:"status",itemId:"status",preventMark:true,value:"inactive"}]});this.callParent(arguments)},initFieldValues:function(e){var g=this;var c=e?e.data:e;if(c){var a=g.getComponent("name"),i=g.getComponent("description"),d=g.getComponent("automatic"),f=g.getComponent("activated"),b=g.getComponent("status"),h=g.getComponent("displayName");a.setValue(c.name).originalValue=c.name;a.setDisabled(c.automatic);h.setValue(c.displayName).originalValue=c.displayName;i.setValue(c.description).originalValue=c.description;d.setValue(c.automatic).originalValue=c.automatic;d.setDisabled(true);f.setValue("active"==c.status).originalValue="active"==c.status;b.setValue(c.status).originalValue=c.status}}});Ext.define("Ozone.components.admin.group.GroupEditStacksTab",{extend:"Ozone.components.admin.StacksTabPanel",alias:["widget.groupeditstacks","widget.groupeditstackstab","widget.Ozone.components.admin.group.GroupEditStacksTab"],cls:"groupeditstackstab",initComponent:function(){Ext.apply(this,{padding:5,iconCls:"stacks-tab",editor:"Group",componentId:"group_id",title:"Stacks",storeCfg:{api:{read:"/stack",create:"/group",update:"/stack",destroy:"/group"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"},pageSize:50}});this.callParent(arguments)},initBaseParams:function(a){this.baseParams={group_id:a.data.id};this.applyFilter()}});Ext.define("Ozone.components.admin.group.GroupEditUsersTab",{extend:"Ozone.components.admin.UsersTabPanel",alias:["widget.groupeditusers","widget.groupedituserstab","widget.Ozone.components.admin.group.GroupEditUsersTab"],cls:"groupedituserstab",preventHeader:true,initComponent:function(){var a=this;Ext.applyIf(this,{itemId:"users-tab",iconCls:"users-tab",title:"Users",editor:"Group",componentId:"group_id",storeCfg:{api:{read:"/user",create:"/group",update:"/user",destroy:"/group"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.group.GroupEditWidgetsTab",{extend:"Ozone.components.admin.grid.WidgetsTabPanel",alias:["widget.groupeditwidgets","widget.groupeditwidgetstab","widget.Ozone.components.admin.group.GroupEditWidgetsTab"],cls:"groupeditwidgetstab",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"tabWidgets",title:"Widgets",editor:"Group",iconCls:"widgets-tab",componentId:"group_id",storeCfg:{api:{read:"/widget",create:"/group",update:"/widget",destroy:"/group"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.group.GroupEditPanel",{extend:"Ext.panel.Panel",alias:["widget.groupedit","widget.groupeditpanel","widget.Ozone.components.admin.group.GroupEditPanel"],mixins:["Ozone.components.WidgetAlerts"],cls:"groupeditpanel",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",items:[{xtype:"editwidgetpanel",cls:"adminEditor",bodyCls:"adminEditor-body",dragAndDrop:false,launchesWidgets:false,domain:"Group",channel:"AdminChannel",store:Ext.create("Ozone.data.GroupStore",{}),items:[{xtype:"groupeditproperties",itemId:"groupeditproperties",editPanel:a},{xtype:"groupeditusers",itemId:"groupeditusers",editPanel:a},{xtype:"groupeditwidgets",itemId:"groupeditwidgets",editPanel:a},{xtype:"groupeditdashboards",itemId:"groupeditdashboards",editPanel:a},{xtype:"groupeditstacks",itemId:"groupeditstacks",editPanel:a}]}]});this.callParent(arguments)}});