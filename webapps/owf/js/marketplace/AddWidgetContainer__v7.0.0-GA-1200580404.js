var Ozone=Ozone?Ozone:{};Ozone.marketplace=Ozone.marketplace||{};Ozone.marketplace.AddWidgetContainer=function(b){this.addWidgetChannelName="_ADD_WIDGET_CHANNEL";this.windowManager=null;if(b!=null){this.eventingContainer=b;var a=this;this.eventingContainer.registerHandler(this.addWidgetChannelName,function(d,e){var c=Ozone.util.parseJson(e);return a.addWidget(c)})}else{throw {name:"AddWidgetContainerException",message:"eventingContainer is null"}}};Ozone.marketplace.AddWidgetContainer.prototype={addWidget:function(b){var a=b.widgetsJSON;this.processMarketplaceWidgetData(a.baseUrl,a.itemId);return a.itemId},processMarketplaceWidgetData:function(c,b){var a=this;Ozone.util.Transport.send({url:c+"/relationship/getOWFRequiredItems",method:"POST",content:{id:b},onSuccess:function(f){var g=[],h=f.data;for(var e=0,d=h.length;e<d;e++){var j=h[e];g.push(Ext.JSON.encode(a.createOwfWidgetJson(j,b)))}a.submitWidgetList(Ext.JSON.encode(g))},onFailure:function(d){Ext.Msg.alert("Error","Error has occurred while adding widgets from Marketplace")}})},createOwfWidgetJson:function(e,c){var b=[];for(var a=0;a<e.requires.length;a++){b.push(e.requires[a].uuid)}var d={displayName:e.title,description:e.description?e.description:"",imageUrlLarge:e.imageLargeUrl,imageUrlSmall:e.imageSmallUrl,widgetGuid:e.uuid,widgetUrl:e.launchUrl,widgetVersion:e.versionName,singleton:e.owfProperties.singleton,visible:e.owfProperties.visibleInLaunch,background:e.owfProperties.background,isSelected:c==e.id,height:200,width:200,isExtAjaxFormat:true};if(b.length>0){d.directRequired=Ext.JSON.encode(b)}return d},createApprovalTag:function(){var c={};if(Ozone.config.enablePendingApprovalWidgetTagGroup){c={name:Ozone.config.carousel.pendingApprovalTagGroupName,visible:true,position:-1,editable:false}}else{var b=new Date();var a=Ext.Date.format(b,"Y-m-d");c={name:Ozone.config.carousel.approvedTagGroupName+" on "+a,visible:true,position:-1,editable:true}}return c},submitWidgetList:function(a){return owfdojo.xhrPost({url:Ozone.util.contextPath()+"/widget/",sync:true,content:{addExternalWidgetsToUser:true,widgets:a},load:function(d,c){var e=Ext.getCmp("widget-launcher");e.loadLauncherState();var b={dir1:"up",dir2:"left",firstpos1:25,firstpos2:25};$.pnotify({title:Ozone.layout.DialogMessages.added,text:Ozone.layout.DialogMessages.marketplaceWindow_AddSuccessful,type:"success",addclass:"stack-bottomright",stack:b,history:false,sticker:false,icon:false})},error:function(c,b){Ozone.Msg.alert(Ozone.layout.DialogMessages.error,Ozone.layout.DialogMessages.marketplaceWindow_AddWidget,null,null,{cls:"confirmationDialog"})}})},registerWindowManager:function(a){this.windowManager=a}};