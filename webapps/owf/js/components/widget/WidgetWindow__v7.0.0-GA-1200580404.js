Ext.define("Ozone.components.widget.WidgetWindow",{extend:"Ext.window.Window",alias:["widget.widgetwindow","widget.Ozone.components.widget.WidgetWindow"],mixins:{widget:"Ozone.components.widget.WidgetBase"},plugins:[new Ozone.components.keys.KeyMoveable(),new Ozone.plugins.WidgetWindow()],floating:{shadow:false},hideMode:"offsets",inactiveCls:"inactive",maximizable:true,minimizable:true,constrain:!!Ext.isIE,constrainHeader:!Ext.isIE,enableDeactivateShim:false,debugDeactivateShim:false,deactivateShim:null,initialMouseOverActivate:true,isMouseOverActivateFlag:false,mouseOverActivateDelay:1000,widgetStateContainer:null,closable:true,widgetIframeDelay:200,liveDrag:true,onEsc:Ext.emptyFn,initComponent:function(){if(!this.manager){this.manager=Ext.WindowMgr}this.beforeInitComponent();this.callParent(arguments);this.on({activate:this.onActivate,deactivate:this.onDeActivate,maximize:this.onMaximize,restore:this.onRestore,afterrender:{fn:this.onAfterRender,scope:this}});Ext.apply(this,this.mixins.widget.overrides);this.afterInitComponent();if(!this.headers){this.headers=[]}this.on("toolbaritem:created",function(a){this.headers.push(a.header)})},onAfterRender:function(){this.headers.push(this.header);if(this.initialMouseOverActivate){this.addMouseOverActivate()}},bringToFront:function(){this.manager.bringToFront(this)},addMouseOverActivate:function(){if(!this.isMouseOverActivateFlag){this.el.on("mouseover",this.mouseOver,this);this.el.on("mouseleave",this.mouseLeave,this)}this.isMouseOverActivateFlag=true},removeMouseOverActivate:function(){if(this.isMouseOverActivateFlag){this.el.un("mouseover",this.mouseOver,this);this.el.un("mouseleave",this.mouseLeave,this)}if(this.mouseOverDeferredId!=null){clearTimeout(this.mouseOverDeferredId);this.mouseOverDeferredId=null}this.isMouseOverActivateFlag=false},mouseOver:function(c,b,a){if(this.isMouseOverActivateFlag&&OWF.Container.DragAndDrop.isDragging()&&this.mouseOverDeferredId==null){this.mouseOverDeferredId=Ext.defer(function(){if(OWF.Container.DragAndDrop.isDragging()){this.bringToFront()}this.mouseOverDeferredId=null},this.mouseOverActivateDelay,this)}},mouseLeave:function(c,b,a){if(this.mouseOverDeferredId!=null){clearTimeout(this.mouseOverDeferredId);this.mouseOverDeferredId=null}},onMaximize:function(a){a.resizer.disable()},onRestore:function(a){a.resizer.enable();if(a.focusOnRestore){a.focusOnRestore.focus()}},onActivate:function(a){if(this.enableDeactivateShim){if(this.deactivateShim){this.deactivateShim.hide()}}},onDeActivate:function(c){if(this.enableDeactivateShim){var b=this.body;if(!this.deactivateShim){var a=document.createElement("div");a.id="ext-deactivate-shim-"+this.getId();a.style.display="block";a.style.backgroundColor="black";this.deactivateShim=Ext.create("Ext.Layer",{id:"ext-deactivate-shim-"+this.getId(),shadow:false,useDisplay:true,constrain:false},a);if(this.debugDeactivateShim){this.deactivateShim.setOpacity(0.5)}else{this.deactivateShim.setOpacity(0)}this.deactivateShim.setZIndex(parseInt(this.el.getStyle("z-index")));b.insertSibling(this.deactivateShim)}this.deactivateShim.setHeight(b.getHeight());this.deactivateShim.setWidth(b.getWidth());this.deactivateShim.setTop(b.getTop(true));this.deactivateShim.setLeft(b.getLeft(true));this.deactivateShim.setRight(b.getRight(true));this.deactivateShim.setBottom(b.getBottom(true));this.deactivateShim.show()}},stateEvents:["bodyresize","show","minimize","maximize","activate","deactivate","titlechange"],getState:function(){var d={universalName:this.universalName,widgetGuid:this.widgetGuid,uniqueId:this.uniqueId,dashboardGuid:this.dashboardGuid,paneGuid:this.paneGuid,name:this.title?this.title:this.name,active:this.active?true:false,x:this.restorePos?this.restorePos[0]:this.x,y:this.restorePos?this.restorePos[1]:this.y,minimized:this.minimized?true:false,maximized:this.maximized?true:false,pinned:false,collapsed:false,columnPos:0,buttonId:this.buttonId?this.buttonId:null,buttonOpened:this.buttonOpened?this.buttonOpened:false,region:"none",statePosition:this.statePosition,intentConfig:this.intentConfig,launchData:this.launchData,singleton:this.singleton?this.singleton:false,floatingWidget:this.floatingWidget?this.floatingWidget:false,background:this.background?this.background:false};if(this.rendered){var e=null;var a=null;var b=null;var c=this.getBox();if(!this.destroying&&!this.isDestroyed){e=this.el.getZIndex();a=c.height;b=c.width}else{a=this.height;b=this.width}Ext.apply(d,{zIndex:Ext.isNumber(e)&&e>0?e:this.zIndex!=null?this.zIndex:0,height:this.restoreSize?this.restoreSize.height:a,width:this.restoreSize?this.restoreSize.width:b,x:c.x,y:c.y})}else{Ext.apply(d,{zIndex:this.zIndex!=null?this.zIndex:0,height:this.restoreSize?this.restoreSize.height:-1,width:this.restoreSize?this.restoreSize.width:-1})}return d},applyState:function(a){this.setSize(a.width,a.height);this.setPosition(a.x,a.y);this.title=a.name;this.minimized=a.minimized;this.maximized=a.maximized},toggleMaximize:function(a){if(!a.getTarget("."+this.baseCls+"-header-text")&&!a.getTarget("titleEditor")){return this[this.maximized?"restore":"maximize"]()}},maximize:function(){var a=this;if(!a.maximized){a.expand(false);if(!a.hasSavedRestore){a.restoreSize=a.getSize();a.restorePos=a.getPosition(true)}if(a.maximizable){var b=this.header.tools.maximize;a.tools.restore.show();if(b.isFocused()){this.tools.restore.focus()}this.focusOnRestore=b;b.hide()}a.maximized=true;a.el.disableShadow();if(a.dd){a.dd.disable()}if(a.collapseTool){a.collapseTool.hide()}a.el.addCls(Ext.baseCSSPrefix+"window-maximized");if(!Ext.isGecko){a.container.addCls(Ext.baseCSSPrefix+"window-maximized-ct")}a.setPosition(0,0);a.fitContainer();a.fireEvent("maximize",a)}return a},minimize:function(){var a=this;if(!a.minimized){a.expand(false);if(!a.hasSavedRestore&&!a.maximized){a.restoreSize=a.getSize();a.restorePos=a.getPosition(true)}a.minimized=true;this.focusOnRestore=null;a.fireEvent("minimize",a);a.hide()}return a},restore:function(){if(!this.tools.restore.isFocused()){this.focusOnRestore=null}this.callParent(arguments)},restoreFromMinimize:(function(){var a=function(){if(this.minimized){if(this.minimizable){this.tools.minimize.show()}this.minimized=false;this.fireEvent("restore",this)}};return function(b){var c=this;if(c.rendered){c.show();a.call(c);c.focus(false,false,b,true)}else{c.on("afterrender",function(d){a.call(d);d.focus(false,false,b,true)});c.show()}return c}}()),purgeListener:function(a){var b=this.events[a];if(typeof b=="object"){b.clearListeners()}},restoreListener:function(a){var b=this.originalStateEvents[a];if(typeof b=="object"){this.events[a]=b}}});