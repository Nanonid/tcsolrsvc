Ext.define("Ozone.components.launchMenu.WidgetView",{extend:"Ext.Container",alias:"widget.widgetview",alreadyOpenedWidget:false,disableDragAndDrop:false,disableDragLaunching:false,initComponent:function(){var a=this;this.gridStore=Ext.create("Ozone.data.WidgetStore",{sorters:[{property:"name",direction:"ASC"}]});this.gridStore.add(this.widgetStore.getRange());this.widgetStore.on({datachanged:{fn:function(b,c){this.gridStore.removeAll();this.gridStore.add(b.getRange());this.gridStore.sort(this.gridStore.getSorters())},scope:this}});Ext.apply(this,{layout:{type:"card",deferredRender:true},activeItem:0,items:[{xtype:"ddview",itemId:"view",itemSelector:".widget",overItemCls:"widget-over",selectedItemCls:"widget-selected",trackOver:true,singleSelect:true,store:this.widgetStore,disableDragAndDrop:this.disableDragAndDrop,disableDragLaunching:this.disableDragLaunching,autoScroll:true,ddGroup:"widgets",plugins:{ptype:"instancevariablizer",container:this},tpl:new Ext.XTemplate('<tpl for=".">','<div class="widget <tpl if="this.setDisabled(values)">widget-disabled</tpl>" >','<div class="thumb-wrap" id={widgetGuid}>','<img onerror="this.src = \'{[this.getDefaultIcon()]}\'" src="{[this.getIcon(xindex, values)]}" class="thumb" />',"</div>",'<div class="thumb-text">{[this.encodeAndEllipsize(values.name)]}</div>',"</div>","</tpl>",{compiled:true,setDisabled:function(b){var c=false;if(b.disabled!==null||b.disabled!==undefined){c=b.disabled}else{var d=a.widgetStore.getById(b.uniqueId);if(d!=null){c=d.get("disabled")}}return c},getIcon:function(d,b){var c=null;if(b.image!=null){c=encodeURI(decodeURI(b.image))}else{var e=a.widgetStore.getById(b.uniqueId);if(e!=null){c=encodeURI(decodeURI(e.get("image")))}}return c},getDefaultIcon:function(){return"themes/common/images/settings/WidgetsIcon.png"},encodeAndEllipsize:function(b){return Ext.util.Format.htmlEncode(Ext.Array.map(Ext.Array.erase(/^([\S]+)\s*(.*)?/.exec(Ext.String.trim(b)),0,1),function(c){return Ext.util.Format.ellipsis(c,11)}).join(" "))}}),listeners:{itemclick:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemclick",c,b,g,d,f,e)},scope:this},itemdblclick:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemdblclick",c,b,g,d,f,e)},scope:this},itemkeydown:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemkeydown",c,b,g,d,f,e)},scope:this},selectionchange:{fn:function(d,c,f){if(c.length>0){for(var e=0;e<c.length;e++){var b=c[e];Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget})}}this.fireEvent("selectionchange",d,c,f)},scope:this}}},{xtype:"grid",store:this.gridStore,itemId:"grid",forceFit:true,plugins:[new Ozone.components.focusable.FocusableGridPanel(),{ptype:"instancevariablizer",container:this}],viewConfig:{getRowClass:function(b,e,d,c){if(b.get("disabled")){return"widget-disabled"}return""},listeners:{itemkeydown:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemkeydown",c,b,g,d,f,e)},scope:this}}},columns:[{header:"Icon",renderer:function(c,b,d,g,j,i,h){var e="themes/common/images/settings/WidgetsIcon.png";var f=null;if(c!=null){f=encodeURI(c)}else{f=encodeURI(d.get("image"))}return"<img onerror=\"this.src = '"+e+'\'" src="'+f+'" style="width: 24px;height: 24px">'},dataIndex:"image",flex:0,width:45,sortable:false},{header:"Name",dataIndex:"name",renderer:function(b){return Ext.htmlEncode(b)},flex:0,width:200},{header:"Tags",sortable:false,renderer:function(h,d,c){var f="";if(h==null){var g=a.widgetStore.getById(c.get("uniqueId"));h=g.get("tags")}for(var e=0;e<h.length;e++){var b=(h[e]).name;if(e==h.length-1){f+=b}else{f+=b+","}}return Ext.htmlEncode(f)},dataIndex:"tags",flex:1}],listeners:{render:{fn:function(b){b.enableBubble(["dragStarted","dragEnd","invalidDrop"]);if(!this.disableDragAndDrop){b.dragZone=new Ext.dd.DragZone(b.getEl(),{ddGroup:"widgets",getDragData:function(g){var c=g.getTarget(b.getView().itemSelector);if(c){var f=b.getSelectionModel().getLastSelected();var h=c.cloneNode(true);h.id=Ext.id();return{ddel:h,sourceEl:c,repairXY:Ext.fly(c).getXY(),widgetModel:f}}},getRepairXY:function(){return this.dragData.repairXY},onStartDrag:function(){b.fireEvent("dragStarted",b.dragZone,this.disableDragLaunching)},endDrag:function(){b.fireEvent("dragEnd")},afterInvalidDrop:function(c,d){b.fireEvent("invalidDrop")}})}},scope:this},itemclick:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemclick",c,b,g,d,f,e)},scope:this},itemdblclick:{fn:function(c,b,g,d,f,e){Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget});this.fireEvent("itemdblclick",c,b,g,d,f,e)},scope:this},selectionchange:{fn:function(d,c,f){if(c.length>0){for(var e=0;e<c.length;e++){var b=c[e];Ext.apply(b.data,{alreadyOpenedWidget:this.alreadyOpenedWidget})}this.fireEvent("selectionchange",d,c,f)}},scope:this}}}]});this.callParent();this.addEvents(["itemclick","itemdblclick","itemkeydown","selectionchange"]);this.enableBubble(["itemclick","itemdblclick","itemkeydown","selectionchange"])}});