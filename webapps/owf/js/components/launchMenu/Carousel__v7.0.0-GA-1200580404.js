Ext.define("Ozone.components.launchMenu.Carousel",{extend:"Ext.panel.Panel",alias:"widget.carousel",layout:"fit",cls:"carousel",resizable:{handles:"n",minHeight:48,maxHeight:144,pinned:true,dynamic:true},ddGroup:"carousel",store:null,viewStore:null,carouselView:null,slideDistance:3,initComponent:function(){var a=this;this.execScrollIdMap={};Ext.apply(this,{items:{xtype:"ddview",itemId:"carouselView",cls:"carousel-view",itemSelector:".carousel-widget",overItemCls:"carousel-widget-over",selectedItemCls:"carousel-widget-selected",dragImgSelector:".",trackOver:true,singleSelect:true,store:a.store,ddGroup:this.ddGroup,plugins:{ptype:"instancevariablizer",container:a},tpl:new Ext.XTemplate('<tpl for=".">','<img onerror="this.src = \'{[this.getDefaultIcon()]}\'" src="{[this.getIcon(xindex, values)]}" class="carousel-widget <tpl if="this.setDisabled(values)">widget-disabled</tpl>" />',"</div>","</tpl>",{compiled:true,getIcon:function(e,c){var d=null;var b=a.store.findExact("widgetGuid",c.widgetGuid);if(b>-1){var f=a.store.getAt(b);d=encodeURI(decodeURI(f.get("image")))}return d},getDefaultIcon:function(){return"themes/common/images/settings/WidgetsIcon.png"},setDisabled:function(b){var c=false;if(b.disabled!==null||b.disabled!==undefined){c=b.disabled}else{var d=a.widgetStore.getById(b.uniqueId);if(d!=null){c=d.get("disabled")}}return c}}),listeners:{render:{fn:function(b){this.relayEvents(b,["itemclick","itemdblclick","itemkeydown"])},scope:this},selectionchange:{fn:function(c,b,d){d=d||{};d.favorite=true;this.fireEvent("selectionchange",c,b,d)},scope:this},scope:this}},lbar:{xtype:"button",itemId:"leftBtn",cls:"leftCarouselBtn",iconCls:"leftCarouselBtnIcon",handler:function(){a.slideView(false)},listeners:{render:{fn:function(b){this.addScrollBtnDropZone(b,this.ddGroup)},scope:this}}},rbar:{xtype:"button",itemId:"rightBtn",cls:"rightCarouselBtn",iconCls:"rightCarouselBtnIcon",handler:function(){a.slideView(true)},listeners:{render:{fn:function(b){this.addScrollBtnDropZone(b,this.ddGroup)},scope:this}}},listeners:{resize:a.updateWidth,scope:this}});a.callParent(arguments);this.addEvents(["itemclick","itemdblclick","itemkeydown","selectionchange"]);this.enableBubble(["itemclick","itemdblclick","itemkeydown","selectionchange"]);a.on({destroy:{fn:function(c,b){this.cleanUpScrollerTasks()},scope:this}});a.store.on("datachanged",a.updateWidth,a)},addScrollBtnDropZone:function(b,a){var c=this,d=null,g={mouseup:{fn:function(){d=null;c.cleanUpScrollerTasks()},single:true}};function f(){if(b.itemId=="leftBtn"){c.slideView(false)}else{c.slideView(true)}}var e=new Ext.dd.DropZone(b.el,{ddGroup:a,getTargetFromEvent:function(h){return h.getTarget()},onNodeEnter:function(k,h,j,i){c.cleanUpScrollerTasks();Ext.getDoc().un(g);d=window.setInterval(f,500);c.execScrollIdMap[d]=true;Ext.getDoc().on(g)},onNodeOut:function(k,h,j,i){d=null;c.cleanUpScrollerTasks()},onNodeOver:function(k,h,j,i){return Ext.dd.DropZone.prototype.dropAllowed},onNodeDrop:function(k,h,j,i){d=null;c.cleanUpScrollerTasks()},onContainerDrop:function(i,j,h){d=null;c.cleanUpScrollerTasks()}});e.addToGroup("widgets")},cleanUpScrollerTasks:function(){for(var a in this.execScrollIdMap){if(this.execScrollIdMap[a]){window.clearInterval(a)}}this.execScrollIdMap={}},slideView:function(c){var d=this,a=d.getNodeWidth(),b=a?(a*d.slideDistance):0;this.body.scroll(c?"left":"right",b,true)},refresh:function(){var a=this;a.carouselView.refresh()},updateWidth:function(){var a=this.carouselView;if(this.rendered){Ext.Array.forEach(a.getNodes(),function(c){var b=Ext.fly(c);b.setWidth(b.getHeight())});a.getEl().setWidth(this.store.count()*this.getNodeWidth()+a.getEl().getPadding("lr")+10)}},getNodeWidth:function(){var a=Ext.fly(this.carouselView.getNode(0));return a?a.getComputedWidth()+a.getMargin("lr"):0},addWidget:function(a){if(!(this.store.findRecord("widgetGuid",a.data.widgetGuid))){this.store.add(a)}},removeWidget:function(a){if(this.store.findRecord("widgetGuid",a.data.widgetGuid)){this.store.remove(a)}},clearSelection:function(){var a=this.carouselView.getSelectionModel();this.carouselView.deselect(a.getSelection())}});