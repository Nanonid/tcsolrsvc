Ext.define("Ozone.components.tab.WidgetTabPanel",{extend:"Ext.tab.Panel",alias:"widget.widgettabpanel",initComponent:function(){var c=this,b=c.dockedItems||[],a=c.activeTab||0;c.layout=Ext.create("Ext.layout.container.Card",Ext.apply({owner:c,deferredRender:c.deferredRender,activeItem:c.activeItem?c.activeItem:0,itemCls:c.itemCls,parseActiveItem:function(d){if(!Ext.isDefined(d)){return null}else{if(d&&d.isComponent){return d}else{if(typeof d=="number"){return this.getLayoutItems()[d]}else{return this.owner.getComponent(d)}}}}},c.layout));c.tabBar=Ext.create("Ozone.components.tab.WidgetTabBar",Ext.apply({},c.tabBar,{dock:c.tabPosition,border:c.border,cardLayout:c.layout,tabPanel:c}));c.tabBar.on("render",function(d){d.layout.overflowHandler.on("scroll",function(g,f,e){this.layout.scollerResetPerformed=false},d)},this,{single:true});if(b&&!Ext.isArray(b)){b=[b]}b.push(c.tabBar);c.dockedItems=b;c.addEvents("beforetabchange","tabchange");Ozone.components.tab.WidgetTabPanel.superclass.superclass.initComponent.apply(this,arguments);c.setActiveTab(a);c.on("afterlayout",c.afterInitialLayout,c,{single:true})},onAdd:function(c,a){var b=this;c.tab=b.tabBar.insert(a,{xtype:"widgettab",card:c,cls:"widget-tab",title:c.title,itemId:c.itemId,model:c.model,stateful:false,icon:c.icon,disabled:c.disabled,closable:c.closable,hidden:c.hidden,width:200,tabBar:b.tabBar,singleton:c.singleton,listeners:{activate:{fn:function(d){this.setActiveTab(d.card,true)},scope:this},beforeclose:{fn:this.onBeforeClose,scope:this},close:{fn:function(d){this.tabBar.closeTab(d,true)},scope:this},titlechange:{fn:function(e,d,f){if(d!=f){e.suspendEvents();c.setTitle(d);e.resumeEvents()}},scope:this}}});c.on({scope:b,enable:b.onItemEnable,disable:b.onItemDisable});if(c.isPanel){if(b.removePanelHeader){c.preventHeader=true;if(c.rendered){c.updateHeader()}}if(c.isPanel&&b.border){c.setBorder(false)}}if(this.rendered&&b.items.getCount()===1){b.setActiveTab(0)}},setActiveTab:function(b,a){var d=this,c;b=d.getComponent(b);if(b){c=d.getActiveTab();if(c&&c!==b&&d.fireEvent("beforetabchange",d,b,c)===false){return false}d.tabBar.setActiveTab(b.tab,a);d.activeTab=b;if(d.rendered){d.layout.setActiveItem(b)}if(c&&c!==b){d.fireEvent("tabchange",d,b,c)}}},onItemActivate:function(a){this.tabBar.setActiveTab(a.tab)},onItemClose:function(a){this.tabBar.closeTab(a.tab)},onItemIconChange:function(b,a){b.tab.setIconCls(a);this.getTabBar().doLayout()},onItemTitleChange:function(a,b){a.tab.setTitle(b);this.getTabBar().doLayout()},onBeforeClose:function(a){if(a.card.dashboard.configRecord.get("locked")&&!a.card.model.get("floatingWidget")){Ozone.Msg.alert(Ozone.layout.DialogMessages.dashboardLockAlertTitle,Ozone.layout.DialogMessages.dashboardLockAlert,null,null,null,a.card.dashboard.dashboardContainer.modalWindowManager);return false}}});