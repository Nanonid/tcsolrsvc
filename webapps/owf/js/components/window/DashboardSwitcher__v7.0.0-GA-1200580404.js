Ext.define("Ozone.components.window.DashboardSwitcher",{extend:"Ozone.components.window.ModalWindow",alias:"widget.dashboardswitcher",closeAction:"hide",modal:true,preventHeader:true,modalAutoClose:true,shadow:false,layout:"auto",ui:"system-window",store:null,closable:false,title:"Dashboards",iconCls:"dashboard-switcher-header-icon",cls:"system-window",resizable:false,draggable:false,viewId:"dashboard-switcher-dashboard-view",dashboardContainer:null,dashboardItemHeight:0,dashboardItemWidth:0,minDashboardsWidth:3,maxDashboardsWidth:5,maxDashboardsHeight:3,storeLengthChanged:true,selectedItemCls:"dashboard-selected",_deletedStackOrDashboards:null,DROP_LEFT_CLS:"x-view-drop-indicator-left",DROP_RIGHT_CLS:"x-view-drop-indicator-right",_previouslyFocusedStackOrDashboard:null,initComponent:function(){var f=this,b=[],a={},j={},g,h,d;for(var c=0,e=f.dashboardStore.getCount();c<e;c++){d=f.dashboardStore.getAt(c);g=Ext.clone(d.data);g.model=d;j[g.guid]=g;h=g.stack;if(h){if(a[h.id]){a[h.id].dashboards.push(g)}else{h=Ext.clone(h);h.isStack=true;h.dashboards=[g];a[h.id]=h;b.push(h)}}else{b.push(g)}}f.callParent(arguments);f.stackOrDashboards=b;f.dashboards=j;f.stacks=a;f._deletedStackOrDashboards=[];f.tpl=new Ext.XTemplate('<tpl for=".">','<div id="{[this.getName(values)+this.getId(values)]}" class="{[this.getClass(values)]}" tabindex="0" data-{[this.getName(values)]}-id="{[this.getId(values)]}" {[this.getToolTip(values)]}>','<div class="thumb-wrap">','<div class="thumb {layout}">',"</div>","</div>","{[this.getActions(values)]}",'<div class="{[this.getName(values)]}-name">',"{[this.encodeAndEllipsize(values.name)]}","</div>","</div>","</tpl>",{compiled:true,getId:function(i){return i.isStack?i.id:i.guid},getClass:function(i){var k=this.getName(i);return i.guid===f.activeDashboard.id?k+" "+f.selectedItemCls:k},getName:function(i){return i.isStack?"stack":"dashboard"},getToolTip:function(k){var n="data-qtip=\"<div class='dashboard-tooltip-content'><h3 class='name'>"+Ext.htmlEncode(Ext.htmlEncode(k.name))+"</h3>";k.description&&(n+="<p class='tip-description'>"+Ext.htmlEncode(Ext.htmlEncode(k.description))+"</p><br>");if(k.isStack){return n+'</div>"'}else{if(k.groups&&k.groups.length>0){var m="";for(var l=-1;++l<k.groups.length;){if(!k.groups[l].stackDefault){m+=Ext.htmlEncode(Ext.htmlEncode(k.groups[l].name))+", "}}if(m.length>0){n=n+"<p class='group'><label>Group(s): </label>";m=m.substring(0,m.length-2);n=n+m+"</p>"}}return n+"<p class='created-by'><label>Created by: </label>"+(Ext.htmlEncode(Ext.htmlEncode(k.createdBy.userRealName))||"")+"</p><p class='last-updated'><label>Last Modified: </label>"+(k.prettyEditedDate||"")+'</p></div>"'}},getActions:function(i){return i.isStack?'<ul class="stack-actions hide"><li></li><li class="restore icon-refresh" tabindex="0" data-qtip="Restore"></li><li class="delete icon-remove" tabindex="0" data-qtip="Delete"></li><li></li></ul>':'<ul class="dashboard-actions hide"><li class="share icon-share" tabindex="0" data-qtip="Share"></li><li class="restore icon-refresh" tabindex="0" data-qtip="Restore"></li><li class="edit icon-edit" tabindex="0" data-qtip="Edit"></li><li class="delete icon-remove" tabindex="0" data-qtip="Delete"></li></ul>'},encodeAndEllipsize:function(i){return Ext.util.Format.htmlEncode(Ext.Array.map(Ext.Array.erase(/^([\S]+)\s*(.*)?/.exec(Ext.String.trim(i)),0,1),function(k){return Ext.util.Format.ellipsis(k,14)}).join(" "))}});f.stackDashboardsTpl='<div class="stack-dashboards"><div class="stack-dashboards-anchor-tip x-tip-anchor x-tip-anchor-top"></div><div class="dashboards"></div></div>';f.on("afterrender",function(i){f.tpl.overwrite(i.body,b);Ext.DomHelper.append(i.el,'<ul class="actions"><li class="manage" tabindex="0" data-qtitle="Manage" data-qtip="Activates the Share, Restore, Edit and Delete manager buttons.">Manage</li><li class="create" tabindex="0" data-qtitle="Create Dashboard" data-qtip="Name, describe and design a new dashboard.">+</li></ul>');f.bindEvents(i)});f.on("beforeclose",f.onClose,f);f.on("show",f.updateWindowSize,f);f.on("show",f.initCircularFocus,f,{single:true});f.on("show",f.focusActiveDashboard,f)},bindEvents:function(){var d=this,e=jQuery,a=e(d.el.dom);a.on("click",".dashboard",e.proxy(d.onDashboardClick,d)).on("click",".stack",e.proxy(d.onStackClick,d)).on("click",".manage",e.proxy(d.toggleManage,d)).on("click",".create",e.proxy(d.createDashboard,d)).on("mouseover",".stack, .dashboard",e.proxy(d.onMouseOver,d)).on("focus",".stack, .dashboard",e.proxy(d.onMouseOver,d)).on("click",".dashboard .restore",e.proxy(d.restoreDashboard,d)).on("click",".dashboard .share",e.proxy(d.shareDashboard,d)).on("click",".dashboard .edit",e.proxy(d.editDashboard,d)).on("click",".dashboard .delete",e.proxy(d.deleteDashboard,d)).on("click",".stack .restore",e.proxy(d.restoreStack,d)).on("click",".stack .delete",e.proxy(d.deleteStack,d));d.initKeyboardNav();var f,c,b;a.attr("unselectable","on").css("user-select","none").on("selectstart",false);a.on("mousedown",".dashboard, .stack",function(g){f=e(this);c=f.parent();b=f.clone().addClass("x-dd-drag-proxy drag-proxy");e("ul, .dashboard-name, .stack-name",b).remove();e(document.body).append(b);a.on("mouseover.reorder",".dashboard, .stack",function(h){h.preventDefault();h.stopPropagation()});e(document).on("mousemove.reorder",function(h){var j=h.pageX,i=h.pageY;b.css({left:j+15,top:i+15})});a.one("mousemove.reorder",".dashboard, .stack",function(h){var i=e(this);d._hideStackDashboardsOnMove(i)});a.on("mousemove.reorder",".dashboard, .stack",function(h){var j=e(this);if(c[0]!==j.parent()[0]){return}var l=h.pageX,i=h.pageY,m=j.offset(),k=j.outerWidth();j.removeClass(d.DROP_LEFT_CLS+" "+d.DROP_RIGHT_CLS);if(l<=m.left+(k/2)){j.addClass(d.DROP_LEFT_CLS)}else{j.addClass(d.DROP_RIGHT_CLS)}});a.on("mouseleave.reorder",".dashboard, .stack",function(h){e(this).removeClass(d.DROP_LEFT_CLS+" "+d.DROP_RIGHT_CLS)});a.on("mouseup.reorder",".dashboard",function(h){d._dropOnDashboard(f,e(this))});a.on("mouseup.reorder",".stack",function(h){d._dropOnStack(f,e(this))});e(document).on("mouseup.reorder",function(h){f=null;c=null;b.remove();e(document).off(".reorder");a.off(".reorder")})})},_hideStackDashboardsOnMove:function(a){if(!(a.parent().hasClass("dashboards"))){this.hideStackDashboards()}},initKeyboardNav:function(){var b=this;function a(e,f){f.hasClass("stack")?b._dropOnStack(e,f):b._dropOnDashboard(e,f)}function d(){var f=$(this),e=f.prev(),g;if(e.length===1&&!e.hasClass("dashboard")&&!e.hasClass("stack")){e=e.prev()}if(e.length===0){return}e.addClass(b.DROP_LEFT_CLS);if(g=b._hideStackDashboardsOnMove(f)){g.then(function(){a(f,e)})}else{a(f,e)}}function c(){var f=$(this),e=f.next(),g;if(e.length===1&&!e.hasClass("dashboard")&&!e.hasClass("stack")){e=e.next()}if(e.length===0){return}e.addClass(b.DROP_RIGHT_CLS);if(g=b._hideStackDashboardsOnMove(f)){g.then(function(){a(f,e)})}else{a(f,e)}}$(b.el.dom).on("keyup",".stack",function(e){if(e.which===Ext.EventObject.ENTER){b.onStackClick(e)}else{if(e.which==219){d.call(this)}else{if(e.which==221){c.call(this)}}}}).on("keyup",".dashboard",function(e){if(e.which===Ext.EventObject.ENTER){b.onDashboardClick(e)}else{if(e.which==219){d.call(this)}else{if(e.which==221){c.call(this)}}}}).on("focus",".dashboard, .stack",function(e){$(e.currentTarget).addClass(b.selectedItemCls)}).on("blur",".dashboard, .stack",function(e){b._previouslyFocusedStackOrDashboard=$(e.currentTarget).removeClass(b.selectedItemCls)}).on("focus",".dashboard-actions li, .stack-actions li",function(e){$(e.currentTarget).addClass("hover")}).on("blur",".dashboard-actions li, .stack-actions li",function(e){$(e.currentTarget).removeClass("hover")}).on("keyup",".dashboard-actions .restore",function(e){if(e.which===Ext.EventObject.ENTER){b.restoreDashboard(e)}}).on("keyup",".dashboard-actions .share",function(e){if(e.which===Ext.EventObject.ENTER){b.shareDashboard(e)}}).on("keyup",".dashboard-actions .edit",function(e){if(e.which===Ext.EventObject.ENTER){b.editDashboard(e)}}).on("keyup",".dashboard-actions .delete",function(e){if(e.which===Ext.EventObject.ENTER){b.deleteDashboard(e)}}).on("keyup",".stack-actions .restore",function(e){if(e.which===Ext.EventObject.ENTER){b.restoreStack(e)}}).on("keyup",".stack-actions .delete",function(e){if(e.which===Ext.EventObject.ENTER){b.deleteStack(e)}}).on("focus",".manage",function(e){$(e.currentTarget).addClass("selected")}).on("blur",".manage",function(e){if(!b._managing){$(e.currentTarget).removeClass("selected")}}).on("focus",".create",function(e){$(e.currentTarget).addClass("selected")}).on("blur",".create",function(e){$(e.currentTarget).removeClass("selected")}).on("keyup",".manage",function(e){if(e.which===Ext.EventObject.ENTER){b.toggleManage(e);$(e.currentTarget).addClass("selected")}}).on("keyup",".create",function(e){if(e.which===Ext.EventObject.ENTER){b.createDashboard(e)}})},_dropOnDashboard:function(c,j){var k=this,m=k.getDashboard(j),f;if(j[0]===c[0]){j.removeClass(k.DROP_LEFT_CLS+" "+k.DROP_RIGHT_CLS);return}var d=j.hasClass(k.DROP_LEFT_CLS);var o=k.dashboardStore,p,n;n=c.index();if(d){j.removeClass(k.DROP_LEFT_CLS);c.insertBefore(j)}else{j.removeClass(k.DROP_RIGHT_CLS);c.insertAfter(j)}p=c.index();if(c.hasClass("dashboard")){f=k.getDashboard(c);o.remove(f.model,true);var h=o.indexOf(m.model);if(!d){h++}o.insert(h,f.model);if(f.stack){var l=k.stacks[f.stack.id];l.dashboards.splice(p,0,l.dashboards.splice(n,1)[0])}}else{f=k.getStack(c);var b=f.dashboards,a;for(var e=0,g=b.length;e<g;e++){a=b[e];o.remove(a.model,true)}h=o.indexOf(m.model);if(!d){h++}for(var e=0,g=b.length;e<g;e++){a=b[e];o.insert(h++,a.model)}}c.focus();k.initCircularFocus();k.reordered=true},_dropOnStack:function(d,n){var o=this,p=o.getStack(n),g;if(n[0]===d[0]){n.removeClass(o.DROP_LEFT_CLS+" "+o.DROP_RIGHT_CLS);return}q=o.dashboardStore;var e=n.hasClass(o.DROP_LEFT_CLS);var q=o.dashboardStore;if(d.hasClass("dashboard")){g=o.getDashboard(d);q.remove(g.model,true);var k;if(e){k=q.indexOf(p.dashboards[0].model)}else{var c=n.next();if(c.length===1&&!c.hasClass("dashboard")&&!c.hasClass("stack")){c=c.next()}if(c.length===1){if(c.hasClass("dashboard")){var j=o.getDashboard(c);k=q.indexOf(j.model)}else{var l=o.getStack(c);k=q.indexOf(l.dashboards[0].model)}}else{var m=p.dashboards[p.dashboards.length-1];k=q.indexOf(m.model);k++}}q.insert(k,g.model)}else{g=o.getStack(d);var b=g.dashboards,a;for(var f=0,h=b.length;f<h;f++){a=b[f];q.remove(a.model,true)}if(e){k=q.indexOf(p.dashboards[0].model)}else{var c=n.next();if(c.length===1){if(c.hasClass("dashboard")){var j=o.getDashboard(c);k=q.indexOf(j.model)}else{var l=o.getStack(c);k=q.indexOf(l.dashboards[0].model)}}else{var m=p.dashboards[p.dashboards.length-1];k=q.indexOf(m.model);k++}}for(var f=0,h=b.length;f<h;f++){a=b[f];q.insert(k++,a.model)}}if(e){n.removeClass(o.DROP_LEFT_CLS);d.insertBefore(n)}else{n.removeClass(o.DROP_RIGHT_CLS);d.insertAfter(n)}d.focus();o.initCircularFocus();o.reordered=true},initCircularFocus:function(){var a=this.body.first(),b=this.el.last().last();this.tearDownCircularFocus();this.setupFocus(a,b)},focusActiveDashboard:function(){var b=this,d=this.activeDashboard.id,c=$("#dashboard"+d);if(c.length===0){var a=this.activeDashboard.configRecord.get("stack").id;this.toggleStack(this.stacks[a],$("#stack"+a)).then(function(){b.focusActiveDashboard()});return}setTimeout(function(){c&&c.focus()},500)},getDashboard:function(a){return this.dashboards[a.attr("data-dashboard-id")]},getStack:function(a){return this.stacks[a.attr("data-stack-id")]},getElByClassFromEvent:function(b,a){var c=$(b.currentTarget||b.target);return c.hasClass("cls")?c:c.parents("."+a)},onDashboardClick:function(a){if((a.type!=="click"&&a.which!==Ext.EventObject.ENTER)||this._managing===true){return}var d=$(a.currentTarget),b=this.getDashboard(d);var c=b.stack?b.stack.stackContext:null;this.activateDashboard(b.guid,c);d.addClass(this.selectedItemCls);if(this._$lastClickedDashboard){this._$lastClickedDashboard.removeClass(this.selectedItemCls)}this._$lastClickedDashboard=d},onStackClick:function(b){if(b.type==="click"||b.which===Ext.EventObject.ENTER){var d=this,e=jQuery,c=e(b.currentTarget),a=d.getStack(c);if(a){d.toggleStack(a,c)}b.preventDefault()}},toggleStack:function(b,d){var c=this,a=$.Deferred();if(c._lastExpandedStack){if(c._lastExpandedStack===b){return c.hideStackDashboards()}else{c.hideStackDashboards().then(function(){c.showStackDashboards(b,d,a)})}}else{c.showStackDashboards(b,d,a)}return a.promise()},showStackDashboards:function(k,q,o){var h=this,g=q.outerWidth(true),d=q.outerHeight(true),m=q.parent(),n=m.outerWidth(true),a;var c=Math.round(n/g),p=$(h.body.dom).children(".dashboard, .stack").length,f=q.index()+1;if(f===p||(f%c)===0){a=q}else{var e=f;while((e%c)!==0){e++;if(e>=p){break}}a=m.children().eq(e-1)}this.$stackDashboards=$(this.stackDashboardsTpl);this.$stackDashboards.children(".dashboards").html(this.tpl.applyTemplate(k.dashboards));this.$stackDashboards.insertAfter(a);this.stackDashboardsAnchorTip=$(".stack-dashboards-anchor-tip",this.$stackDashboards);if(!this.stackDashboardsAnchorTipHeight){this.stackDashboardsAnchorTipHeight=this.stackDashboardsAnchorTip.outerHeight()}if(!this.stackDashboardsAnchorTipWidth){this.stackDashboardsAnchorTipWidth=this.stackDashboardsAnchorTip.outerWidth()}this.$stackDashboards.hide();var l=q.position(),j=l.top+d-(this.stackDashboardsAnchorTipHeight),b=l.left+(g/2)-(this.stackDashboardsAnchorTipWidth/2);this.stackDashboardsAnchorTip.css({left:b+"px"});if(Ext.isIE7||Ext.isIE8){this.$stackDashboards.show();o.resolve()}else{this.$stackDashboards.slideDown("fast").promise().then(function(){o.resolve()})}this._lastExpandedStack=k},hideStackDashboards:function(){var b=this;if(!this.$stackDashboards){var a=$.Deferred();a.resolve();return a.promise()}if(Ext.isIE7||Ext.isIE8){var a=$.Deferred();this.$stackDashboards&&this.$stackDashboards.hide();a.resolve();this.$stackDashboards.remove();this._lastExpandedStack=null;return a.promise()}else{var c=this.$stackDashboards.slideUp("fast").promise();c.then(function(){b.$stackDashboards.remove();b._lastExpandedStack=null});return c}},onMouseOver:function(a){var b,c=jQuery;if(!this._managing){return}b=c(a.currentTarget);if(this._lastManageEl){if(b[0]===this._lastManageEl[0]){return}else{c("ul",this._lastManageEl).addClass("hide")}}this._lastManageEl=b;c("ul",this._lastManageEl).removeClass("hide");c(".dashboard, .stack",this.el.dom).css("height",b.height()+"px")},updateDashboardEl:function(c,a){var b=$(this.tpl.apply([a])).insertBefore(c);c.remove();b.focus()},updateStackDashboardsEl:function(a){if(this.$stackDashboards){this.$stackDashboards.children(".dashboards").html(this.tpl.applyTemplate(a.dashboards))}},toggleManage:function(a){var b;if(a){b=$(a.currentTarget);this.$manageBtn=b}if(this._managing){this.resetManage();this._managing=false}else{b&&b.addClass("selected");this._managing=true;if(this._previouslyFocusedStackOrDashboard){this._previouslyFocusedStackOrDashboard.trigger("mouseover")}}},resetManage:function(){if(!this._managing){return}this.$manageBtn.removeClass("selected");$(".dashboard, .stack",this.el.dom).css("height","");if(this._lastManageEl){$("ul",this._lastManageEl).addClass("hide");this._lastManageEl=null}this._managing=false},restoreDashboard:function(a){a.stopPropagation();var d=this,e=this.getElByClassFromEvent(a,"dashboard"),b=this.getDashboard(e),c=b.guid;this.warn('This action will return the dashboard <span class="heading-bold">'+Ext.htmlEncode(b.name)+"</span> to its current default state. If an administrator changed the dashboard after it was assigned to you, the default state may differ from the one that originally appeared in your Switcher.",function(){Ext.Ajax.request({url:Ozone.util.contextPath()+"/dashboard/restore",params:{guid:c,isdefault:c==d.activeDashboard.guid},success:function(f,j){var h=Ext.decode(f.responseText);if(h!=null&&h.data!=null&&h.data.length>0){d.notify("Restore Dashboard",'<span class="heading-bold">'+Ext.htmlEncode(b.name)+"</span> is restored successfully to its default state!");var g=h.data[0].name,i=h.data[0].description;b.model.set({name:g,description:i});b.name=g;b.description=g;d.updateDashboardEl(e,b);d.reloadDashboards=true}},failure:function(f,g){Ozone.Msg.alert("Dashboard Manager","Error restoring dashboard.",function(){Ext.defer(function(){e[0].focus()},200,d)},d,null,d.dashboardContainer.modalWindowManager);return}})},function(){a.currentTarget.focus()})},shareDashboard:function(i){i.stopPropagation();var g=this.getElByClassFromEvent(i,"dashboard"),b=this.getDashboard(g).guid,d=this.dashboardContainer.dashboardStore.find("guid",b),h=this.dashboardContainer.dashboardStore.getAt(d).data,c=h.model;if(this.dashboardContainer.activeDashboard.configRecord.data.guid===h.guid){h=this.dashboardContainer.activeDashboard.getJson()}delete h.model;var j=Ozone.util.cloneDashboard(h,false,true);h.model=c;Ext.EventManager.un(window,"beforeunload",this.dashboardContainer.onBeforeUnload);var a=document.createElement("form");var f=document.createElement("input");f.id="json";f.name="json";f.type="hidden";f.value=Ext.JSON.encode(j);a.appendChild(f);a.action=Ozone.util.contextPath()+"/servlet/ExportServlet";a.method="POST";a.enctype=a.encoding="multipart/form-data";document.body.appendChild(a);a.submit();document.body.removeChild(a);a=null;f=null;var e=this;setTimeout(function(){Ext.EventManager.on(window,"beforeunload",e.dashboardContainer.onBeforeUnload,e.dashboardContainer)},100)},createDashboard:function(a){var b=this,c=Ext.widget("createdashboardwindow",{itemId:"createDashWindow",dashboardContainer:b.dashboardContainer,ownerCt:b.dashboardContainer});c.show();b.close()},editDashboard:function(a){a.stopPropagation();var d=this,e=this.getElByClassFromEvent(a,"dashboard"),b=this.getDashboard(e);var c=Ext.widget("createdashboardwindow",{itemId:"editDashWindow",title:"Edit Dashboard",height:250,dashboardContainer:this.dashboardContainer,ownerCt:this.dashboardContainer,hideViewSelectRadio:true,existingDashboardRecord:b.model}).show();this.close()},deleteDashboard:function(a){a.stopPropagation();var d=this,f=this.getElByClassFromEvent(a,"dashboard"),c=this.getDashboard(f),e;function b(){a.currentTarget.focus()}if(c.stack){this.warn("Users cannot remove individual dashboards from a stack. Please contact your administrator.",b);return}if(c.groups&&c.groups.length>0){this.warn("Users cannot remove dashboards assigned to a group. Please contact your administrator.",b);return}e='This action will permanently delete <span class="heading-bold">'+Ext.htmlEncode(c.name)+"</span>.";this.warn(e,function(){d.dashboardStore.remove(c.model);d.dashboardStore.save();d.notify("Delete Dashboard",'<span class="heading-bold">'+Ext.htmlEncode(c.name)+"</span> deleted!");d._deletedStackOrDashboards.push(c);d.reloadDashboards=true;var g=f.prev();f.remove();g.focus()},b)},restoreStack:function(b){b.stopPropagation();var c=this,d=this.getElByClassFromEvent(b,"stack"),a=this.getStack(d);this.warn('This action will return the stack <span class="heading-bold">'+Ext.htmlEncode(a.name)+"</span> to its current default state. If an administrator changed any dashboard in the stack after it was assigned to you, the default state may differ from the one that originally appeared in your Switcher.",function(){Ext.Ajax.request({url:Ozone.util.contextPath()+"/stack/restore",params:{id:a.id},success:function(e,k){var h=Ext.decode(e.responseText);if(h!=null&&h.updatedDashboards!=null&&h.updatedDashboards.length>0){c.notify("Restore Stack",'<span class="heading-bold">'+Ext.htmlEncode(a.name)+"</span> is restored successfully to its default state!");var l=a.dashboards;for(var g=0;g<l.length;g++){for(var f=0;f<h.updatedDashboards.length;f++){var m=h.updatedDashboards[f];if(m.guid==l[g].guid){l[g].model.set({name:m.name,description:m.description});l[g].name=m.name;l[g].description=m.description}}}c.updateStackDashboardsEl(a);c.reloadDashboards=true;d.focus()}},failure:function(e,f){Ozone.Msg.alert("Dashboard Manager","Error restoring stack.",function(){Ext.defer(function(){d[0].focus()},200,c)},c,null,c.dashboardContainer.modalWindowManager);return}})},function(){b.currentTarget.focus()})},deleteStack:function(q){q.stopPropagation();var n=this,m=this.getElByClassFromEvent(q,"stack"),o=this.getStack(m),b='This action will permanently delete stack <span class="heading-bold">'+Ext.htmlEncode(o.name)+"</span> and its dashboards.";function l(){q.currentTarget.focus()}var c=o.groups,p=Ozone.config.user.groups,k=false;if(c&&p&&c.length>0&&p.length>0){for(var g=0,f=c.length;g<f;g++){var a=c[g];for(var e=0,d=p.length;e<d;e++){var h=p[e];if(a.id===h.id){k=true;break}}if(k===true){break}}}if(k){this.warn("Users in a group cannot remove stacks assigned to the group. Please contact your administrator.",l);return}this.warn(b,function(){n.dashboardContainer.stackStore.remove(n.dashboardContainer.stackStore.getById(o.id));n.dashboardContainer.stackStore.save();if(n._lastExpandedStack===o){n.hideStackDashboards()}var i=m.prev();m.remove();i.focus();n._deletedStackOrDashboards.push(o);n.reloadDashboards=true},l)},warn:function(c,b,a){Ext.widget("alertwindow",{title:"Warning",html:c,minHeight:115,width:250,dashboardContainer:this.dashboardContainer,okFn:b,cancelFn:a,showCancelButton:!!a}).show()},notify:function(d,c,b){var a={dir1:"up",dir2:"left",firstpos1:25,firstpos2:25};$.pnotify({title:d,text:c,type:b||"success",addclass:"stack-bottomright",stack:a,history:false,sticker:false,icon:false,delay:3000})},activateDashboard:function(a,b){this.close();this.dashboardContainer.activateDashboard(a,false,b)},updateWindowSize:function(){var d,a,h=this.body.first().dom;if(!h){return}var e=Ext.get(h),f=this.getEl(),c=e.getMargin("lr"),i=e.getMargin("tb"),b=this.body.query("> .dashboard, > .stack").length,g=0;this.dashboardItemWidth=e.getWidth();this.dashboardItemHeight=e.getHeight();if(b<this.minDashboardsWidth){g=this.minDashboardsWidth}else{if(b>this.maxDashboardsWidth){g=this.maxDashboardsWidth}else{g=b}}d=(this.dashboardItemWidth+c+1)*g;if(b>this.maxDashboardsWidth*this.maxDashboardsHeight){d+=30}if(b>this.maxDashboardsWidth*this.maxDashboardsHeight){a=(this.dashboardItemHeight+i)*this.maxDashboardsHeight}this.body.setSize(d+30,a);this.body.setStyle({"max-height":((this.dashboardItemHeight+i+1)*this.maxDashboardsHeight)+40+"px"})},saveDashboardOrder:function(){var a=$.Deferred();var d=this.dashboardStore.data.items;var b=[];var e=[];for(var c=0;c<d.length;c++){if(!d[c].data.removed){b.push({guid:d[c].data.guid,isdefault:d[c].data.isdefault,name:d[c].data.name.replace(new RegExp(Ozone.lang.regexLeadingTailingSpaceChars),"")})}else{e.push(d[c].data.guid)}}Ozone.pref.PrefServer.updateAndDeleteDashboards({viewsToUpdate:b,viewGuidsToDelete:e,updateOrder:true,onSuccess:function(){a.resolve()},onFailure:function(){a.reject()}});return a.promise()},onClose:function(){var a=this;a.resetManage();if(a.dashboardContainer.dashboardStore.getCount()===0){window.location.reload();return}if(a.reordered){if(a.reloadDashboards){a.saveDashboardOrder().always(function(){a.dashboardContainer.reloadDashboards()})}else{a.saveDashboardOrder().fail(function(){a.dashboardContainer.reloadDashboards()})}}else{if(a.reloadDashboards===true){a.dashboardContainer.reloadDashboards()}}},destroy:function(){this.tearDownCircularFocus();$(this.el.dom).off();return this.callParent()}});