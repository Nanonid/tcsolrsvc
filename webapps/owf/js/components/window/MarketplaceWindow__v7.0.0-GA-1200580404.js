Ext.define("Ozone.components.window.MarketplaceWindow",{extend:"Ozone.components.window.ModalWindow",alias:["widget.marketplacewindow","widget.Ozone.components.window.MarketplaceWindow"],title:"Marketplaces",id:"marketplaceWindow",cls:"system-window settings-window",ui:"system-window",iconCls:"marketplace-header-icon",layout:"auto",closable:false,resizable:false,draggable:false,modal:true,modalAutoClose:true,shadow:false,autoScroll:false,minToolsInRow:3,maxToolsInRow:5,dashboardContainer:null,plugins:[new Ozone.components.keys.HotKeyComponent(Ozone.components.keys.HotKeys.MARKETPLACE),new Ozone.components.draggable.DraggableWidgetView({itemSelector:".tool",dragNodeSelector:".thumb-wrap"})],store:null,initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"name",sortType:Ext.data.SortTypes.asUCString},"image","caption","guid","singleton"]});a.dashboardContainer.activeDashboard.widgetStore.each(function(b){var c=b.get("widgetTypes");if(c.length>0&&c[0].name=="marketplace"&&b.get("definitionVisible")){a.store.add(b)}});a.store.sort("name","ASC");this.view=Ext.create("Ozone.components.view.ToolDataView",{store:this.store,multiSelect:false,singleSelect:true,autoScroll:true,listeners:{refresh:{fn:this.setupModalFocus,scope:this},viewready:{fn:this.updateWindowSize,scope:this,single:true}}});this.items=[this.view];this.on("resize",this.center,this);this.callParent(arguments)},setupModalFocus:function(){var a=this.down("tooldataview");this.setupFocus(Ext.get(a.getNode(0)),Ext.get(a.getNode(a.store.getCount()-1)));Ext.defer(function(){var b=a.getNode(0);if(b){Ext.get(b).focus()}},100)},callBtnHandler:function(c,b,a){this.close();this.dashboardContainer.launchWidgets(this.store.getAt(this.store.find("name",c)),a)},updateWindowSize:function(e){var h,d,c;c=e.getNode(0);if(!c){return}var b=Ext.get(c),f=b.getMargin("r"),a=e.getStore().getCount(),g=0;h=b.getWidth();if(a<this.minToolsInRow){g=this.minToolsInRow}else{if(a>this.maxToolsInRow){g=this.maxToolsInRow}else{g=a}}d=(h+f)*g;this.view.doComponentLayout(d)}});