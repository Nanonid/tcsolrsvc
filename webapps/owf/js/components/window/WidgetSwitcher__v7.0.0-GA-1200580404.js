Ext.define("Ozone.components.window.WidgetSwitcher",{extend:"Ozone.components.window.ModalWindow",alias:"widget.widgetswitcher",closeAction:"hide",modal:true,modalAutoClose:true,width:520,preventHeader:true,shadow:false,ui:"system-window",store:null,dashboard:null,viewId:"widget-switcher-widgets-view",noWidgetsViewId:"widget-switcher-no-widgets",activateWidget:function(b,a,f,c,e,d){this.close();this.activeDashboard.activateWidget(a.data.uniqueId,true,true);if(!a.data.background){Ext.getCmp(a.data.uniqueId).focus(false,false,true,true)}else{this.confirmRemoveBackgroundWidget(a)}},showNoWidgetsView:function(){if(this.view){this.view.getEl().hide()}if(!this.noWidgetsView){this.noWidgetsView=Ext.create("Ext.Component",{itemId:this.noWidgetsViewId,autoEl:{tag:"span",tabIndex:"0",html:"No open widgets found!"}});this.add(this.noWidgetsView);this.noWidgetsView.keynav=new Ext.util.KeyNav(this.noWidgetsView.getEl(),{tab:function(a){this.focus()},scope:this.noWidgetsView});Ozone.components.focusable.Focusable.clearOutline(this.noWidgetsView.getEl())}else{this.noWidgetsView.getEl().setVisible()}this.noWidgetsView.focus()},setStore:function(a){var d=a.getCount()-1,b,e=[];b=Ext.create("Ext.data.Store",{proxy:{type:"memory",reader:{type:"json",root:"."}}});while(d>-1){var c=this.widgetStore.getById(a.getAt(d).get("widgetGuid"));if(c){if(c.get("background")){e.push(a.data.items[d])}else{b.add(a.data.items[d])}}d-=1}b.add(e);if(b.getCount()>0){if(this.noWidgetsView){this.noWidgetsView.getEl().hide()}if(this.view){this.view.getEl().setVisible()}else{this.add(this.initView())}this.view.bindStore(b)}else{this.showNoWidgetsView()}},initView:function(){var a=this;if(this.view){return this.view}this.view=Ext.create("Ozone.components.focusable.FocusableView",{itemId:this.viewId,itemSelector:".widget",overItemCls:"widget-over",selectedItemCls:"widget-selected",trackOver:true,singleSelect:true,tpl:new Ext.XTemplate('<tpl for=".">','<div class="widget" tabindex="0" data-qtip="{[Ext.htmlEncode(Ext.htmlEncode(values.name))]}">','<div class="thumb-wrap">','<img src="{[this.getIcon(xindex, values)]}" class="thumb" />',"</div>",'<div class="thumb-text">{[Ext.String.ellipsis(Ext.htmlEncode(values.name),20,false)]}</div>',"</div>","</tpl>",{compiled:true,getIcon:function(d,b){var c=a.activeDashboard.widgetStore.getById(b.widgetGuid).data.image;return c}})});this.view.on("itemclick",this.activateWidget,this);this.view.on("itemkeydown",function(c,b,g,d,f,e){switch(f.getKey()){case f.ENTER:case f.SPACE:f.preventDefault();this.activateWidget(c,b,g,d,f,e)}},this);this.view.on("viewready",function(){var b,c=this;if(this.getStore().getCount()>0){this.widgetEls=this.getEl().query(this.itemSelector);b=this.widgetEls[0];if(b){setTimeout(function(){c.getNode(0).focus()},100)}}},this.view);this.view.on("refresh",function(){var c=this.view.getEl().query(this.view.itemSelector),b=c.length;if(b>0){this.setupFocus(Ext.get(c[0]),Ext.get(c[b-1]))}},this);return this.view},confirmRemoveBackgroundWidget:function(a){var b=this;Ext.widget("alertwindow",{title:"Warning",html:"<i>"+Ext.htmlEncode(a.get("name"))+"</i>"+Ozone.layout.DialogMessages.closeBackgroundWidgetWarning,width:400,dashboardContainer:b.activeDashboard.dashboardContainer,okFn:function(){var d=Ext.getCmp(a.get("paneGuid")).stateStore,c=b.activeDashboard.stateStore;d.remove(d.findRecord("uniqueId",a.get("uniqueId")))}}).show()}});