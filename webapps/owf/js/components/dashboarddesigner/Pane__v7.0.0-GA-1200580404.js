Ext.define("Ozone.components.dashboarddesigner.Pane",{extend:"Ext.container.Container",alias:["widget.dashboarddesignerpane","widget.Ozone.components.dashboarddesigner.Pane"],layout:{type:"fit"},componentCls:"dashboarddesignerpane droppable",paneType:null,initComponent:function(){if(this.htmlText){this.html="<h3>"+Ext.htmlEncode(this.htmlText)+"</h3>"}if(this.paneType){this.componentCls+=" "+this.paneType}this.listeners={afterrender:{fn:this.onAfterPaneRender,scope:this},destroy:function(){this.el.removeAllListeners()}};this.addEvents("paneselect");this.enableBubble(["paneselect"]);this.callParent(arguments)},getBubbleTarget:function(){return this.up("dashboarddesignerworkingarea")},onAfterPaneRender:function(){var a=this,b=true;this.textEl=this.el.down("h3");this.el.set({tabIndex:0});this.el.on({mousedown:function(){b=false},mouseup:function(){b=true},focus:function(c,d){if(b){Ext.fly(d).addCls("highlight-dashboard-designer-drop")}},blur:function(c,d){if(b){Ext.fly(d).removeCls("highlight-dashboard-designer-drop")}},click:a.showBoxLayout,scope:a});if(this.textEl){this.enableEditing()}},showBoxLayout:function(a,b){this.fireEvent("paneselect",this)},onKeyUp:function(a,b){if(a.getKey()===Ext.EventObject.ENTER&&b.nodeName!=="INPUT"){this.fireEvent("paneselect",this);this.disableEditing();this.startEdit(a,this.textEl)}},enableEditing:function(){if(this._editingEnabled||!this.textEl){return}this.el.on("dblclick",this.startEdit,this,{delegate:"h3"});this.el.on("keyup",this.onKeyUp,this);this._editingEnabled=true},disableEditing:function(){this.el.un("dblclick",this.startEdit,this,{delegate:"h3"});this.el.un("keyup",this.onKeyUp,this);this._editingEnabled=false},startEdit:function(a,b){a.stopEvent();this.editor=this.editor||new Ext.Editor({updateEl:true,shadow:false,floating:false,revertInvalid:false,field:{xtype:"textfield",validator:function(d){var c=parseFloat(d);if(isNaN(c)){return"Nice try! Invalid input, please enter a valid value. For example, 400px or 50%."}if(d.charAt(d.length-1)==="%"){if(c<=0){return"Width/Height of 0% or lower is not allowed"}else{if(c>=100){return"Width/Height of 100% or higher is not allowed"}}}else{if(c<36){return"Minimum width/height allowed is 36px"}}return true}},listeners:{complete:this.editComplete,canceledit:this.resetFocus,scope:this},parentEl:this.el});this.editor.startEdit(Ext.get(b))},editComplete:function(f,g,d){var c=this.el.getWidth(),b=parseFloat(g),e=this.getNextPane(),h,a;if(g.charAt(g.length-1)==="%"){this.initialConfig.flex=this.flex=b/100;h=(100-b)+"%";e.initialConfig.flex=e.flex=(100-b)/100;if(e.textEl){e.textEl.update(h)}this.initialConfig.htmlText=b+"%";e.initialConfig.htmlText=h}else{delete this.initialConfig.flex;delete this.flex;a=this.ownerCt.initialConfig.layout&&this.ownerCt.initialConfig.layout.type==="hbox";if(a){this.initialConfig.width=b;this.width=b}else{this.initialConfig.height=b;this.height=b}this.initialConfig.htmlText=b+"px";e.initialConfig.htmlText="Variable";if(e.textEl){e.textEl.update("Variable")}e.initialConfig.flex=e.flex=1}this.textEl.update(this.initialConfig.htmlText);this.up("container").doLayout();this.resetFocus()},resetFocus:function(){var a=this;Ext.defer(function(){a.el.focus();a.enableEditing()},100)},getNextPane:function(){if(this.next()&&this.next().next()){return this.next().next()}else{if(this.prev()&&this.prev().prev()){return this.prev().prev()}}return null}});