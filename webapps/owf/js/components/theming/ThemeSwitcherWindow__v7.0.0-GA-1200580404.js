Ext.define("Ozone.components.theming.ThemeSwitcherWindow",{extend:"Ozone.components.window.ModalWindow",alias:"widget.themeswitcherwindow",id:"themeSwitcher",iconCls:"themeSwitcher-header-icon",modalAutoClose:true,selectedTheme:null,initComponent:function(){this.items=[{xtype:"themebrowser",id:"theme-browser-view",itemId:"theme-browser-view",region:"center",autoScroll:true,listeners:{scope:this,selectionchange:function(){this.scrollToSelectedTheme.apply(this,arguments);this.onThemeSelect.apply(this,arguments)},itemkeydown:function(d,c,e,a,b){if(b.getKey()===b.ENTER||b.getKey()===b.SPACE){this.applyTheme()}}}},{xtype:"themeinfopanel",id:"theme-info-panel",region:"east",split:true,preventHeader:true}];this.okBtn=Ext.widget("button",{itemId:"okBtn",text:Ozone.layout.ThemeSwitcherWindowConstants.ok,disabled:true,scope:this,handler:function(){this.close();this.applyTheme()}});this.cancelBtn=Ext.widget("button",{xtype:"button",itemId:"cancelBtn",text:Ozone.layout.ThemeSwitcherWindowConstants.cancel,scope:this,handler:function(){this.close()}});this.dockedItems=[{xtype:"toolbar",dock:"bottom",defaults:{minWidth:60},layout:{type:"hbox",pack:"end"},items:[this.okBtn,this.cancelBtn]}];this.on("afterrender",function(c){var a=c.getComponent("theme-browser-view"),b=a.getStore();c.setupFocus(a.getEl(),c.cancelBtn.getEl());b.on("load",function(d){record=d.find("name",Ozone.config.currentTheme.themeName);this.select(record)},a);a.getSelectionModel().deselectOnContainerClick=false});this.on("resize",function(){this.syncShadow()});this.callParent(arguments)},onThemeSelect:function(a,c){var b=c[0],d=this.down("themeinfopanel");if(b){this.selectedTheme=b;this.okBtn.enable();d.loadThemeInfo(b)}},applyTheme:function(){if(this.selectedTheme&&this.selectedTheme.data&&this.selectedTheme.data.css){Ozone.pref.PrefServer.setUserPreference({namespace:"owf",name:"selected_theme",value:this.selectedTheme.data.name,onSuccess:Ext.bind(function(){window.location.reload()},this)})}},scrollToSelectedTheme:function(){var a=this.down("themebrowser"),b=a.getSelectedNodes()[0];if(b){offsets=Ext.get(b).getOffsetsTo(a.getEl());a.getEl().scroll("b",offsets[1],true)}}});