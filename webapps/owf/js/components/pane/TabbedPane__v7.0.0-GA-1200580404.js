Ext.define("Ozone.components.pane.TabbedPane",{extend:"Ozone.components.pane.Pane",alias:["widget.tabbedpane","widget.Ozone.components.pane.TabbedPane"],plugins:[new Ozone.plugins.pane.TabbedPane()],activeWidget:null,layout:"fit",componentCls:"tabbedpane pane",type:"tabbed",widgetCls:"x-portlet",initComponent:function(){var a=this;a.tabPanel=Ext.widget("widgettabpanel",{cls:"tab-dashboard-panel",enableTabScroll:true,layoutOnTabChange:true,deferredRender:true,defaults:{closable:true},autoScroll:false,border:false,split:false,activeTab:0,listeners:{add:a.onTabWidgetAdd,tabchange:{fn:function(c,b){if(b.getIframeEl()){a.activateWidget(b,false,true)}}},scope:a}});a.items=[a.tabPanel];a.callParent(arguments)},getWidgets:function(){var d=Ext.clone(this.tabPanel.items.items),c=this.stateStore;for(var b=0,a=c.getCount();b<a;b++){if(c.getAt(b).data.floatingWidget){d.push(Ext.getCmp(c.getAt(b).data.uniqueId))}}return d},activateWidget:function(b,a,c){this.tabPanel.setActiveTab(b);b.focus(false,false,a,c);this.dashboard.updateActiveWidget(b);return true},launchPreviouslyOpenedWidgets:function(){this._launchingPreviouslyOpenedWidgets=true;var a=this.launchWidgets(this.stateStore.data.items);delete this._launchingPreviouslyOpenedWidgets;this.tabPanel.setActiveTab(this.activeWidgetGuid);return a},launchWidget:function(c,h,g,e,a,d){var f=this,i,b;i=f.createWidgetConfig(c,e,a);i=Ext.Object.merge(i,{xtype:"widgetpanel",x:0,y:0,zIndex:0,active:c.get("active"),layout:"fit",minimized:false,maximized:false,pinned:false,collapsed:false,frame:false,border:false,getFirstFocusableElement:function(){var j=this.ownerCt.getTabBar();if(j!=null){return j.getComponent(this.id)}},getBubbleTarget:function(){return f.tabPanel},listeners:{render:f.onTabWidgetRender}});if(i.active){f.activeWidgetGuid=i.id}b=Ext.isNumber(d)?f.tabPanel.insert(d,i):f.tabPanel.add(i);b.on("statesave",function(k,j){this.defaultSettings.widgetStates=this.defaultSettings.widgetStates||{};this.defaultSettings.widgetStates[j.widgetGuid]={timestamp:Ext.Date.now()}},this);f.tabPanel.setActiveTab(i.id);b.fireEvent("statesave",b,{widgetGuid:b.widgetGuid});return b.deferred.promise()},onTabWidgetRender:function(a){a.headers=[a.tab.header];a.addDocked({xtype:"focuscatch",dock:"top",itemId:"frontFocusCatch"})},onTabWidgetAdd:function(a,d,b){function c(){d.tearDownCircularFocus();d.tab.tearDownCircularFocus();d.tab.getComponent("focusCatch").destroy();this.setupTabbedCircularFocus(d)}if(a!==this.tabPanel){return}if(d.rendered){c.call(this)}else{d.on("afterrender",function(e){Ext.defer(c,1,this)},this)}},setupTabbedCircularFocus:function(b){var g=b.tab,d=g.getEl().select("*").filter(function(h){return h.dom.tabIndex===0}),c=Ext.get(g.getEl().select(".x-tool img").last().dom),e=Ext.get(g.getEl().select(".x-panel-header-text-container").first().dom),a=b.getComponent("frontFocusCatch").getEl(),f=b.getComponent("focusCatch").getEl();b.mon(a,"keydown",function(h){if(h.getKey()===h.TAB&&h.shiftKey===true){b.focusAndPrevent(h,c)}});b.mon(f,"keydown",function(h){if(h.getKey()===h.TAB&&h.shiftKey===false){b.focusAndPrevent(h,e)}});b.mon(e,"keydown",function(h){if(h.getKey()===h.TAB&&h.shiftKey===true){b.focusAndPrevent(h,f)}});b.mon(c,"keydown",function(h){if(h.getKey()===h.TAB&&h.shiftKey===false){b.focusAndPrevent(h,a)}});b.mon(a,"keypress",function(h){if(h.getKey()===h.TAB&&h.shiftKey===true){b.focusAndPrevent(h,c)}});b.mon(f,"keypress",function(h){if(h.getKey()===h.TAB&&h.shiftKey===false){b.focusAndPrevent(h,e)}});b.mon(e,"keypress",function(h){if(h.getKey()===h.TAB&&h.shiftKey===true){b.focusAndPrevent(h,f)}});b.mon(c,"keypress",function(h){if(h.getKey()===h.TAB&&h.shiftKey===false){b.focusAndPrevent(h,a)}})},moveWidgetLeft:function(e){var c=this.tabPanel.items.getCount(),d;for(var b=0,a=c;b<a;b++){if(e===this.tabPanel.items.items[b]){d=b;break}}if(d!==0){this.reorderWidget(e,d-1,d)}},moveWidgetRight:function(e){var c=this.tabPanel.items.getCount(),d;for(var b=0,a=c;b<a;b++){if(e===this.tabPanel.items.items[b]){d=b;break}}if(d!==(c-1)){this.reorderWidget(e,d+1,d)}}});