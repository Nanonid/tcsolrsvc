Ext.define("Ozone.components.EditWidgetPanel",{extend:"Ext.panel.Panel",alias:["widget.editwidgetpanel","widget.Ozone.components.EditWidgetPanel"],layout:"card",bodyCls:"editpanel-body",initComponent:function(){this.addEvents("itemcreated","itemupdated","initialdataloaded");this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();OWF.Eventing.subscribe(this.channel,Ext.bind(this.handleSubscriptionEvent,this));this.launchConfig=OWF.Launcher.getLaunchData();if(this.launchConfig!=null){this.launchData=Ozone.util.parseJson(this.launchConfig)}this.widgetState=Ozone.state.WidgetState.getInstance({autoInit:true,onStateEventReceived:Ext.bind(this.handleStateEvent,this)});this.store.on("write",function(d,e,a,c,b){OWF.Eventing.publish(this.channel,{action:e,domain:this.domain,records:a})},this);this.on("itemcreated",function(a){this.recordId=a;OWF.Eventing.publish(this.channel,{action:"created",id:a})},this);this.on("itemupdated",function(a){OWF.Eventing.publish(this.channel,{action:"modified",id:a})},this);this.on("afterrender",function(a,c){if(this.launchConfig!=null){if(!this.launchData.isCreate){this.store.load({params:{id:this.launchData.id},callback:function(){this.record=this.store.getById(this.launchData.id);this.recordId=this.record?this.record.getId():null;this.fireEvent("initialdataloaded",this.record);this.enableTabs()},scope:this})}}else{this.record={};this.fireEvent("initialdataloaded",this.record)}var d=[];for(var b=0;this.items&&b<this.items.getCount();b++){d.push({xtype:"button",pressed:b==0,disabled:this.items.getAt(b).initDisabled,toggleGroup:"editorTabs",allowDepress:false,text:this.items.getAt(b).title,iconCls:this.items.getAt(b).iconCls,icon:this.items.getAt(b).iconCls==undefined?this.items.getAt(b).icon:undefined,iconAlign:"top",scale:"xlarge",index:b,handler:function(f,g){this.getLayout().setActiveItem(f.index)},scope:this})}this.addDocked([{itemId:"editorToolbar",hidden:this.hideEditorToolbar,xtype:"toolbar",cls:"editor-tabs",dock:"top",items:d,enableOverflow:true,listeners:{afterlayout:function(e){e.setHeight(e.getHeight())}}}])},this);this.callParent(arguments)},handleStateEvent:function(a,b){if(b.eventName.indexOf("afterEventIntercept_")==-1){if(b.eventName=="beforeclose"){this.widgetState.removeStateEventOverrides({events:["beforeclose"],callback:Ext.bind(function(){this.widgetState.closeWidget()},this)})}}},handleSubscriptionEvent:function(a,b){if(b.action=="delete"&&b.id==this.recordId){this.closeWidget()}},closeWidget:function(){this.widgetStateHandler.handleWidgetRequest({fn:"closeWidget",params:{guid:Ozone.getInstanceId()}})},enableTabs:function(){var a=this.getDockedComponent("editorToolbar");for(var c=0;a.items&&c<a.items.getCount();c++){var b=a.items.getAt(c);if(b){b.setDisabled(false)}}}});