Ext.define("Ozone.components.admin.widget.ApprovePanel",{extend:"Ext.panel.Panel",alias:["widget.approvepanel","widget.Ozone.components.admin.widget.ApprovePanel"],widgets:null,itemId:"approvepanel",cls:"approvepanel",initComponent:function(){this.addEvents(["approve","cancel"]);if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"adminwidgetstore"})}Ext.apply(this,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",itemId:"titlePanel",cls:"titlePanel",layout:"fit",border:false,height:30,renderTpl:["You have selected to approve {name}."],renderData:{name:"0 widget(s)"}},{xtype:"component",itemId:"reqTitlePanel",cls:"reqTitlePanel",layout:"fit",border:false,height:50,renderTpl:["These widgets are required by other widgets in OWF. Approving these widgets will additionally approve the widgets listed below."]},{xtype:"grid",itemId:"reqGrid",autoScroll:true,forceFit:true,flex:1,border:false,store:{type:"adminwidgetstore",remoteSort:false},columns:[{itemId:"name",header:"Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(j,b,e,g,f,k,h){var i=j;var a=e.get("headerIcon");var d=Ozone.util.contextPath();if(!a.match(new RegExp("^/?"+d+"/.*$","i"))&&!a.match(new RegExp("^https?://.*","i"))){if(a.indexOf("/")==0){a=d+a}else{a=d+"/"+a}}var c='<div class="grid-widget"><div class="grid-icon-and-text-title-box"><div class="grid-icon-and-text-icon"><img class="grid-icon-and-text-icon-image" src="'+a+'"> ';c+="</div>";c+='<div class="grid-icon-and-text-title">'+i+"</div>";return c}},{itemId:"widgetUrl",header:"URL",dataIndex:"url",flex:1,minWidth:250,menuDisabled:true,sortable:true}]}],buttons:[{text:Ozone.layout.DialogMessages.ok,handler:function(a){this.approve()},scope:this},{text:"Cancel",handler:function(a){this.cancel()},scope:this}]});this.callParent();this.on({afterrender:{fn:function(){if(this.widgets!=null){this.loadData(this.widgets)}},scope:this}})},loadData:function(c){if(c!=null){this.store.loadData(c);var d=this.down("#titlePanel");var b=this.store.getCount();var g={name:b>1?('<span class="heading-bold">'+b+"</span> widgets"):('<span class="heading-bold">'+this.store.getAt(0).data.name+"</span>")};if(d.rendered){d.renderTpl.overwrite(d.getTargetEl(),g)}else{d.renderData=g}var f=this.requiredWidgets;var a=this.down("#reqGrid");var e=a.getStore();if(e){e.removeAll();if(f.length>0){e.loadData(f)}this.doLayout()}}},approve:function(){var e=this.store.getRange();var a=this.down("#reqGrid");var d=a.getStore();var b=d.getRange();var c=e.concat(b);this.fireEvent("approve",{widgetRecs:c})},cancel:function(){this.fireEvent("cancel")},down:function(a){if(this.cmpCache==null){this.cmpCache=Ext.create("Ext.util.MixedCollection")}var b=this.cmpCache.getByKey(a);if(b==null){b=this.callParent(arguments);if(b!=null){this.cmpCache.add(a,b)}}return b}});