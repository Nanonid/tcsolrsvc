Ext.define("Ozone.components.admin.widget.DeleteWidgetsPanel",{extend:"Ext.panel.Panel",alias:["widget.deletewidgetspanel","widget.Ozone.components.admin.widget.DeleteWidgetsPanel"],mixins:{circularFocus:"Ozone.components.focusable.CircularFocus"},delWidgets:null,itemId:"deletepanel",cls:"deletepanel",initComponent:function(){this.addEvents(["delete","cancel"]);if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"adminwidgetstore"})}Ext.apply(this,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",itemId:"delTitlePanel",cls:"delTitlePanel",layout:"fit",border:false,height:30,renderTpl:["You have selected to delete {name}."],renderData:{name:"0 widget(s)"}},{xtype:"component",itemId:"reqTitlePanel",cls:"reqTitlePanel",layout:"fit",border:false,height:50,renderTpl:["These widgets are required by other widgets in OWF. Deleting these widgets will additionally delete the widgets listed below."]},{xtype:"grid",itemId:"reqGrid",autoScroll:true,forceFit:true,flex:1,border:false,store:{type:"adminwidgetstore",remoteSort:false},columns:[{itemId:"name",header:"Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(j,b,e,g,f,k,h){var i=j;var a=e.get("headerIcon");var d=Ozone.util.contextPath();if(!a.match(new RegExp("^/?"+d+"/.*$","i"))&&!a.match(new RegExp("^https?://.*","i"))){if(a.indexOf("/")==0){a=d+a}else{a=d+"/"+a}}var c='<div class="grid-widget"><div class="grid-icon-and-text-title-box"><div class="grid-icon-and-text-icon"><img class="grid-icon-and-text-icon-image" src="'+a+'"> ';c+="</div>";c+='<div class="grid-icon-and-text-title">'+i+"</div>";return c}},{itemId:"widgetUrl",header:"URL",dataIndex:"url",flex:1,minWidth:250,menuDisabled:true,sortable:true}]}],buttons:[{text:Ozone.layout.DialogMessages.ok,itemId:"ok",handler:function(a){this.del()},scope:this},{text:"Cancel",itemId:"cancel",handler:function(a){this.cancel()},scope:this}]});this.callParent();this.on({afterrender:{fn:function(){if(this.delWidgets!=null){this.loadData(this.delWidgets)}var a=this.down("#ok").getFocusEl(),b=this.down("#cancel").getFocusEl();this.setupFocus(a,b);Ext.defer(function(){b.focus()},400)},scope:this}})},loadData:function(e){if(e!=null){this.store.loadData(e);var j=this.down("#delTitlePanel");var g=this.store.getCount();var h={name:g>1?('<span class="heading-bold">'+g+"</span> widgets"):('<span class="heading-bold">'+this.store.getAt(0).data.name+"</span>")};if(j.rendered){j.renderTpl.overwrite(j.getTargetEl(),h)}else{j.renderData=h}var f=[];var b=this.requiredWidgets;if(b){for(var c=0;c<b.length;c++){if(-1==this.store.find("guid",b[c].path)){f.push({id:b[c].path,name:b[c].value.namespace,version:b[c].value.widgetVersion,url:b[c].value.url,headerIcon:b[c].value.headerIcon,image:b[c].value.image,width:b[c].value.width,height:b[c].value.height,widgetGuid:b[c].path,maximized:b[c].value.maximized,minimized:b[c].value.minimized,x:b[c].value.x,y:b[c].value.y,visible:b[c].value.visible,tags:b[c].value.tags,totalUsers:b[c].value.totalUsers,totalGroups:b[c].value.totalGroups,singleton:b[c].value.singleton})}}}var a=this.down("#reqGrid");var d=a.getStore();if(d){d.removeAll();if(f.length>0){d.loadData(f)}this.doLayout()}}},del:function(){var f=this.store.getRange();var a=this.down("#reqGrid");var e=a.getStore();var b=e.getRange();var d=Ext.create("Ext.util.MixedCollection");for(var c=0;c<f.length;c++){d.add(f[c].data.widgetGuid,f[c].data.widgetGuid)}for(var c=0;c<b.length;c++){d.add(b[c].data.widgetGuid,b[c].data.widgetGuid)}this.fireEvent("delete",{widgetGuidsToDelete:d.getRange()})},cancel:function(){this.fireEvent("cancel")},down:function(a){if(this.cmpCache==null){this.cmpCache=Ext.create("Ext.util.MixedCollection")}var b=this.cmpCache.getByKey(a);if(b==null){b=this.callParent(arguments);if(b!=null){this.cmpCache.add(a,b)}}return b}});