Ext.define("Ozone.components.admin.widget.WidgetDetailPanel",{extend:"Ext.panel.Panel",alias:["widget.widgetdetailpanel"],layout:{type:"vbox",align:"stretch"},viewGroup:null,initComponent:function(){var a=this;OWF.Preferences.getUserPreference({namespace:"owf.admin.WidgetEditCopy",name:"guid_to_launch",onSuccess:function(b){a.guid_EditCopyWidget=b.value},onFailure:function(b){Ext.Msg.alert("Preferences Error","Error looking up Widget Editor: "+b)}});if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"adminwidgetstore"})}this.viewGroup=Ext.create("Ext.view.View",{cls:"widgetDetailsView",store:this.store,deferEmptyText:false,flex:1,tpl:new Ext.XTemplate('<tpl for=".">','<div class="detail-info">','<div class="detail-header-block">','<div class="detail-widget">','<div class="detail-icon">','<img src={image:this.renderImage} title="{name:htmlEncode}" class="detail-icon-image">',"</div>","</div>",'<div class="detail-icon-block">','<div class="detail-title">{name:htmlEncode}</div>','<div><span class="detail-label">Version:</span> {version:htmlEncode}</div>',"</div>","</div>",'<div class="detail-block">','<div><span class="detail-label">Description:</span> {description:htmlEncode}</div>','<div><span class="detail-label">Universal Name:</span> {universalName:htmlEncode}</div>','<div><span class="detail-label">Default Tags:</span> {tags:this.renderTags}</div>','<div><span class="detail-label">Single Instance:</span> {singleton}</div>','<div><span class="detail-label">Visible:</span> {definitionVisible}</div>','<div><span class="detail-label">Background:</span> {background}</div>','<div><span class="detail-label">Requires Widgets:</span> {directRequired:this.renderRequiresFlag}</div>','<div><span class="detail-label">Width:</span> {width}</div>','<div><span class="detail-label">Height:</span> {height}</div>',"</div>","</div>","</tpl>",{compiled:true,renderImage:function(c){var b=Ozone.util.contextPath();if(!c.match(new RegExp("^/?"+b+"/.*$","i"))&&!c.match(new RegExp("^https?://.*","i"))){if(c.indexOf("/")==0){c=b+c}else{c=b+"/"+c}}return encodeURI(decodeURI(c))},renderTags:function(b){var d="";if(b!=null){for(var c=0;c<b.length;c++){d+=Ext.htmlEncode(b[c].name);if(c<b.length-1){d+=", "}}}if(d==""){d="<i>none</i>"}return d},renderRequiresFlag:function(b){return b!=null&&b.length>0}}),emptyText:"No widget selected",itemSelector:"div.mpDetailSummary",autoScroll:"true"});this.items=[this.viewGroup,{xtype:"grid",itemId:"reqGrid",cls:"reqGrid",autoScroll:true,hidden:true,hideHeaders:true,forceFit:true,flex:1,border:false,store:{type:"adminwidgetstore",remoteSort:false},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbtext",text:"This Widget Requires:"}]}],columns:[{itemId:"name",header:"Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(k,c,f,h,g,l,i){var j=k;var b=f.get("headerIcon");var e=Ozone.util.contextPath();if(!b.match(new RegExp("^/?"+e+"/.*$","i"))&&!b.match(new RegExp("^https?://.*","i"))){if(b.indexOf("/")==0){b=e+b}else{b=e+"/"+b}}var d='<div class="grid-widget"><div class="grid-icon-and-text-title-box"><div class="grid-icon-and-text-icon"><img class="grid-icon-and-text-icon-image" src="'+b+'"> ';d+="</div>";d+='<div class="grid-icon-and-text-title">'+j+"</div>";return d}}],listeners:{itemdblclick:{fn:function(b){var c=b.getSelectionModel().getSelection();if(c&&c.length>0){for(var d=0;d<c.length;d++){this.doEdit(c[d].data.id,c[d].data.name)}}else{Ext.Msg.alert("Error","You must select at least one widget to edit.")}},scope:this}}}];this.callParent(arguments)},clear:function(){this.load(null)},load:function(b){var a=this.getComponent("reqGrid");var c=[];if(b!=null){c.push(b)}this.viewGroup.store.loadData(c,false);if(b!=null&&b.data.allRequired!=null&&b.data.allRequired.length>0){this.requestFrom=b.data.id;Ext.Ajax.request({url:Ozone.util.contextPath()+"/widget",params:{id:b.data.allRequired,_method:"GET"},success:function(e,h){var g=Ext.decode(e.responseText);if(g){var j=g.data;if(j!=null&&j.length>0){var d=[];if(j){for(var f=0;f<j.length;f++){d.push({id:j[f].path,name:j[f].value.namespace,version:j[f].value.widgetVersion,url:j[f].value.url,headerIcon:j[f].value.headerIcon,image:j[f].value.image,width:j[f].value.width,height:j[f].value.height,widgetGuid:j[f].path,maximized:j[f].value.maximized,minimized:j[f].value.minimized,x:j[f].value.x,y:j[f].value.y,visible:j[f].value.visible,tags:j[f].value.tags,totalUsers:j[f].value.totalUsers,totalGroups:j[f].value.totalGroups,singleton:j[f].value.singleton})}}if(a&&this.store.getAt(0).get("id")==this.requestFrom){a.store.loadData(d);a.setVisible(true)}}else{if(a){a.store.removeAll(true);a.setVisible(false)}}}},failure:function(d,e){Ext.Msg.alert("Server Error","Error retrieving required widgets: "+d)},scope:this})}else{if(a){a.store.removeAll(true);a.setVisible(false)}}},doEdit:function(c,b){var a=Ozone.util.toString({id:c,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+b,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(d){if(d.error){Ext.Msg.alert("Launch Error","Widget Editor Launch Failed: "+d.message)}})}});