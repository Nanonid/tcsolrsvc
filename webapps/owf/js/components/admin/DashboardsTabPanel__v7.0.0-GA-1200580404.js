Ext.define("Ozone.components.admin.DashboardsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.dashboardstabpanel"],layout:{type:"fit"},preventHeader:true,border:true,padding:5,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,isGroupDashboard:false,editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{items:[{xtype:"dashboardsgrid",itemId:"dashboardsgrid",preventHeader:true,border:false,listeners:{itemdblclick:{fn:this.doEdit,scope:this}}}],dockedItems:[{xtype:"toolbar",itemId:"tbDashboardsGridHdr",cls:"tbDashboardsGridHdr",dock:"top",items:[{xtype:"tbtext",cls:"tbDashboardsGridHdr",itemId:"lblDashboardsGrid",text:"Dashboards"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("dashboardsgrid");if(b!=null){b.applyFilter(d,["name"])}},scope:this}}}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("dashboardsgrid");var e=i.getDockedComponent("tbDashboardsGridHdr");var h=e.getComponent("lblDashboardsGrid");var g=i.ownerCt;var j=-1;c.setStore(Ext.create("Ozone.data.stores.AdminDashboardStore",i.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"dashboards",adminEnabled:true};d[i.componentId]=j;c.setBaseParams(d)}},single:true}});this.on({activate:{fn:function(f,e){var d=f.getComponent("dashboardsgrid");var c=d.getStore();if(f.ownerCt.record){var b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("title"),25));if(!b){b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("name"),25))||"Dashboards"}var g=this.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblDashboardsGrid");g.setText(b)}if(c){c.load({params:{offset:0,max:c.pageSize}})}},scope:this}});OWF.Preferences.getUserPreference({namespace:"owf.admin.DashboardEditCopy",name:"guid_to_launch",onSuccess:function(b){a.guid_DashboardEditCopyWidget=b.value},onFailure:function(b){a.editPanel.showAlert("Preferences Error","Error looking up Dashboard Editor: "+b)}});this.callParent()},launchFailedHandler:function(a){if(a.error){this.editPanel.showAlert("Launch Error","Dashboard Editor Launch Failed: "+a.message)}},onStoreException:function(f,c,b,d){var a;try{a=Ext.JSON.decode(c)}catch(g){a=c}a&&this.editPanel.showAlert("Server Error",a)},onAddClicked:function(){var a=Ext.widget("admineditoraddwindow",{addType:"Dashboard",itemName:this.ownerCt.record.get("displayName"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("dashboardsgrid").getStore(),grid:Ext.widget("dashboardsgrid",{itemId:"dashboardsaddgrid",border:false,enableColumnHide:false,sortableColumns:false,listeners:{render:{fn:function(b){b.setBaseParams({adminEnabled:true,isGroupDashboard:true,isStackDashboard:false})},scope:this}}})});a.show()},doEdit:function(k,f,l,h,j){var a=this.getComponent("dashboardsgrid");var c=a.getSelectedDashboards();if(c&&c.length>0){for(var d=0;d<c.length;d++){var b=c[d].data.guid;var g=Ozone.util.toString({id:b,copyFlag:false,isGroupDashboard:this.isGroupDashboard});OWF.Launcher.launch({guid:this.guid_DashboardEditCopyWidget,title:"$1 - "+c[d].get("name"),titleRegex:/(.*)/,launchOnlyIfClosed:false,data:g},this.launchFailedHandler)}}else{this.editPanel.showAlert("Error","You must select at least one dashboard to edit")}},doDelete:function(d,f){var c=this.getComponent("dashboardsgrid");var b=c.getStore();var a=c.getSelectedDashboards();if(a&&a.length>0){b.remove(a);b.save()}else{this.editPanel.showAlert("Error","You must select at least one dashboard to remove.")}}});