Ext.define("Ozone.components.admin.grid.WidgetsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.widgetstabpanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:{type:"fit"},preventHeader:true,border:true,padding:5,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,initDisabled:true,items:[{xtype:"widgetsgrid",itemId:"widgetsGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbWidgetsGridHdr",cls:"tbWidgetsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblWidgetsGrid",cls:"tbWidgetsGridHdr",text:"Widgets"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("widgetsGrid");if(b!=null){b.applyFilter(d,["displayName","universalName"])}},scope:this}}}]},{xtype:"toolbar",itemId:"tbWidgetsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",itemId:"btnAdd",text:"Add",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",itemId:"btnRemove",text:"Remove",handler:function(){var d=this.getComponent("widgetsGrid");var c=d.store;var b=d.getSelectionModel().getSelection();if(b&&b.length>0){c.remove(b);c.save()}else{a.editPanel.showAlert("Error","You must select at least one widget to remove.")}},scope:this}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("widgetsGrid");var e=i.getDockedComponent("tbWidgetsGridHdr");var h=e.getComponent("lblWidgetsGrid");var g=i.ownerCt;var j=-1;OWF.Preferences.getUserPreference({namespace:"owf.admin.WidgetEditCopy",name:"guid_to_launch",onSuccess:function(l){i.guid_EditCopyWidget=l.value},onFailure:function(l){a.editPanel.showAlert("Preferences Error","Error looking up Widget Editor: "+l)}});c.setStore(Ext.create("Ozone.data.stores.AdminWidgetStore",i.storeCfg));var f=function(l){i.refreshWidgetLaunchMenu();if(l.action=="destroy"||l.action=="create"){var m=c.getBottomToolbar();m.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(o,p,l,n,m){OWF.Eventing.publish(this.ownerCt.channel,{action:p,domain:this.ownerCt.domain,records:l})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"widgets"};d[i.componentId]=j;c.setBaseParams(d)}if(g.record){var k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("title"),25));if(!k){k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("name"),25))||"Widgets"}h.setText(k)}if(c!=null){c.on({itemdblclick:{fn:function(){var l=c.getSelectionModel().getSelection();if(l&&l.length>0){for(var m=0;m<l.length;m++){i.doEdit(l[m].data.id,l[m].data.name)}}else{a.editPanel.showAlert("Error","You must select at least one widget to edit.")}},scope:this}})}},single:true}});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{fn:function(){var c=this.getComponent("widgetsGrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},doEdit:function(d,c){var b=this;var a=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+c,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(e){if(e.error){b.editPanel.showAlert("Launch Error","Widget Editor Launch Failed: "+e.message)}})},onAddClicked:function(a,c){var b=Ext.widget("admineditoraddwindow",{addType:"Widget",itemName:this.ownerCt.record.get("title"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("widgetsGrid").getStore(),searchFields:["displayName"],grid:Ext.widget("widgetsgrid",{itemId:"widgetsaddgrid",border:false,enableColumnHide:false,sortableColumns:false})});b.show()}});