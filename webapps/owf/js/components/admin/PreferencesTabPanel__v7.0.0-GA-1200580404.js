Ext.define("Ozone.components.admin.grid.PreferencesTabPanel",{extend:"Ext.panel.Panel",alias:["widget.preferencestabpanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:{type:"fit"},preventHeader:true,border:true,padding:5,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,initDisabled:true,items:[{xtype:"preferencesgrid",itemId:"preferencesGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbPreferencesGridHdr",cls:"tbPreferencesGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblPreferencesGrid",cls:"tbPreferencesGridHdr",text:"Preferences"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("preferencesGrid");if(b!=null){b.applyFilter(d,["namespace","path","value"])}},scope:this}}}]},{xtype:"toolbar",itemId:"tbPreferencesGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",itemId:"btnCreate",text:"Create",handler:this.onCreateClicked,scope:this},{xtype:"button",itemId:"btnEdit",text:"Edit",handler:function(){this.onEditClicked()},scope:this},{xtype:"button",itemId:"btnDelete",text:"Delete",handler:function(){var d=this.getComponent("preferencesGrid");var c=d.store;var b=d.getSelectionModel().getSelection();if(b&&b.length>0){a.editPanel.showConfirmation("Delete Preferences","This action will permanently delete the selected "+b.length+" preference(s)?",function(e,g,f){if(e=="ok"){c.remove(b);c.save()}})}else{a.editPanel.showAlert("Error","You must select at least one preferences to delete.")}},scope:this}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("preferencesGrid");var e=i.getDockedComponent("tbPreferencesGridHdr");var h=e.getComponent("lblPreferencesGrid");var g=i.ownerCt;c.setStore(Ext.create("Ozone.data.stores.PreferenceStore",i.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;if(c&&g){g.record=g.recordId?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;compId=g.recordId?g.record.data.username:"";var d={tab:"preferences"};d[i.componentId]=compId;c.setBaseParams(d)}if(g.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("title"),25))||"Preferences";h.setText(j)}if(c!=null){c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){i.onEditClicked()}}else{a.editPanel.showAlert("Error","You must select at least one preference to edit.")}},scope:this}})}},single:true}});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{fn:function(){var c=this.getComponent("preferencesGrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},onCreateClicked:function(b,a){a.stopPropagation();Ext.create("Ozone.components.admin.EditPreferenceWindow",{title:"Create Preference",username:this.ownerCt.record.data.username,width:Math.round(Ext.getBody().getViewSize().width*0.9),height:Math.round(Ext.getBody().getViewSize().height*0.9),scope:this,callback:function(d,e){if(d!=undefined){var c=this.getComponent("preferencesGrid").getStore();c.add(d);c.save()}}}).show()},onEditClicked:function(){var a=this.getComponent("preferencesGrid").getSelectionModel().getSelection();if(a.length==1){Ext.create("Ozone.components.admin.EditPreferenceWindow",{title:"Edit Preference",namespace:a[0].data.namespace,path:a[0].data.path,value:a[0].data.value,username:this.ownerCt.record.data.username,width:Math.round(Ext.getBody().getViewSize().width*0.9),height:Math.round(Ext.getBody().getViewSize().height*0.9),scope:this,callback:function(d,e){if(d!=undefined){var b=this.getComponent("preferencesGrid").getSelectionModel().getSelection()[0];var c=this.getComponent("preferencesGrid").getStore();b.beginEdit();for(var f in d){if(!Ext.isFunction(f)){b.set(f,d[f])}}b.endEdit();c.save();b.commit()}}}).show()}else{if(a.length<1){this.editPanel.showAlert("Error","You must select at least one preferences to edit.")}else{this.editPanel.showAlert("Error","You can only edit one preference at a time.")}}}});