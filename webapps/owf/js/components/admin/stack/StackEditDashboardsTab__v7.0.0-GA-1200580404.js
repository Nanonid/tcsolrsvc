Ext.define("Ozone.components.admin.stack.StackEditDashboardsTab",{extend:"Ozone.components.admin.DashboardsTabPanel",alias:["widget.stackeditdashboards","widget.stackeditdashboardstab","widget.Ozone.components.admin.stack.StackEditDashboardsTab"],cls:"stackeditdashboardstab",isGroupDashboard:true,initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"tabDashboards",title:"Dashboards",iconCls:"dashboard-tab",editor:"Stack",componentId:"stack_id",storeCfg:{api:{read:"/dashboard",create:"/stack",update:"/dashboard",destroy:"/stack"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments);this.addDocked({xtype:"toolbar",itemId:"tbDashboardsGridFtr",dock:"bottom",ui:"footer",items:[{xtype:"button",tooltip:"Move Up",tooltipType:"title",itemId:"btnMoveUp",iconCls:"x-btn-text-color icon-arrow-up",handler:function(){this.moveUp()},scope:this},{xtype:"button",tooltip:"Move Down",tooltipType:"title",itemId:"btnMoveDown",iconCls:"x-btn-text-color icon-arrow-down",handler:function(){this.moveDown()},scope:this},{xtype:"button",text:"Add",itemId:"btnAdd",minWidth:80,handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"btnRemove",minWidth:80,handler:function(){this.doDelete()},scope:this}]});this.on({activate:{scope:a,single:true,fn:function(d,c){var b=d.getComponent("dashboardsgrid");b.view.addElListener("keypress",function(e,g){if(e.getKey()==e.ENTER){var f=b.getSelectionModel();b.getStore().each(function(h){if(f.isFocused(h)){a.doEdit(null,h)}})}})}}})},onAddClicked:function(){var a=Ext.widget("admineditoraddwindow",{addType:"Dashboard",itemName:this.ownerCt.record.get("displayName"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("dashboardsgrid").getStore(),grid:Ext.widget("dashboardsgrid",{itemId:"dashboardsaddgrid",border:false,enableColumnHide:false,sortableColumns:false,listeners:{render:{fn:function(c){var b=Ozone.config.user;c.setBaseParams({adminEnabled:true,user_id:b.id})},scope:this}}})});a.show()},doEdit:function(h,b,j,d,f){var g=this;var c=this.ownerCt.recordId;var a=b?b.data:b;var i=null;if(a){i=owfdojo.toJson(a,true)}Ext.create("Ozone.components.admin.EditDashboardWindow",{title:"Dashboard Editor - "+a.name?Ext.htmlEncode(a.name):"",guid:a.guid?a.guid:"",name:a.name?a.name:"",description:a.description?a.description:"",definition:i?i:"",width:Ext.getBody().getViewSize().width*0.9,height:Ext.getBody().getViewSize().height*0.9,scope:this,callback:function(l,m){if(l!=undefined){var n=Ext.decode(l.definition);if(n){if(l.guid){n.guid=l.guid}if(l.name){n.name=l.name}if(l.description){n.description=l.description}}var k=Ext.StoreMgr.lookup({type:"admindashboardstore"});k.proxy.extraParams.adminEnabled=true;k.proxy.extraParams.stack_id=c;k.add(n);var e=k.data.items[0];e.phantom=true;k.on({write:{fn:function(p,o,r){var q=g.getComponent("dashboardsgrid");if(q&&q.store){q.store.load()}},scope:this}});if(k.proxy){k.proxy.on({exception:{fn:this.onStoreException,scope:this,single:true}})}k.sync()}}}).show()},doDelete:function(d,f){var c=this.getComponent("dashboardsgrid");var b=c.getStore();var a=c.getSelectedDashboards();if(a&&a.length>0){b.remove(a);if(b.reorder){b.reorder()}b.save()}else{this.editPanel.showAlert("Error","You must select at least one dashboard to remove.")}},moveUp:function(){var a=this.getComponent("dashboardsgrid");if(a){a.doMoveRow("up")}},moveDown:function(){var a=this.getComponent("dashboardsgrid");if(a){a.doMoveRow("down")}}});