Ext.define("Ozone.components.admin.AdminEditorAddWindow",{extend:"Ext.window.Window",alias:["widget.admineditoraddwindow","widget.AdminEditorAddWindow"],mixins:{widget:"Ozone.components.focusable.CircularFocus"},title:"Add",itemId:"admineditoraddwindow",modal:true,closable:true,draggable:false,resizable:false,closeAction:"hide",border:false,minWidth:250,minHeight:200,detailsAutoOpen:true,pnlDashboardDetail:null,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"admineditoraddpanel",cls:"admineditoraddpanel",layout:"border",flex:1,dockedItems:[{xtype:"toolbar",itemId:"admineditoraddtoolbar",dock:"top",items:[{xtype:"tbtext",itemId:"tbAdminEditorAddGridHdr",cls:"tbAdminEditorAddGridHdr",text:"Add"},"->",{xtype:"searchbox",itemId:"searchbox"}]}]}],buttons:[{text:"OK",itemId:"ok"},{text:"Cancel",itemId:"cancel"}],initComponent:function(){var a=this;var b=Ext.getBody().getViewSize();a.setWidth(Math.round(b.width*0.9));a.setHeight(Math.round(b.height*0.9));a.on("beforeshow",function(){a.setTitle(a.generateTitle());a.down("#tbAdminEditorAddGridHdr").setText(a.addType+"s");a.instructions&&a.down("#admineditoraddpanel").addDocked(Ext.widget("label",{border:false,text:a.instructions,style:{textAlign:"left"}}),"top");if(a.addType==="Dashboard"){var c=a.down("#admineditoraddpanel");a.pnlDashboardDetail=Ext.create("Ozone.components.admin.dashboard.DashboardDetailPanel",{layout:{type:"fit",align:"stretch"},region:"east",preventHeader:true,collapseMode:"mini",collapsible:true,collapsed:true,split:true,border:false,width:266});Ext.apply(a.grid,{region:"center"});c.add(a.grid);c.add(a.pnlDashboardDetail);a.relayEvents(a.grid,["datachanged","select","deselect"]);a.on("datachanged",function(d,e){if(this.pnlDashboardDetail!=null){this.pnlDashboardDetail.collapse();this.pnlDashboardDetail.removeData()}if(!this.disableLaunchMenuRefresh){this.refreshWidgetLaunchMenu()}},this);a.on("select",function(g,d,e,f){this.pnlDashboardDetail.loadData(d);if(this.pnlDashboardDetail.collapsed&&this.detailsAutoOpen){this.pnlDashboardDetail.expand()}},this)}else{Ext.apply(a.grid,{region:"center"});a.down("#admineditoraddpanel").add(a.grid)}});a.on("afterrender",function(){var f=a.grid.getStore();if(f){f.load({params:{offset:0,max:f.pageSize}})}var c=a.down("#searchbox");c.on("searchchanged",function(g,h){if(a.searchFields){a.grid.applyFilter(h,a.searchFields)}else{a.grid.applyFilter(h,a.grid.quickSearchFields)}});var d=a.down("#ok");var e=a.down("#cancel");d.on("click",function(l,n){if(a.okFn){a.okFn()}else{var h=a.grid.getSelectionModel().getSelection(),g=[];for(var k=0;k<h.length;k++){var o=h[k],m=o.get("id")?"id":"guid";if(a.existingItemsStore.findExact(m,o.get(m))===-1){var j=a.existingItemsStore.createModel(o);j.phantom=true;g.push(j)}}if(g.length>0){a.existingItemsStore.insert(0,g);if(a.existingItemsStore.reorder){a.existingItemsStore.reorder()}a.existingItemsStore.save()}}a.close()});e.on("click",function(g,h){a.close()});a.setupFocus(c.getFocusEl(),e.getFocusEl());Ext.defer(function(){c.focus()},1)});a.on("beforeclose",function(){a.grid.clearListeners();a.down("#searchbox").clearListeners();a.down("#ok").clearListeners();a.down("#cancel").clearListeners();a.focusOnClose&&a.focusOnClose.focus()});a.callParent(arguments)},generateTitle:function(){var e="Add "+this.addType+"(s)";if(this.itemName){if(this.editor==="Group"||this.editor==="Stack"||(this.editor==="User"&&this.addType==="Widget")){e+=" to "+this.itemName}else{e="Add "+this.itemName+" to "+this.addType+"(s)"}}var d=100;e=Ext.util.Format.ellipsis(e,d);var c=Ext.getBody().getViewSize();var b=new Ext.util.TextMetrics();var a=Ext.htmlEncode(e);var f=b.getWidth(a);while(f>((c.width*0.8))){d-=5;e=Ext.util.Format.ellipsis(e,d);a=Ext.htmlEncode(e);f=b.getWidth(a)}b.destroy();return Ext.htmlEncode(e)}});