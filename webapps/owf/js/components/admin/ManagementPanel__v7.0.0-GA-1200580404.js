Ext.define("Ozone.components.admin.ManagementPanel",{extend:"Ext.panel.Panel",alias:["widget.management","widget.managementpanel","widget.Ozone.components.admin.ManagementPanel"],mixins:["Ozone.components.WidgetAlerts"],initComponent:function(){this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.addCls("managementpanel");this.callParent()},launchFailureHandler:function(a){if(a.error){this.showAlert("Error","Widget Launch Failed: "+a.message)}},doCreate:function(){OWF.Launcher.launch({guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:undefined},this.launchFailureHandler)},doEdit:function(c,b){var a=Ozone.util.toString({id:c,copyFlag:false});OWF.Launcher.launch({guid:this.guid_EditCopyWidget,title:"$1 - "+b,titleRegex:/(.*)/,launchOnlyIfClosed:false,data:a},this.launchFailureHandler)},doDelete:function(){var d=this.down("#grid");var a=d.getSelectionModel().getSelection();if(a&&a.length>0){var c='<div class="owf-user-indent"><b>';for(var b=0;b<a.length;b++){c+=a[b].data.name+"<br />"}c+="</b></div>";this.showConfirmation("Delete Selection","Are you sure you want to delete the following?<br /><br />"+c,function(g,h){if(g=="yes"){var f=d.getStore();var e=f.autoSave;f.autoSave=false;f.remove(a);f.on({save:{fn:function(j,i,k){f.reload();f.autoSave=e},single:true}});f.save();this.refreshWidgetLaunchMenu()}})}else{this.showAlert("Error","No records selected")}},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},down:function(a){if(this.cmpCache==null){this.cmpCache=Ext.create("Ext.util.MixedCollection")}var b=this.cmpCache.getByKey(a);if(b==null){b=this.callParent(arguments);if(b!=null){this.cmpCache.add(a,b)}}return b},doExport:function(b,a){var f=this;var e=function(h){var i=function(k){var l="The export of "+b+" "+Ext.htmlEncode(a.get("name"))+" failed.";f.showAlert("Server Error!",k?k:l)};var j=document.createElement("iframe");j.id="exportIFrame";j.src=Ozone.util.contextPath()+"/"+b+"/export?id="+a.get("id")+"&filename="+h;j.style.display="none";j.onload=function(){var m=this,l=null;try{if(m.contentWindow&&m.contentWindow.document.body){l=m.contentWindow.document.body}else{if(m.document&&m.document.body){l=m.document.body}else{if(m.contentDocument&&m.contentDocument.body){l=m.contentDocument.body}}}if(l.innerHTML){var k=Ozone.util.parseJson(l.innerHTML);if(!k.success){i(k.errorMsg)}}}catch(n){i()}};document.body.appendChild(j)};var d="",c=a.get("descriptorUrl");if(c){d=c.substring(c.lastIndexOf("/")+1,c.length);d.indexOf(".")>-1&&(d=d.substring(0,d.lastIndexOf(".")))}var g=Ext.widget("exportwindow",{focusOnClose:this.down(),itemName:a.get("name"),itemFilename:d,okFn:e});g.show()}});