Ext.define("Ozone.components.admin.grid.DashboardsGrid",{extend:"Ext.grid.Panel",alias:["widget.dashboardsgrid"],quickSearchFields:["name"],plugins:new Ozone.components.focusable.FocusableGridPanel(),mixins:["Ozone.components.WidgetAlerts"],cls:"grid-dashboard",defaultPageSize:50,forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"admindashboardstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"guid",header:"GUID",dataIndex:"guid",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"name",header:"Dashboard Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(j,b,d,g,e,k,h){var i=j;var a=d.get("EDashboardLayoutList");var c=d.get("layout");var f="grid-dashboard-default-icon-layout";return'<p class="grid-dashboard-title '+f+'">'+Ext.htmlEncode(i)+"</p>"}},{itemId:"widgets",header:"Widgets",dataIndex:"layoutConfig",width:250,sortable:false,renderer:function(g,a,c,e,d,h,f){var b=0;if(g){var i=function(k){if(!k||!k.items){return}if(k.items.length===0){if(k.widgets&&k.widgets.length>0){b+=k.widgets.length}}else{for(var l=0,j=k.items.length;l<j;l++){i(k.items[l])}}return b};b=i(g)}return'<div class="grid-text grid-dashboard-widget-count">'+b+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"dashboard-grid-paging"})]});this.callParent(arguments)},getSelectedDashboards:function(){return this.getSelectionModel().getSelection()},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},doMoveRow:function(h){var g=this.getSelectedDashboards();if(g&&g.length>0){var c=this.store;g.sort(function(j,i){return j.get("dashboardPosition")-i.get("dashboardPosition")});if("up"===h){var f=1;for(var e=0;e<g.length;e++){if(g[e].get("dashboardPosition")===f){f++}else{var a=g[e].get("dashboardPosition"),d=a-1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==d){i.set("dashboardPosition",a)}else{if(j==a){i.set("dashboardPosition",d)}}}})}}}else{var b=c.getCount();for(var e=g.length-1;e>=0;e--){if(g[e].get("dashboardPosition")===b){b--}else{var a=g[e].get("dashboardPosition"),d=a+1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==a){i.set("dashboardPosition",d)}else{if(j==d){i.set("dashboardPosition",a)}}}})}}}if(c.getUpdatedRecords().length){c.sync();c.on("write",function(){this.refresh()},this,{single:true});c.on("load",function(l,k,n,j){for(var m=0;m<g.length;m++){this.getSelectionModel().select(l.indexOfId(g[m].get("id")),true)}},this,{single:true})}}else{this.showAlert("Error","You must select at least one dashboard to move.")}}});