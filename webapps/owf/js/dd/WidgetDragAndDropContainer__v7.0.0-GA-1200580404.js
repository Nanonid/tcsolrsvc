var Ozone=Ozone?Ozone:{};Ozone.dragAndDrop=Ozone.dragAndDrop?Ozone.dragAndDrop:{};Ozone.dragAndDrop.WidgetDragAndDropContainer=function(a){this.callback=a.callback;this.dragIndicatorText=a.dragIndicatorText?a.dragIndicatorText:"Dragging Data";this.dragIndicator=this.createDragIndicator();this.dragIndicatorTextNode=owfdojo.query("span.ddText",this.dragIndicator)[0];this.eventingContainer=a.eventingContainer;this.eventingContainer.subscribe(this.dragStartName,owfdojo.hitch(this,this.onStartDrag));this.eventingContainer.subscribe(this.dragStopInWidgetName,owfdojo.hitch(this,this.onDragStopInWidget));this.eventingContainer.subscribe(this.dragSendDataName,owfdojo.hitch(this,this.onDragSendData));this.listeners={};this.callbacks={};var b;function c(f,e,g){var d;if(document.createEvent){d=document.createEvent("MouseEvents");d.initMouseEvent(e,true,true,window,1,g.screenX,g.screenY,g.pageX,g.pageY,false,false,false,false,null,null);f.dispatchEvent(d)}else{if(document.createEventObject){d=document.createEventObject();f.fireEvent("on"+e,d)}}}gadgets.rpc.register("_fake_mouse_move",owfdojo.hitch(this,function(h){var f=gadgets.json.parse(h.sender);var i=gadgets.json.stringify({id:f.id});var d=Ext.get(i).getOffsetsTo(Ext.getBody());var g=document.elementFromPoint(d[0]+h.pageX,d[1]+h.pageY);h.pageX+=d[0];h.pageY+=d[1];if(b&&b!==g){if(b.nodeName==="IFRAME"){this.eventingContainer.publish(this.dragOutName,null,b.id)}else{c(b,"mouseout",h);c(g,"mouseover",h)}}if(g&&g.nodeName==="IFRAME"){var e=Ext.get(g.id).getOffsetsTo(Ext.getBody());h.pageX-=e[0];h.pageY-=e[1];gadgets.rpc.call(g.id,"_fire_mouse_move",null,h);this.hideDragIndicator()}else{if(g){c(g,"mousemove",h)}}b=g}));gadgets.rpc.register("_fake_mouse_out",owfdojo.hitch(this,this.hideDragIndicator));gadgets.rpc.register("_fake_mouse_up",owfdojo.hitch(this,function(h){var f=gadgets.json.parse(h.sender);var i=gadgets.json.stringify({id:f.id});var d=Ext.get(i).getOffsetsTo(Ext.getBody());var g=document.elementFromPoint(d[0]+h.pageX,d[1]+h.pageY);h.pageX+=d[0];h.pageY+=d[1];if(g.nodeName==="IFRAME"){var e=Ext.get(g.id).getOffsetsTo(Ext.getBody());h.pageX-=e[0];h.pageY-=e[1];gadgets.rpc.call(g.id,"_fire_mouse_up",null,h)}else{c(g,"mouseup",h)}b=null}))};Ozone.dragAndDrop.WidgetDragAndDropContainer.prototype={dragStart:"dragStart",dragStop:"dragStop",dropReceive:"dropReceive",dragStartName:"_dragStart",dragOverWidgetName:"_dragOverWidget",dragOutName:"_dragOutName",dragStopInContainerName:"_dragStopInContainer",dragStopInWidgetName:"_dragStopInWidget",dragSendDataName:"_dragSendData",dropReceiveDataName:"_dropReceiveData",version:Ozone.version.owfversion+Ozone.version.dragAndDrop,dragDropData:null,createDragIndicator:function(){return owfdojo.create("span",{className:"ddBox ddBoxCannotDrop",style:"display: none",innerHTML:'<span class="ddText">'+this.dragIndicatorText+"</span>"},owfdojo.body())},onStartDrag:function(a,b){this.dragging=true;if(owfdojo.isFunction(this.callbacks[this.dragStart])){if(this.callbacks[this.dragStart](a,b)===false){return}}this.dragIndicatorText=b.dragDropLabel;if(this.listeners.onmousemove==null){this.listeners.onmousemove=owfdojo.connect(document,"onmousemove",this,this.mouseMove)}if(this.listeners.onmouseup==null){this.listeners.onmouseup=owfdojo.connect(document,"onmouseup",this,this.mouseUp)}if(this.listeners.onmouseout==null){this.listeners.onmouseout=owfdojo.connect(document,"onmouseout",this,this.mouseOut)}},getMouseCoordinates:function(b){var a=null;if(b.pageX||b.pageY){a={x:b.pageX,y:b.pageY}}else{a={x:b.clientX+document.body.scrollLeft-document.body.clientLeft,y:b.clientY+document.body.scrollTop-document.body.clientTop}}return a},mouseMove:function(g){var h=null;var b=null;var i=this.getMouseCoordinates(g);var f=i.x;var d=i.y;this.hideDragIndicator();if(g===undefined){g=window.event}this.dragIndicator.style.top=d+19+"px";if(owfdojo.isIE){h=document.body.clientWidth;b=document.body.clientHeight}else{h=window.innerWidth;b=window.innerHeight}var c=h-100;if((f<h)&&(f>c)){this.dragIndicator.style.left=f-88+"px"}else{this.dragIndicator.style.left=f+12+"px"}var a=b-40;if((d>a)&&(d<b)){this.dragIndicator.style.top=d-30+"px"}this.dragIndicatorTextNode.innerHTML=this.dragIndicatorText;owfdojo.style(this.dragIndicator,{display:"block"})},onDragStopInWidget:function(a,b){this.hideDragIndicator();for(l in this.listeners){owfdojo.disconnect(this.listeners[l]);this.listeners[l]=null}this.eventingContainer.publish(this.dropReceiveDataName,this.dragDropData,a);this.eventingContainer.publish(this.dragStopInContainerName,null);this.dragging=false;if(owfdojo.isFunction(this.callbacks[this.dragStop])){this.callbacks[this.dragStop](b)}},mouseUp:function(){this.hideDragIndicator();for(l in this.listeners){owfdojo.disconnect(this.listeners[l]);this.listeners[l]=null}this.eventingContainer.publish(this.dragStopInContainerName,null);this.dragging=false;if(owfdojo.isFunction(this.callbacks[this.dragStop])){this.callbacks[this.dragStop]()}},mouseOut:function(a){if(a===undefined){a=window.event}var b=null;if(a.toElement===undefined){b=a.relatedTarget}else{b=a.toElement}if(b){this.hideDragIndicator();this.eventingContainer.publish(this.dragOutName,null)}},onDragSendData:function(a,b){this.dragDropData=b},addCallback:function(b,a){this.callbacks[b]=a},isDragging:function(){return this.dragging},hideDragIndicator:function(){owfdojo.style(this.dragIndicator,{display:"none"})}};