var guid=guid||{};var Ozone=Ozone||{};Ozone.util=Ozone.util||{};guid.util=function(){function a(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return{guid:function(){return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}}}();Ozone.util.guid=function(){return guid.util.guid()};Ext.define("Ozone.data.ModelIdGenerator",{extend:"Ext.data.IdGenerator",alias:"idgen.model",getRecId:function(b){var a=this.overrideIdProperty||b.idProperty;return b.get(a)},generate:function(){return null}});Ext.define("Ozone.components.admin.form.UrlField",{extend:"Ext.form.field.Text",alias:"widget.urlfield",urlRegex:/(^https):\/\/\S+/i,urlRegexText:Ozone.layout.DialogMessages.widgetDefinition_secureUrl_warningText,hasActiveWarning:function(){var a=this.getValue();if(this.urlRegex&&!this.urlRegex.test(a)&&a!=null&&a!=""){return true}else{return false}},getActiveWarning:function(){return this.hasActiveWarning()?this.urlRegexText:""}});Ext.define("Ozone.data.Group",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"name",type:"string"},{name:"id",type:"int"},{name:"description",type:"string"},{name:"totalWidgets",type:"int"},{name:"totalUsers",type:"int"},{name:"totalStacks",type:"int"},{name:"automatic",type:"boolean"},{name:"stackDefault",type:"boolean"},{name:"status",type:"string"},{name:"displayName",type:"string"},{name:"email",type:"string"},{name:"title",mapping:"displayName"}]});Ext.define("Ozone.data.GroupStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Group",sorters:[{property:"displayName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/group",create:"/group",update:"/group",destroy:"/group"},fields:["id","name","description","totalWidgets","totalUsers","totalStacks","automatic","stackDefault","status","displayName","email"],autoDestroy:true});this.callParent(arguments)}});Ext.define("Ozone.data.Intent",{extend:"Ext.data.Model",fields:[{name:"title",mapping:"action"},{name:"action"},{name:"dataType"},{name:"send"},{name:"receive"}]});Ext.define("Ozone.data.stores.IntentStore",{extend:"Ext.data.Store",model:"Ozone.data.Intent",alias:"store.intentstore",groupField:"action",sorters:[{property:"action",direction:"ASC"},{property:"dataType",direction:"ASC"},{property:"send",direction:"ASC"},{property:"receive",direction:"ASC"}],constructor:function(a){this.callParent(arguments)}});Ext.define("Ozone.data.User",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id"},{name:"username"},{name:"userRealName"},{name:"email"},{name:"totalGroups"},{name:"totalWidgets"},{name:"totalDashboards"},{name:"totalStacks"},{name:"lastLogin"},{name:"title",mapping:"userRealName"}]});Ext.define("Ozone.data.UserStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.User",alias:"store.userstore",sorters:[{property:"userRealName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/user",create:"/user",update:"/user",destroy:"/user"},fields:["id","username","userRealName","email","totalWidgets","totalGroups","totalDashboards","lastLogin"],autoDestroy:true});Ozone.data.UserStore.superclass.constructor.call(this,a)}});Ext.define("Ozone.data.WidgetDefinition",{extend:"Ext.data.Model",idProperty:"widgetGuid",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"value.namespace"},{name:"originalName",mapping:"value.originalName"},{name:"version",mapping:"value.widgetVersion"},{name:"description",mapping:"value.description"},{name:"url",mapping:"value.url"},{name:"headerIcon",mapping:"value.headerIcon"},{name:"image",mapping:"value.image"},{name:"width",mapping:"value.width"},{name:"height",mapping:"value.height"},{name:"widgetGuid",mapping:"path"},{name:"universalName",mapping:"value.universalName"},{name:"maximized",mapping:"value.maximized"},{name:"minimized",mapping:"value.minimized"},{name:"x",mapping:"value.x"},{name:"y",mapping:"value.y"},{name:"visible",mapping:"value.visible"},{name:"definitionVisible",mapping:"value.definitionVisible"},{name:"background",mapping:"value.background"},{name:"disabled",mapping:"value.disabled"},{name:"editable",mapping:"value.editable"},{name:"tags",mapping:"value.tags"},{name:"singleton",mapping:"value.singleton"},{name:"allRequired",mapping:"value.allRequired"},{name:"directRequired",mapping:"value.directRequired"},{name:"userId",mapping:"value.userId"},{name:"userRealName",mapping:"value.userRealName"},{name:"totalUsers",mapping:"value.totalUsers"},{name:"totalGroups",mapping:"value.totalGroups"},{name:"widgetTypes",mapping:"value.widgetTypes"},{name:"descriptorUrl",mapping:"value.descriptorUrl"},{name:"intents",mapping:"value.intents"},{name:"title",mapping:"value.namespace"},{name:"groups",mapping:"value.groups"},{name:"disabled",mapping:"value.disabled"}]});Ext.define("Ozone.data.stores.AdminWidgetStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.WidgetDefinition",alias:"store.adminwidgetstore",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/widget",create:"/widget",update:"/widget",destroy:"/widget"}});this.callParent(arguments)}});Ext.define("Ozone.data.WidgetType",{extend:"Ext.data.Model",fields:["id","name"]});Ext.define("Ozone.data.WidgetTypeStore",{extend:"Ext.data.Store",model:"Ozone.data.WidgetType",proxy:{type:"ajax",url:Ozone.util.contextPath()+"/widgettype/list",limitParam:undefined,pageParam:undefined,startParam:undefined,reader:{type:"json",root:"data"}},totalProperty:"results"});Ext.define("Ozone.components.admin.EditIntentWindow",{extend:"Ext.window.Window",alias:["widget.editintentwindow","widget.Ozone.components.admin.EditIntentWindow"],mixins:{widget:"Ozone.components.focusable.CircularFocus"},cls:"editintentwindow",callback:Ext.emptyFn,scope:undefined,action:undefined,dataType:undefined,send:undefined,receive:undefined,resizable:false,modal:true,initComponent:function(){var c=this;var b=Ozone.config.freeTextEntryWarningMessage;if(!this.scope){this.scope=this}Ext.apply(this,{layout:"fit",items:[{xtype:"panel",cls:"usereditpanel",layout:"fit",items:[{xtype:"panel",cls:"adminEditor",bodyCls:"adminEditor-body",layout:"fit",border:false,items:[{xtype:"form",itemId:"form",layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,defaults:{anchor:"100%",msgTarget:"side",labelSeparator:"",margin:"5 5 0 5",listeners:{blur:{fn:function(e){e.changed=true;e.doComponentLayout()},scope:c},change:{fn:function(h,g,e,f){if(!h.changed&&h.isDirty()){h.changed=true}},scope:c},afterrender:{fn:function(g,e){var f=g.getComponentLayout();if(f.errorStrategies!=null){f.previousBeforeLayout=f.beforeLayout;f.beforeLayout=function(i,h){return this.previousBeforeLayout()||!this.owner.preventMark};f.errorStrategies.side={prepare:function(h){var i=h.errorEl;if(h.hasActiveError()&&h.changed){i.removeCls("owf-form-valid-field");i.removeCls("x-form-warning-icon");i.removeCls("owf-form-unchanged-field");i.addCls(Ext.baseCSSPrefix+"form-invalid-icon");f.tip=f.tip?f.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});f.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},f.tip.tagConfig);i.dom.setAttribute("data-errorqtip",h.getActiveError()||"");i.setDisplayed(h.hasActiveError())}else{if(h.hasActiveWarning&&h.hasActiveWarning()&&h.changed){i.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");i.removeCls("owf-form-valid-field");i.removeCls("owf-form-unchanged-field");i.addCls("x-form-warning-icon");f.tip=f.tip?f.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});f.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},f.tip.tagConfig);i.dom.setAttribute("data-errorqtip",h.getActiveWarning()||"");i.setDisplayed(h.hasActiveWarning())}else{if(h.changed){if(f.tip){f.tip.unregister(i)}i.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");i.removeCls("x-form-warning-icon");i.removeCls("owf-form-unchanged-field");i.addCls("owf-form-valid-field");i.dom.setAttribute("data-errorqtip","");i.setDisplayed(true)}else{i.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");i.removeCls("x-form-warning-icon");i.removeCls("owf-form-valid-field");i.dom.setAttribute("data-errorqtip","");i.setDisplayed(false)}}}},adjustHorizInsets:function(h,i){if(h.autoFitErrors){i.insets.right+=h.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(h,i){h.errorEl.setStyle("left",i.width-i.insets.right+"px")},layoutVert:function(h,i){h.errorEl.setStyle("top",i.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:c}}},items:[{xtype:"component",hidden:b==null||b=="",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(b&&b.length>0)?"dialogHeader":"",message:b?b:""}},{xtype:"textfield",name:"action",itemId:"nameField",value:c.action,fieldLabel:Ozone.util.createRequiredLabel("Action"),labelWidth:130,allowBlank:false,maxLength:255},{xtype:"textfield",name:"dataType",itemId:"dataTypeField",value:c.dataType,fieldLabel:Ozone.util.createRequiredLabel("Data Type"),labelWidth:130,allowBlank:false,maxLength:255},{xtype:"checkbox",name:"send",itemId:"sendChk",fieldLabel:"Send",labelWidth:130,submitValue:true,preventMark:true,checked:(c.send!=undefined)?c.send:true},{xtype:"checkbox",name:"receive",itemId:"receiveChk",fieldLabel:"Receive",labelWidth:130,submitValue:true,preventMark:true,checked:c.receive}]}],buttons:[{text:"OK",itemId:"ok",handler:function(k,n){var g=this.query("textfield");for(var j=0;j<g.length;j++){var m=g[j];if(!Ext.isFunction(m)){m.isValid();m.changed=true;m.doComponentLayout();if(m.getXType()=="textfield"){m.setValue(Ext.String.trim(m.getValue()))}}}var l=k.ownerCt.ownerCt;this.submitValues=l.getComponent("form").getValues();var f=l.getComponent("form").getForm().getFields().items;var h=false;for(m in f){if(f[m].name){this.submitValues["original"+f[m].name.charAt(0).toUpperCase()+f[m].name.slice(1)]=f[m].originalValue}if(f[m].xtype=="textfield"&&f[m].getValue()==""){h=true}}if(!h){this.callback.call(this.scope,this.submitValues);this.close()}},scope:this},{text:"Cancel",itemId:"cancel",handler:function(f,g){this.close()},scope:this}]}]}]});this.callParent(arguments);var d=this.down("#sendChk"),a=this.down("#receiveChk");d.on("change",function(){a.suspendEvents(false);a.setValue(true);a.resumeEvents()});a.on("change",function(){d.suspendEvents(false);d.setValue(true);d.resumeEvents()});this.on("afterrender",function(){this.setupFocus(this.down("#nameField").getFocusEl(),this.down("#cancel").getFocusEl())})}});Ext.define("Ozone.components.admin.IntentsGrid",{extend:"Ext.grid.Panel",alias:["widget.intentsgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-intent",forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"intentstore"})}if(this.baseParams){this.setBaseParams(this.baseParams)}var a=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name:htmlEncode}",enableNoGroups:false,enableGroupingMenu:false});Ext.apply(this,{features:[a],columnLines:true,columns:[{itemId:"dataType",header:"Intent",dataIndex:"dataType",flex:1,minWidth:200,sortable:true,renderer:function(g,d,c,h,f,e,b){return'<div class="intent-text">'+Ext.htmlEncode(g)+"</div>"}},{itemId:"send",header:"Send",dataIndex:"send",width:140,sortable:true,align:"center",renderer:function(h,d,c,i,g,e,b){var f="&nbsp;";if(h==true){f='<img src="../themes/common/images/icons/ball.png" />'}return f}},{itemId:"receive",header:"Receive",dataIndex:"receive",width:140,sortable:true,align:"center",renderer:function(h,d,c,i,g,e,b){var f="&nbsp;";if(h==true){f='<img src="../themes/common/images/icons/ball.png" />'}return f}}]});this.callParent(arguments)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},applyFilter:function(a){this.clearFilters();if(a){a=a.toLowerCase();this.store.filter({filterFn:function(b){if(b.get("action").toLowerCase().indexOf(a)!==-1){return true}if(b.get("dataType").toLowerCase().indexOf(a)!==-1){return true}return false}})}},clearFilters:function(){this.store.clearFilter()},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(a,b){this.reconfigure(a,b)}});Ext.define("Ozone.components.admin.GroupsGrid",{extend:"Ext.grid.Panel",alias:["widget.groupsgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),title:"Groups",columns:[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"Group Name",dataIndex:"displayName",flex:3,renderer:function(e,b,a,f,d,c){return this.renderCell(Ext.htmlEncode(e?e:a.data.name),b,a)}},{header:"Users",dataIndex:"totalUsers",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}},{header:"Widgets",dataIndex:"totalWidgets",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}},{header:"Stacks",dataIndex:"totalStacks",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}}],defaultPageSize:50,multiSelect:true,initComponent:function(){Ext.apply(this,{columnLines:true});this.store=Ext.create("Ozone.data.GroupStore",{id:"groupstore",autoLoad:false,pageSize:this.defaultPageSize});this.bbar=Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",store:this.store,pageSize:this.pageSize,displayInfo:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.pageSize}})},clearFilter:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.pageSize}})},renderCell:function(b,c,a){if(a.get("status")=="inactive"){c.tdCls+=" x-item-disabled"}return b},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)}});Ext.define("Ozone.components.UsersGrid",{extend:"Ext.grid.Panel",alias:["widget.usersgrid","widget.Ozone.components.UsersGrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),store:null,baseParams:{},quickSearchFields:["userRealName","username","email"],showHeaderBar:true,viewConfig:{forceFit:true},defaultPageSize:50,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"userstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}this.columns=[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"User Name",dataIndex:"username",flex:2,sortable:true,editable:false,hidden:true,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"Full Name",dataIndex:"userRealName",flex:2,sortable:true,editable:false,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"Last Sign In",dataIndex:"lastLogin",flex:2,sortable:true,editable:false,renderer:function(a){return a?Ext.Date.format(new Date(a),"m-d-Y H:i"):""}},{header:"Groups",dataIndex:"totalGroups",flex:1,sortable:false,editable:false},{header:"Widgets",dataIndex:"totalWidgets",flex:1,sortable:false,editable:false},{header:"Dashboards",dataIndex:"totalDashboards",flex:1,sortable:false,editable:false},{header:"Stacks",dataIndex:"totalStacks",flex:1,sortable:false,editable:false}];Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",dock:"bottom",store:this.store,pageSize:this.pageSize,displayInfo:true,hidden:this.hidePagingToolbar})],columnLines:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},applyFilter:function(d,a){this.store.proxy.extraParams={};Ext.apply(this.store.proxy.extraParams,this.baseParams);if(!Ext.isEmpty(d)){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}Ext.apply(this.store.proxy.extraParams,{filters:Ext.JSON.encode(c),filterOperator:"OR"})}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]}});Ext.define("Ozone.components.EditWidgetPanel",{extend:"Ext.panel.Panel",alias:["widget.editwidgetpanel","widget.Ozone.components.EditWidgetPanel"],layout:"card",bodyCls:"editpanel-body",initComponent:function(){this.addEvents("itemcreated","itemupdated","initialdataloaded");this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();OWF.Eventing.subscribe(this.channel,Ext.bind(this.handleSubscriptionEvent,this));this.launchConfig=OWF.Launcher.getLaunchData();if(this.launchConfig!=null){this.launchData=Ozone.util.parseJson(this.launchConfig)}this.widgetState=Ozone.state.WidgetState.getInstance({autoInit:true,onStateEventReceived:Ext.bind(this.handleStateEvent,this)});this.store.on("write",function(d,e,a,c,b){OWF.Eventing.publish(this.channel,{action:e,domain:this.domain,records:a})},this);this.on("itemcreated",function(a){this.recordId=a;OWF.Eventing.publish(this.channel,{action:"created",id:a})},this);this.on("itemupdated",function(a){OWF.Eventing.publish(this.channel,{action:"modified",id:a})},this);this.on("afterrender",function(a,c){if(this.launchConfig!=null){if(!this.launchData.isCreate){this.store.load({params:{id:this.launchData.id},callback:function(){this.record=this.store.getById(this.launchData.id);this.recordId=this.record?this.record.getId():null;this.fireEvent("initialdataloaded",this.record);this.enableTabs()},scope:this})}}else{this.record={};this.fireEvent("initialdataloaded",this.record)}var d=[];for(var b=0;this.items&&b<this.items.getCount();b++){d.push({xtype:"button",pressed:b==0,disabled:this.items.getAt(b).initDisabled,toggleGroup:"editorTabs",allowDepress:false,text:this.items.getAt(b).title,iconCls:this.items.getAt(b).iconCls,icon:this.items.getAt(b).iconCls==undefined?this.items.getAt(b).icon:undefined,iconAlign:"top",scale:"xlarge",index:b,handler:function(f,g){this.getLayout().setActiveItem(f.index)},scope:this})}this.addDocked([{itemId:"editorToolbar",hidden:this.hideEditorToolbar,xtype:"toolbar",cls:"editor-tabs",dock:"top",items:d,enableOverflow:true,listeners:{afterlayout:function(e){e.setHeight(e.getHeight())}}}])},this);this.callParent(arguments)},handleStateEvent:function(a,b){if(b.eventName.indexOf("afterEventIntercept_")==-1){if(b.eventName=="beforeclose"){this.widgetState.removeStateEventOverrides({events:["beforeclose"],callback:Ext.bind(function(){this.widgetState.closeWidget()},this)})}}},handleSubscriptionEvent:function(a,b){if(b.action=="delete"&&b.id==this.recordId){this.closeWidget()}},closeWidget:function(){this.widgetStateHandler.handleWidgetRequest({fn:"closeWidget",params:{guid:Ozone.getInstanceId()}})},enableTabs:function(){var a=this.getDockedComponent("editorToolbar");for(var c=0;a.items&&c<a.items.getCount();c++){var b=a.items.getAt(c);if(b){b.setDisabled(false)}}}});Ext.define("Ozone.components.admin.GroupsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.groupstabpanel","widget.Ozone.components.admin.GroupsTabPanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:"fit",preventHeader:true,border:true,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,items:[{xtype:"groupsgrid",itemId:"groupsgrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbGroupsGridHdr",cls:"tbGroupsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblGroupsGrid",cls:"tbGroupsGridHdr",text:"Groups"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("groupsgrid");if(b!=null){b.applyFilter(d,["name","description"])}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"addButton",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"removeButton",handler:function(){var d=this.down("#groupsgrid");if(d){var c=d.getSelectionModel().getSelection();if(c&&c.length>0){var b=d.store;b.remove(c);b.on({save:{fn:function(f,e,g){b.reload()}}});b.save()}else{a.editPanel.showAlert("Error","You must select at least one group to remove.")}}},scope:this}]}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(g,b){var e=g.ownerCt;var c=g.down("#groupsgrid");c.setStore(Ext.create("Ozone.data.GroupStore",g.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&e){if(Ext.isNumeric(e.recordId)){e.record=e.recordId>-1?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}else{e.record=e.recordId?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}}if(e.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("title"),25));if(!j){j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("name"),25))||"Groups"}var h=g.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblGroupsGrid");h.setText(j)}OWF.Preferences.getUserPreference({namespace:"owf.admin.GroupEditCopy",name:"guid_to_launch",onSuccess:function(k){g.guid_EditCopyWidget=k.value},onFailure:function(k){a.editPanel.showAlert("Preferences Error","Error looking up Group Editor: "+k)}});if(c&&e){var i;if(Ext.isNumeric(e.recordId)){i=e.recordId>-1?e.recordId:-1}else{i=e.recordId?e.recordId:-1}var d={tab:"groups"};d[g.componentId]=i;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){g.doEdit(k[l].data.id,k[l].data.displayName)}}else{a.editPanel.showAlert("Error","You must select at least one group to edit.")}},scope:this}})}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("groupsgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent()},onAddClicked:function(b,f){var a=this.ownerCt.record,c=a.get("name")?a.get("name"):a.get("userRealName");var d=Ext.widget("admineditoraddwindow",{addType:"Group",itemName:c,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("groupsgrid").getStore(),searchFields:["displayName"],grid:Ext.widget("groupsgrid",{itemId:"groupsaddgrid",border:false,preventHeader:true,enableColumnHide:false,sortableColumns:false})});d.show()},doEdit:function(d,c){var a=this;var b=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({guid:this.guid_EditCopyWidget,title:"$1 - "+c,titleRegex:/(.*)/,launchOnlyIfClosed:false,data:b},function(e){if(e.error){a.editPanel.showAlert("Launch Error","Group Editor Launch Failed: "+e.message)}})},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}}});Ext.define("Ozone.components.admin.IntentsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.intentstabpanel"],initComponent:function(){Ext.apply(this,{layout:"fit",itemId:"intents-tab",cls:"widgeteditintentstab",iconCls:"intents-tab",title:"Intents",editor:"Widget",componentId:"intent_id",preventHeader:true,border:true,padding:5,items:[{xtype:"intentsgrid",itemId:"intentsGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbIntentsGridHdr",cls:"tbIntentsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblIntentsGrid",cls:"tbIntentsGridHdr",text:"Intents"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(b,c){var a=this.getComponent("intentsGrid");if(a!=null){if(!c){a.clearFilters()}else{a.applyFilter(c)}}},scope:this}}}]},{xtype:"toolbar",itemId:"tbDashboardsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Create",itemId:"btnCreate",handler:this.onCreateOrEdit,disabled:true,scope:this},{xtype:"button",text:"Edit",itemId:"btnEdit",handler:this.onCreateOrEdit,disabled:true,scope:this},{xtype:"button",text:"Delete",itemId:"btnDelete",handler:this.onDelete,disabled:true,scope:this}]}]});this.callParent(arguments);this.on({activate:{scope:this,fn:function(d,c){var b=d.ownerCt;if(b.record.data){var a=Ext.htmlEncode(Ext.util.Format.ellipsis(b.record.get("title"),25))||"Intents";var e=d.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblIntentsGrid");e.setText(a)}},single:true}});this.on({activate:{fn:function(b){var a=b.getComponent("intentsGrid");if(a){a.on({itemdblclick:{fn:function(){var d=this.down("#btnEdit");if(!d.isDisabled()){var c=this.getComponent("intentsGrid").getSelectionModel().getSelection()[0];this.onCreateOrEdit(d)}},scope:this}})}},single:true},afterrender:{fn:function(a){this.ownerCt.on({recordupdated:{fn:function(o){var d=this.getComponent("intentsGrid");var r=d.getStore();var p=o?o.intents:null;var b=[];if(p){for(var n=0;p.send&&n<p.send.length;n++){var c=p.send[n];var h=c.action;for(var m=0;c.dataTypes&&m<c.dataTypes.length;m++){b.push({action:h,dataType:c.dataTypes[m],send:true,receive:false})}}for(var n=0;p.receive&&n<p.receive.length;n++){var c=p.receive[n];var h=c.action;for(var m=0;c.dataTypes&&m<c.dataTypes.length;m++){var q=false;for(var g=0;g<b.length;g++){if(b[g].action==h&&b[g].dataType==c.dataTypes[m]){b[g].receive=true;q=true}}if(!q){b.push({action:h,dataType:c.dataTypes[m],send:false,receive:true})}}}}if(r){r.loadData(b);var f=d.getEl().query(".x-grid-group-hd");if(f){for(var n=0;n<f.length;n++){var e=new Ext.Element(f[n]);var l=e.down(".x-grid-cell-inner");if(l){Ozone.components.focusable.Focusable.setupFocus(l,this);new Ext.util.KeyMap(l,{key:[Ext.EventObject.ENTER,Ext.EventObject.SPACE],fn:function(j,i){i.preventDefault();i.stopPropagation();var k=d.features[0];k.onGroupClick(d.getView(),this)},scope:e.dom});new Ext.util.KeyMap(l,{key:[Ext.EventObject.UP,Ext.EventObject.DOWN],fn:function(t,k){k.preventDefault();k.stopPropagation();var u=(t==Ext.EventObject.UP)?this.previousSibling:this.nextSibling;if(u){var s=Ext.fly(u);var v=s.select(".x-grid-row");if(v){var j=d.getView();var i=j.getRecord(v.elements[0]);j.focus();j.focusRow(i);j.select(i.index);j.addCls("x-grid-view-focus")}}},scope:e.dom})}}}}},scope:this}})},scope:this}})},onCreateOrEdit:function(b,a){var c=this;var e=false,d=null;if(b==c.down("#btnEdit")){e=true;d=this.getComponent("intentsGrid").getSelectionModel().getSelection()[0]}if(!e||(e&&d)){a&&a.stopPropagation();Ext.create("Ozone.components.admin.EditIntentWindow",{title:"Create Intent",action:e?d.get("action"):null,dataType:e?d.get("dataType"):null,send:e?d.get("send"):null,receive:e?d.get("receive"):null,width:Math.round(Ext.getBody().getViewSize().width*0.9),height:260,scope:this,callback:function(h){if(h!=undefined){var l={action:h.action,dataTypes:[h.dataType]},k=c.ownerCt,g=k.store.getById(k.recordId),i=g.get("intents");if(e){var j={action:d.get("action"),dataTypes:[d.get("dataType")]};c.removeIntentFromArray(j,i.send);c.removeIntentFromArray(j,i.receive)}c.removeIntentFromArray(l,i.send);c.removeIntentFromArray(l,i.receive);var f=function(o,n){if(n){for(var m=0;m<n.length;m++){if(n[m].action.toLowerCase()===l.action.toLowerCase()){return n[m].action}}}return o};l.action=f(f(l.action,i.send),i.receive);if(h.send){!i.send&&(i.send=[]);i.send.push(l)}if(h.receive){!i.receive&&(i.receive=[]);i.receive.push(l)}g.beginEdit();g.set("intents",i);g.setDirty();g.endEdit();k.store.save();k.fireEvent("recordupdated",{intents:i});k.down("#widgeteditproperties").getComponent("intents").setValue(Ext.JSON.encode(i))}}}).show()}else{c.editPanel.showAlert("Error","You must select an intent to edit.")}},onDelete:function(b,a){var c=this,d=this.getComponent("intentsGrid").getSelectionModel().getSelection()[0];if(d){c.editPanel.showConfirmation("Delete Intent","This action will permanently delete intent <b>"+Ext.htmlEncode(d.get("action"))+"</b> with data type <b>"+Ext.htmlEncode(d.get("dataType"))+"</b> from this widget.",function(g,k,h){if(g=="ok"){var j={action:d.get("action"),dataTypes:[d.get("dataType")]},i=c.ownerCt,e=i.store.getById(i.recordId),f=e.get("intents");c.removeIntentFromArray(j,f.send);c.removeIntentFromArray(j,f.receive);e.beginEdit();e.set("intents",f);e.setDirty();e.endEdit();i.store.save();i.fireEvent("recordupdated",{intents:f});i.down("#widgeteditproperties").getComponent("intents").setValue(Ext.JSON.encode(f))}})}else{c.editPanel.showAlert("Error","You must select an intent to delete.")}},removeIntentFromArray:function(d,c){if(c){for(var b=0;b<c.length;b++){if(c[b].action.toLowerCase()===d.action.toLowerCase()){if(c[b].dataTypes){for(var a=0;a<c[b].dataTypes.length;a++){if(c[b].dataTypes[a].toLowerCase()==d.dataTypes[0].toLowerCase()){Ext.Array.remove(c[b].dataTypes,c[b].dataTypes[a]);if(c[b].dataTypes.length==0){Ext.Array.remove(c,c[b])}break}}}}}}}});Ext.define("Ozone.components.PropertiesPanel",{extend:"Ext.form.Panel",alias:["widget.propertiespanel","widget.Ozone.components.PropertiesPanel"],layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,editPanel:null,initComponent:function(){var b=this;b.buttonAlign=b.buttonAlign||"left";b.buttons=[{text:"Apply",itemId:"apply",handler:b.onApply,scope:b}];b.defaults=Ext.apply(b.defaults||{},{labelSeparator:"",margin:"5 5 0 5",msgTarget:"side",anchor:"100%",listeners:{blur:{fn:b.handleBlur},change:{fn:b.handleChange},afterrender:{fn:function(e,c){var d=e.getComponentLayout();if(d.errorStrategies!=null){d.previousBeforeLayout=d.beforeLayout;d.beforeLayout=function(g,f){return this.previousBeforeLayout()||!this.owner.preventMark};d.errorStrategies.side={prepare:function(f){var h=f.findParentByType("widgeteditpropertiestab");var g=h?h.loadedFromDescriptor:false;var j=f.errorEl;var i=f.fieldLabel.indexOf("required-label")<0?false:true;if((f.hasActiveError()&&f.changed)||(i&&Ext.isEmpty(f.getValue())&&g)){j.removeCls(["owf-form-valid-field","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls(Ext.baseCSSPrefix+"form-invalid-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveError()||"");if(i&&Ext.isEmpty(f.getValue())){j.setDisplayed(true)}else{j.setDisplayed(f.hasActiveError())}}else{if(f.hasActiveWarning&&f.hasActiveWarning()&&f.changed){j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","owf-form-valid-field","owf-form-unchanged-field"]);j.addCls("x-form-warning-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveWarning()||"");j.setDisplayed(f.hasActiveWarning())}else{if(f.changed&&!g){if(d.tip){d.tip.unregister(j)}j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls("owf-form-valid-field");j.dom.setAttribute("data-errorqtip","");j.setDisplayed(true)}else{j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-valid-field"]);j.dom.setAttribute("data-errorqtip","");j.setDisplayed(false)}}}},adjustHorizInsets:function(f,g){if(f.autoFitErrors){g.insets.right+=f.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(f,g){f.errorEl.setStyle("left",g.width-g.insets.right+"px")},layoutVert:function(f,g){f.errorEl.setStyle("top",g.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:b}}});b.on("afterrender",function(d){var e=d.ownerCt;if(e.record){d.initFieldValues(e.record)}else{e.on("initialdataloaded",d.initFieldValues,d)}if(e.store){e.store.on("write",function(g,f,i){var h=f.getRecords();if(h){var j=h[0];if(j){var k=j.get("id");if(k){e.recordId=k}}}e.enableTabs();b.showApplyAlert("Your changes have been saved.")});if(e.store.proxy){var c=d;e.store.proxy.on("exception",function(j,g,f,i){if("create"==f.action){e.store.removeAll();if(Ext.isFunction(c.initFieldValues)){c.initFieldValues({})}}var h;try{h=(typeof g)=="string"?Ext.JSON.decode(g):g}catch(k){h={errorMsg:g}}b.editPanel.showAlert("Server Error!",Ext.htmlEncode(h.errorMsg))})}}});if(Ozone.config.freeTextEntryWarningMessage!=null&&Ozone.config.freeTextEntryWarningMessage!=""){var a=Ozone.config.freeTextEntryWarningMessage;this.items=this.items||[];this.items.splice(0,0,{xtype:"component",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(a&&a.length>0)?"dialogHeader":"",message:a?a:""}})}this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();b.callParent()},initFieldValues:Ext.emptyFn,handleBlur:function(a){a.changed=true;a.doComponentLayout();if(a.getXType()=="textfield"){a.setValue(Ext.String.trim(a.getValue()))}},handleChange:function(d,c,a,b){if(!d.changed&&d.isDirty()){d.changed=true}},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},onApply:function(){this.validateFields();if(!this.getForm().hasInvalidField()){var b=this;var c=b.ownerCt;var e=this.getValues();if(c.store.data.length>0){var a=c.store.getById(c.recordId);a.beginEdit();for(var d in e){if(!Ext.isFunction(d)){a.set(d,e[d])}}a.endEdit()}else{c.store.add(e);c.store.data.items[0].phantom=true;if(Ext.isFunction(b.initFieldValues)){b.initFieldValues(c.store.data.items[0])}}if(c.store.getNewRecords().length===0&&c.store.getUpdatedRecords().length===0){b.showApplyAlert("Your changes have been saved.")}c.store.save()}else{this.showApplyAlert("Invalid field, changes cannot be saved.",3000)}},showApplyAlert:function(d,c){var b=this,a=this.getDockedItems()[0];if(!a.getComponent(b.applyAlert)){b.applyAlert=Ext.widget("displayfield",{itemId:"applyAlert",name:"applyAlert",cls:"applyAlert",width:450,html:d});a.add(b.applyAlert);Ext.defer(function(){a.remove(b.applyAlert)},c?c:2000)}},validateFields:function(){var a=this.query("textfield");for(var b=0;b<a.length;b++){var c=a[b];if(!Ext.isFunction(c)){c.isValid();this.handleBlur(c)}}}});Ext.define("Ozone.components.admin.UsersTabPanel",{extend:"Ext.panel.Panel",alias:["widget.userstabpanel"],layout:{type:"fit"},preventHeader:true,border:true,padding:5,initDisabled:true,editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{dockedItems:[{xtype:"toolbar",itemId:"usersHeader",cls:"tbUsersGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"usersHeaderLabel",cls:"tbUsersGridHdr",text:"Users"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("usersgrid");if(b!=null){b.applyFilter(d,b.quickSearchFields)}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",itemId:"usersFooter",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"add",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"remove",handler:function(){var d=this.getComponent("usersgrid");var c=d.getStore();var b=d.getSelectionModel().getSelection();if(b&&b.length>0){c.remove(b);c.save()}else{a.editPanel.showAlert("Error","You must select at least one user to remove.")}},scope:this}]}],items:[{xtype:"usersgrid",itemId:"usersgrid",preventHeader:true,border:false}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(j,b){var c=j.getComponent("usersgrid");var h=j.ownerCt;var l=-1;var i=j.getDockedComponent("usersFooter");var e=i.getComponent("add");var m=i.getComponent("remove");var g=h.store.getAt(h.store.findExact("id",h.recordId));if(g.data.automatic){e.setDisabled(true);m.setDisabled(true)}OWF.Preferences.getUserPreference({namespace:"owf.admin.UserEditCopy",name:"guid_to_launch",onSuccess:function(o){j.guid_EditCopyWidget=o.value},onFailure:function(o){a.editPanel.showAlert("Preferences Error","Error looking up User Editor: "+o)}});c.setStore(Ext.create("Ozone.data.UserStore",j.storeCfg));var f=function(o){if(o.action=="destroy"||o.action=="create"){var p=c.getBottomToolbar();p.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(r,s,o,q,p){OWF.Eventing.publish(this.ownerCt.channel,{action:s,domain:this.ownerCt.domain,records:o})},this);if(c&&h){if(Ext.isNumeric(h.recordId)){h.record=h.recordId>-1?h.store.getAt(h.store.findExact("id",h.recordId)):undefined;l=h.recordId>-1?h.recordId:-1}else{h.record=h.recordId?h.store.getAt(h.store.findExact("id",h.recordId)):undefined;l=h.recordId?h.recordId:-1}var d={tab:"users"};d[j.componentId]=l;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var o=c.getSelectionModel().getSelection();if(o&&o.length>0){for(var p=0;p<o.length;p++){j.doEdit(o[p].data.id,o[p].data.userRealName)}}else{a.editPanel.showAlert("Error","You must select at least one user to edit.")}},scope:this}})}if(h.record){var n=Ext.htmlEncode(Ext.util.Format.ellipsis(h.record.get("title"),25));if(!n){n=Ext.htmlEncode(Ext.util.Format.ellipsis(h.record.get("name"),25))||"Users"}var k=j.getDockedItems('toolbar[dock="top"]')[0].getComponent("usersHeaderLabel");k.setText(n)}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("usersgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},onAddClicked:function(a,d){var b=this.ownerCt.record.get("title");if(!b){b=this.ownerCt.record.get("name")}var c=Ext.widget("admineditoraddwindow",{addType:"User",itemName:b,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("usersgrid").getStore(),grid:Ext.widget("usersgrid",{itemId:"usersaddgrid",border:false,enableColumnHide:false,sortableColumns:false})});c.show()},doEdit:function(c,b){var a=Ozone.util.toString({id:c,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+b,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(d){if(d.error){this.editPanel.showAlert("Launch Error","User Editor Launch Failed: "+d.message)}})}});Ext.define("Ozone.components.admin.widget.WidgetEditGroupsTab",{extend:"Ozone.components.admin.GroupsTabPanel",alias:["widget.widgeteditgroups","widget.widgeteditgroupstab","widget.Ozone.components.admin.widget.WidgetEditGroupsTab"],cls:"widgeteditgroupstab",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"tabGroups",iconCls:"groups-tab",editor:"Widget",componentId:"widget_id",title:"Groups",padding:5,widgetRecord:null,storeCfg:{api:{read:"/group",create:"/widget",update:"/group",destroy:"/widget"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"},pageSize:50}});this.callParent()},initBaseParams:function(a){this.baseParams={widget_id:a.data.id};this.applyFilter()}});Ext.define("Ozone.components.admin.widget.WidgetEditUsersTab",{extend:"Ozone.components.admin.UsersTabPanel",alias:["widget.widgeteditusers","widget.widgetedituserstab","widget.Ozone.components.admin.widget.WidgetEditUsersTab"],cls:"widgetedituserstab",preventHeader:true,initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"users-tab",iconCls:"users-tab",title:"Users",editor:"Widget",componentId:"widget_id",storeCfg:{api:{read:"/user",create:"/widget",update:"/user",destroy:"/widget"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.widget.WidgetEditPropertiesTab",{extend:"Ozone.components.PropertiesPanel",alias:["widget.widgeteditproperties","widget.widgeteditpropertiestab","widget.Ozone.components.admin.widget.WidgetEditPropertiesTab"],widgetTypeStore:null,cls:"widgeteditpropertiestab",record:null,xhr:null,initComponent:function(){var b=this;var a=guid.util.guid();this.widgetTypeStore=Ext.create("Ozone.data.WidgetTypeStore");Ext.applyIf(this,{layout:"fit",title:"Properties",iconCls:"properties-tab",defaults:{labelWidth:150},items:[{xtype:"component",itemId:"descriptorUrlInfo",name:"descriptorUrlInfo",cls:"descriptorUrlInfo",renderTpl:'<div class="descriptorUrlHeader"><div class="descriptorUrlTitle">{descriptorUrlTitle}</div><button class="descriptorUrlInfoIcon" ></button></div>',renderData:{descriptorUrlTitle:"Import Widget from Descriptor URL"},renderSelectors:{iconEl:".descriptorUrlInfoIcon",titleEl:".descriptorUrlTitle"},listeners:{afterrender:function(c){c.iconEl.on("click",function(){var d=c.ownerCt.getComponent("descriptorUrlInfoMsg");if(d.isVisible()){d.hide()}else{d.show()}},this);Ozone.components.focusable.Focusable.setupFocus(c.iconEl,this);new Ext.util.KeyMap(c.iconEl,{key:[Ext.EventObject.ENTER],fn:function(e,d){d.stopEvent();var f=this.ownerCt.getComponent("descriptorUrlInfoMsg");if(f.isVisible()){f.hide()}else{f.show()}},scope:c})}}},{xtype:"component",itemId:"descriptorUrlInfoMsg",name:"descriptorUrlInfoMsg",cls:"descriptorUrlInfoMsg",hidden:true,html:"Enter the URL of a Widget Descriptor and click the Load button. Widget data is automatically retrieved from a Web-accessible location. To create the Widget Definition in OWF, click Apply."},{xtype:"urlfield",itemId:"descriptorUrl",name:"descriptorUrl",cls:"descriptorUrlField",allowBlank:true,maxLength:2083,enableKeyEvents:true,preventMark:true,emptyText:"https://mycompany.com/widget/descriptor.html",usePlaceholderIfAvailable:false,value:"",rawValue:"",anchor:"100%",listeners:{change:{fn:this.handleDescriptorUrlChange,scope:this},specialkey:{fn:function(d,c){if(c.getKey()==c.ENTER){this.loadDescriptor(this)}},scope:this}}},{xtype:"toolbar",dock:"bottom",itemId:"descriptorUrlToolbar",name:"descriptorUrlToolbar",cls:"descriptorUrlToolbar",ui:"footer",defaults:{minWidth:75},items:[{text:"<u>Don't have a descriptor URL?</u>",itemId:"manualEntryLinkBtn",cls:"manualEntryLinkBtn",handler:function(c){var d=this.getComponent("descriptorUrl");d.setValue("");this.showProperties(true);this.getComponent("descriptorUrlErrorMsg").hide()},scope:this},"->",{text:"Load",itemId:"descriptorUrlBtn",name:"descriptorUrlBtn",cls:"descriptorUrlBtn",margin:0,disabled:true,handler:function(c){var d=c.getText();if(d=="Load"){this.loadDescriptor(this)}else{var f=this.getComponent("descriptorUrlLoading");var e=this.getComponent("descriptorUrl");if(this.xhr){this.xhr.cancel()}f.hide();e.enable();c.setText("Load")}},scope:this}]},{xtype:"component",itemId:"descriptorUrlLoading",name:"descriptorUrlLoading",cls:"descriptorUrlLoading",hidden:true,html:'<img src="../themes/common/images/shared/large-loading.gif" /><br />Loading...'},{xtype:"component",itemId:"descriptorUrlErrorMsg",name:"descriptorUrlErrorMsg",cls:"descriptorUrlErrorMsg",hidden:true,html:"Unable to retrieve widget information. Please check your descriptor and try again."},{xtype:"component",name:"horizontalRule",itemId:"horizontalRule",cls:"horizontalRule",hidden:true,html:"<hr>"},{xtype:"component",itemId:"manualEntryTitle",name:"manualEntryTitle",cls:"manualEntryTitle",hidden:true,html:"Enter Widget Description"},{xtype:"hidden",name:"widgetGuid",itemId:"widgetGuid",value:a,preventMark:true},{xtype:"textfield",itemId:"name",name:"name",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_displayNameField_blankText,maxLength:256,emptyText:"MyWidget",usePlaceholderIfAvailable:false,fieldLabel:Ozone.util.createRequiredLabel("Name")},{xtype:"textarea",itemId:"description",name:"description",hidden:true,allowBlank:true,maxLength:4000,emptyText:"Describe the widget",usePlaceholderIfAvailable:false,fieldLabel:"Description"},{xtype:"textfield",name:"version",itemId:"version",hidden:true,allowBlank:true,blankText:Ozone.layout.DialogMessages.widgetDefinition_widgetVersionField_blankText,maxLength:256,emptyText:"1.0",usePlaceholderIfAvailable:false,fieldLabel:"Version"},{xtype:"textfield",name:"universalName",itemId:"universalName",hidden:true,allowBlank:true,emptyText:"MyWidget.mycompany.com",usePlaceholderIfAvailable:false,fieldLabel:"Universal Name"},{xtype:"displayfield",fieldLabel:"GUID",itemId:"guid",hidden:true,value:a,preventMark:true},{xtype:"urlfield",name:"url",itemId:"url",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_widgetUrlField_blankText,fieldLabel:Ozone.util.createRequiredLabel("URL"),emptyText:"https://mycompany.com/widget/MyWidget.html",usePlaceholderIfAvailable:false,maxLength:2083},{xtype:"urlfield",name:"headerIcon",itemId:"headerIcon",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_imageUrlSmallField_blankText,maxLength:2083,emptyText:"https://mycompany.com/widget/images/containerIcon.png",usePlaceholderIfAvailable:false,fieldLabel:Ozone.util.createRequiredLabel("Container Icon URL")},{xtype:"urlfield",name:"image",itemId:"image",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_imageLargeUrlField_blankText,maxLength:2083,emptyText:"https://mycompany.com/widget/images/launchMenuIcon.png",usePlaceholderIfAvailable:false,fieldLabel:Ozone.util.createRequiredLabel("Launch Menu Icon URL")},{xtype:"numberfield",name:"width",itemId:"width",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_widthNumberField_blankText,fieldLabel:Ozone.util.createRequiredLabel("Width"),value:200,minValue:200,maxValue:2000},{xtype:"numberfield",name:"height",itemId:"height",hidden:true,allowBlank:false,blankText:Ozone.layout.DialogMessages.widgetDefinition_heightNumberField_blankText,fieldLabel:Ozone.util.createRequiredLabel("Height"),value:200,minValue:200,maxValue:2000},{xtype:"textfield",name:"_tags",itemId:"_tags",hidden:true,emptyText:"geo, map, tracking",usePlaceholderIfAvailable:false,fieldLabel:"Default Tags"},{xtype:"combobox",name:"_types",itemId:"_types",hidden:true,fieldLabel:Ozone.util.createRequiredLabel("Widget Type"),valueNotFoundText:"invalid widget type",forceSelection:true,allowBlank:false,editable:false,store:this.widgetTypeStore,displayField:"name",valueField:"id",autoSelect:true,queryMode:"local"},{xtype:"checkbox",name:"singleton",itemId:"singleton",hidden:true,submitValue:true,fieldLabel:"Singleton",preventMark:true},{xtype:"checkbox",name:"visible",itemId:"visible",hidden:true,submitValue:true,checked:true,fieldLabel:"Visible",preventMark:true},{xtype:"checkbox",name:"background",itemId:"background",hidden:true,submitValue:true,checked:false,fieldLabel:"Background",preventMark:true},{xtype:"hidden",name:"intents",itemId:"intents",value:null,preventMark:true}]});this.addEvents("recordupdated");this.callParent(arguments);this.on("afterrender",function(){var e=this.getDockedItems('toolbar[dock="bottom"]');var c=e[0].getComponent("apply");c.disable();if(this.ownerCt.launchData&&this.ownerCt.launchData.id){this.showProperties(true)}var d=this.getComponent("_types");if(!d.value){this.widgetTypeStore.load({callback:function(){d.setRawValue(d.store.findRecord("name","standard").get("name"));b.setWidgetType()}})}},this,{single:true})},initFieldValues:function(c){var h=this;var z=c?c.data:c;this.record=z;if(z){var y="";var a=(z&&z.widgetGuid)?z.widgetGuid:p.util.guid();var u=h.getComponent("widgetGuid"),A=h.getComponent("name"),r=h.getComponent("description"),d=h.getComponent("version"),w=h.getComponent("universalName"),p=h.getComponent("guid"),e=h.getComponent("url"),g=h.getComponent("headerIcon"),n=h.getComponent("image"),o=h.getComponent("width"),m=h.getComponent("height"),l=h.getComponent("_tags"),k=h.getComponent("singleton"),b=h.getComponent("visible"),t=h.getComponent("background"),f=h.getComponent("_types"),x=h.getComponent("descriptorUrl"),q=h.getComponent("intents");for(var s=0;z&&z.tags&&s<z.tags.length;s++){y+=z.tags[s].name;if(s<z.tags.length-1){y+=", "}}y=Ext.util.Format.htmlDecode(y);u.setValue(a).originalValue=a;A.setValue(z.name).originalValue=z.name;r.setValue(z.description).originalValue=z.description;d.setValue(z.version).originalValue=z.version;w.setValue(z.universalName).originalValue=z.universalName;p.setValue(a).originalValue=a;e.setValue(z.url).originalValue=z.url;g.setValue(z.headerIcon).originalValue=z.headerIcon;n.setValue(z.image).originalValue=z.image;o.setValue(z.width).originalValue=z.width;m.setValue(z.height).originalValue=z.height;l.setValue(y).originalValue=y;k.setValue(z.singleton).originalValue=z.singleton;b.setValue(z.visible).originalValue=z.visible;t.setValue(z.background).originalValue=z.background;if(!x.getValue()){x.setValue(z.descriptorUrl).originalValue=z.descriptorUrl}var j=Ext.JSON.encode(z.intents);q.setValue(j).originalValue=j;this.setWidgetType();h.getComponent("descriptorUrlInfo").titleEl.dom.innerHTML="Update Widget from Descriptor URL";h.getComponent("descriptorUrlInfoMsg").update("Click Load to update the widget. If the widget descriptor file changed since it was added to your instance of OWF, clicking Load will retrieve the latest widget data. To upload it to your OWF, click Apply.");var v=h.ownerCt.down("#intents-tab");v.down("#btnCreate").enable();v.down("#btnEdit").enable();v.down("#btnDelete").enable();this.getForm().isValid()}this.ownerCt.fireEvent("recordupdated",this.record)},loadDescriptor:function(a){var e=a.getComponent("descriptorUrl"),g=a.getComponent("descriptorUrlLoading"),f=Ext.String.trim(e.getValue()),c=a.getComponent("descriptorUrlToolbar").getComponent("descriptorUrlBtn"),b=this.getDockedItems('toolbar[dock="bottom"]')[0].getComponent("apply"),d=descriptorUrlToolbar.getComponent("manualEntryLinkBtn");a.getComponent("descriptorUrlErrorMsg").hide();e.disable();a.showProperties(false);g.show();a.xhr=Ozone.util.Transport.send({url:f,method:"GET",forceXdomain:true,onSuccess:Ext.bind(a.updatePropertiesFromDescriptor,a),onFailure:function(h){if(a.record){a.showProperties(true)}else{d.show()}g.hide();e.enable();c.setText("Load");a.getComponent("descriptorUrlErrorMsg").show()},autoSendVersion:false});c.setText("Cancel");b.disable()},updatePropertiesFromDescriptor:function(B){this.loadedFromDescriptor=true;this.showProperties(true);var l=this;var e=this.getComponent("descriptorUrlLoading");e.hide();var j=this.getComponent("descriptorUrlToolbar").getComponent("descriptorUrlBtn");j.setText("Load");var z=l.getComponent("descriptorUrl");z.enable();this.loadedDecriptorUrl=z.getValue();this.record=B;if(B){var A="";var a=(B&&B.widgetGuid)?B.widgetGuid:this.generateNewGuid();var x=l.getComponent("widgetGuid"),C=l.getComponent("name"),u=l.getComponent("description"),d=l.getComponent("version"),y=l.getComponent("universalName"),s=l.getComponent("guid"),f=l.getComponent("url"),k=l.getComponent("headerIcon"),p=l.getComponent("image"),r=l.getComponent("width"),o=l.getComponent("height"),n=l.getComponent("_tags"),m=l.getComponent("singleton"),b=l.getComponent("visible"),w=l.getComponent("background"),h=l.getComponent("_types"),t=l.getComponent("intents");for(var v=0;B&&B.defaultTags&&v<B.defaultTags.length;v++){A+=B.defaultTags[v];if(v<B.defaultTags.length-1){A+=", "}}A=Ext.util.Format.htmlDecode(A);if(!this.ownerCt.recordId){x.setValue(Ext.String.trim(a));s.setValue(Ext.String.trim(a))}C.setValue(Ext.String.trim(B.displayName));u.setValue(Ext.String.trim(B.description||""));d.setValue(Ext.String.trim(B.widgetVersion||""));y.setValue(Ext.htmlEncode(B.universalName)||"");f.setValue(Ext.String.trim(B.widgetUrl));k.setValue(Ext.String.trim(B.imageUrlSmall));p.setValue(Ext.String.trim(B.imageUrlLarge));r.setValue(B.width);o.setValue(B.height);n.setValue(Ext.String.trim(A));m.setValue(B.singleton);b.setValue(B.visible);w.setValue(B.background);t.setValue(Ext.JSON.encode(B.intents||""));this.record.intents=B.intents||{};var c=B.widgetTypes[0];if(!Ext.isNumeric(c)){h.setRawValue(h.store.findRecord("name","standard").get("name"));c=this.widgetTypeStore.getAt(this.widgetTypeStore.find("name",c)).get("id")}this.getComponent("_types").setValue(c);B.title=Ext.String.trim(B.displayName);this.ownerCt.record=new Ozone.data.WidgetDefinition(B);this.ownerCt.record.phantom=true;var q=this.getDockedItems('toolbar[dock="bottom"]');var g=q[0].getComponent("apply");g.enable()}this.getForm().isValid();this.ownerCt.fireEvent("recordupdated",this.record)},showProperties:function(v){var o=this.getComponent("descriptorUrlToolbar");var q=o.getComponent("manualEntryLinkBtn");q.hide();var g=this;var u=g.getComponent("horizontalRule"),s=g.getComponent("manualEntryTitle"),w=g.getComponent("name"),p=g.getComponent("description"),b=g.getComponent("version"),t=g.getComponent("universalName"),n=g.getComponent("guid"),c=g.getComponent("url"),f=g.getComponent("headerIcon"),k=g.getComponent("image"),m=g.getComponent("width"),j=g.getComponent("height"),i=g.getComponent("_tags"),h=g.getComponent("singleton"),a=g.getComponent("visible"),r=g.getComponent("background"),e=g.getComponent("_types");if(v){var l=this.getDockedItems('toolbar[dock="bottom"]');var d=l[0].getComponent("apply");d.enable();u.show();s.show();w.show();p.show();b.show();t.show();n.show();c.show();f.show();k.show();m.show();j.show();i.show();h.show();a.show();r.show();e.show()}else{u.hide();s.hide();w.hide();p.hide();b.hide();t.hide();n.hide();c.hide();f.hide();k.hide();m.hide();j.hide();i.hide();h.hide();a.hide();r.hide();e.hide()}},handleDescriptorUrlChange:function(f,e,a,b){var d=this,c=this.getForm();descriptorUrlToolbar=this.getComponent("descriptorUrlToolbar");descriptorUrlBtn=descriptorUrlToolbar.getComponent("descriptorUrlBtn");if(!f.changed&&f.isDirty()){f.changed=true}if(f.isValid()&&f.getValue()){descriptorUrlBtn.enable()}else{descriptorUrlBtn.disable()}},onApply:function(){this.validateFields();if(!this.getForm().hasInvalidField()){var b=this;var h=b.ownerCt;var k=null;var d=["widgetGuid","name","description","version","universalName","guid","url","headerIcon","image","width","height","_tags","singleton","visible","background","_types","intents"];var l={};for(var g=0;g<d.length;g++){var o=d[g];var n=this.getComponent(o);var q=n.getValue();if(Ext.isEmpty(q)||(n.inputEl&&n.inputEl.hasCls(n.emptyCls))){if(o in ["singleton","visible","background"]){l[o]=false}else{l[o]=""}}else{if(o=="intents"&&q){l[o]=Ozone.util.parseJson(q)}else{l[o]=q}}}if(b.loadedDecriptorUrl){l.descriptorUrl=b.loadedDecriptorUrl}if(h.store.data.length>0){k=h.store.getById(h.recordId);k.beginEdit();for(o in l){k.set(o,l[o])}k.endEdit()}else{h.store.add(l);k=h.store.data.items[0];k.phantom=true}var r=[];var e=l._tags;if(e&&e.length>0&&e!=""){var p=e.split(",");for(var f=0;f<p.length;f++){var c=Ext.String.trim(p[f]);if(c!=""){r.push({name:c,visible:true,position:-1,editable:true})}}}var m=[];var a=l._types;if(!Ext.isNumeric(a)){a=this.widgetTypeStore.getAt(this.widgetTypeStore.find("name",a)).get("id")}m.push({id:a,name:this.widgetTypeStore.getById(a).get("name")});k.beginEdit();k.set("title",l.name);k.set("tags",r);k.set("widgetTypes",m);k.endEdit();h.record=k;h.store.on({write:{fn:function(){if(Ext.isFunction(b.initFieldValues)){b.showProperties(true);b.initFieldValues(h.record)}this.refreshWidgetLaunchMenu()},scope:this,single:true}});h.store.save()}else{this.showApplyAlert("Invalid field, changes cannot be saved.",3000)}},setWidgetType:function(){var a=this.getComponent("_types");if(a){if(this.record&&this.record.widgetTypes){var b=this.record.widgetTypes[0];if(b){a.setValue(b.id).originalValue=b.id}}}},generateNewGuid:function(){return guid.util.guid()}});Ext.define("Ozone.components.admin.widget.WidgetEditPanel",{extend:"Ext.panel.Panel",alias:["widget.widgetedit","widget.widgeteditpanel","widget.Ozone.components.admin.widget.WidgetEditPanel"],mixins:["Ozone.components.WidgetAlerts"],cls:"widgeteditpanel",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",items:[{xtype:"editwidgetpanel",cls:"adminEditor",bodyCls:"adminEditor-body",dragAndDrop:false,launchesWidgets:false,domain:"Widget",channel:"AdminChannel",store:Ext.create("Ozone.data.stores.AdminWidgetStore",{}),items:[{xtype:"widgeteditproperties",itemId:"widgeteditproperties",editPanel:a},{xtype:"intentstabpanel",itemId:"intentstabpanel",editPanel:a},{xtype:"widgeteditusers",itemId:"widgeteditusers",editPanel:a},{xtype:"widgeteditgroups",itemId:"widgeteditgroups",editPanel:a}]}]});this.callParent(arguments)}});