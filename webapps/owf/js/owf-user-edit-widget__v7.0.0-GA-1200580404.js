var guid=guid||{};var Ozone=Ozone||{};Ozone.util=Ozone.util||{};guid.util=function(){function a(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return{guid:function(){return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}}}();Ozone.util.guid=function(){return guid.util.guid()};Ext.define("Ozone.data.Dashboard",{extend:"Ext.data.Model",idProperty:"guid",fields:["alteredByAdmin","guid",{name:"id",mapping:"guid"},{name:"isdefault",type:"boolean",defaultValue:false},{name:"dashboardPosition",type:"int"},"EDashboardLayoutList","name",{name:"state",defaultValue:[]},"removed","groups","isGroupDashboard","description","createdDate","prettyCreatedDate","editedDate","prettyEditedDate",{name:"stack",defaultValue:null},{name:"locked",type:"boolean",defaultValue:false},{name:"layoutConfig",defaultValue:null},{name:"createdBy",model:"User"},{name:"user",model:"User"}],constructor:function(b,c,a){if(b.layoutConfig&&typeof b.layoutConfig==="string"&&b.layoutConfig!==Object.prototype.toString()){b.layoutConfig=Ext.JSON.decode(b.layoutConfig)}if(b.layoutConfig===Object.prototype.toString()){b.layoutConfig=""}if(!b.guid){b.guid=guid.util.guid()}this.callParent(arguments)}});Ext.define("Ozone.data.stores.AdminDashboardStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Dashboard",alias:"store.admindashboardstore",remoteSort:true,totalProperty:"results",sorters:[{property:"dashboardPosition",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/dashboard",create:"/dashboard",update:"/dashboard",destroy:"/dashboard"},reader:{root:"data"},writer:{root:"data"}});this.callParent(arguments)},reorder:function(){if(this.getCount()>0){for(var b=0;b<this.getCount();b++){var a=this.getAt(b);a.set("dashboardPosition",b+1)}}}});Ext.define("Ozone.data.Group",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"name",type:"string"},{name:"id",type:"int"},{name:"description",type:"string"},{name:"totalWidgets",type:"int"},{name:"totalUsers",type:"int"},{name:"totalStacks",type:"int"},{name:"automatic",type:"boolean"},{name:"stackDefault",type:"boolean"},{name:"status",type:"string"},{name:"displayName",type:"string"},{name:"email",type:"string"},{name:"title",mapping:"displayName"}]});Ext.define("Ozone.data.GroupStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Group",sorters:[{property:"displayName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/group",create:"/group",update:"/group",destroy:"/group"},fields:["id","name","description","totalWidgets","totalUsers","totalStacks","automatic","stackDefault","status","displayName","email"],autoDestroy:true});this.callParent(arguments)}});Ext.define("Ozone.data.Preference",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id",mapping:"id"},{name:"namespace",mapping:"namespace"},{name:"path",mapping:"path"},{name:"value",mapping:"value"},{name:"username",mapping:"user.userId"},{name:"originalNamespace"},{name:"originalPath"},{name:"originalValue"},{name:"title",mapping:"namespace"}]});Ext.define("Ozone.data.stores.PreferenceStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Preference",alias:"store.preferencestore",remoteSort:true,sorters:[{property:"namespace",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/administration/listPreferences",create:"/administration/addCopyPreferenceSubmit",update:"/administration/updatePreference",destroy:"/administration/deletePreferences"}});this.callParent(arguments)}});Ext.define("Ozone.data.Stack",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id",type:"int",defaultValue:-1},{name:"name",type:"string"},{name:"description",type:"string"},{name:"stackContext",type:"string"},{name:"descriptorUrl",type:"string"},{name:"totalDashboards",type:"int"},{name:"totalUsers",type:"int"},{name:"totalGroups",type:"int"},{name:"totalWidgets",type:"int"}]});Ext.define("Ozone.data.StackStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.Stack",sorters:[{property:"name",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/stack",create:"/stack",update:"/stack",destroy:"/stack"},fields:["id","name","description","stackContext","descriptorUrl","totalDashboards","totalUsers","totalGroups","totalWidgets"],autoDestroy:true});this.callParent(arguments)}});Ext.define("Ozone.data.User",{extend:"Ext.data.Model",idProperty:"id",fields:[{name:"id"},{name:"username"},{name:"userRealName"},{name:"email"},{name:"totalGroups"},{name:"totalWidgets"},{name:"totalDashboards"},{name:"totalStacks"},{name:"lastLogin"},{name:"title",mapping:"userRealName"}]});Ext.define("Ozone.data.UserStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.User",alias:"store.userstore",sorters:[{property:"userRealName",direction:"ASC"}],constructor:function(a){a=a?a:{};Ext.applyIf(a,{api:{read:"/user",create:"/user",update:"/user",destroy:"/user"},fields:["id","username","userRealName","email","totalWidgets","totalGroups","totalDashboards","lastLogin"],autoDestroy:true});Ozone.data.UserStore.superclass.constructor.call(this,a)}});Ext.define("Ozone.data.WidgetDefinition",{extend:"Ext.data.Model",idProperty:"widgetGuid",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"value.namespace"},{name:"originalName",mapping:"value.originalName"},{name:"version",mapping:"value.widgetVersion"},{name:"description",mapping:"value.description"},{name:"url",mapping:"value.url"},{name:"headerIcon",mapping:"value.headerIcon"},{name:"image",mapping:"value.image"},{name:"width",mapping:"value.width"},{name:"height",mapping:"value.height"},{name:"widgetGuid",mapping:"path"},{name:"universalName",mapping:"value.universalName"},{name:"maximized",mapping:"value.maximized"},{name:"minimized",mapping:"value.minimized"},{name:"x",mapping:"value.x"},{name:"y",mapping:"value.y"},{name:"visible",mapping:"value.visible"},{name:"definitionVisible",mapping:"value.definitionVisible"},{name:"background",mapping:"value.background"},{name:"disabled",mapping:"value.disabled"},{name:"editable",mapping:"value.editable"},{name:"tags",mapping:"value.tags"},{name:"singleton",mapping:"value.singleton"},{name:"allRequired",mapping:"value.allRequired"},{name:"directRequired",mapping:"value.directRequired"},{name:"userId",mapping:"value.userId"},{name:"userRealName",mapping:"value.userRealName"},{name:"totalUsers",mapping:"value.totalUsers"},{name:"totalGroups",mapping:"value.totalGroups"},{name:"widgetTypes",mapping:"value.widgetTypes"},{name:"descriptorUrl",mapping:"value.descriptorUrl"},{name:"intents",mapping:"value.intents"},{name:"title",mapping:"value.namespace"},{name:"groups",mapping:"value.groups"},{name:"disabled",mapping:"value.disabled"}]});Ext.define("Ozone.data.stores.AdminWidgetStore",{extend:"Ozone.data.OWFStore",model:"Ozone.data.WidgetDefinition",alias:"store.adminwidgetstore",remoteSort:true,sorters:[{property:"name",direction:"ASC"}],constructor:function(a){Ext.applyIf(a,{api:{read:"/widget",create:"/widget",update:"/widget",destroy:"/widget"}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.EditPreferenceWindow",{extend:"Ext.window.Window",alias:["widget.editpreferencewindow","widget.usereditpreferencestab","widget.Ozone.components.admin.EditPreferenceWindow"],mixins:{widget:"Ozone.components.focusable.CircularFocus"},cls:"editpreferencewindow",callback:Ext.emptyFn,scope:undefined,namespace:undefined,path:undefined,value:undefined,username:undefined,resizable:false,modal:true,initComponent:function(){var b=this;var a=Ozone.config.freeTextEntryWarningMessage;if(!this.scope){this.scope=this}Ext.apply(this,{layout:"fit",items:[{xtype:"panel",cls:"usereditpanel",layout:"fit",items:[{xtype:"panel",cls:"adminEditor",bodyCls:"adminEditor-body",layout:"fit",border:false,items:[{xtype:"form",itemId:"form",layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,defaults:{anchor:"100%",msgTarget:"side",labelSeparator:"",margin:"5 5 0 5",listeners:{blur:{fn:function(c){c.changed=true;c.doComponentLayout()},scope:b},change:{fn:function(j,i,d,e){var h=j.ownerCt;var g=h.getForm(),c=h.ownerCt.getDockedItems()[0].getComponent("ok");if(!j.changed&&j.isDirty()){j.changed=true}if(g.isDirty()&&!g.hasInvalidField()){c.enable()}else{c.disable()}},scope:b},afterrender:{fn:function(e,c){var d=e.getComponentLayout();if(d.errorStrategies!=null){d.previousBeforeLayout=d.beforeLayout;d.beforeLayout=function(g,f){return this.previousBeforeLayout()||!this.owner.preventMark};d.errorStrategies.side={prepare:function(f){var g=f.errorEl;if(f.hasActiveError()&&f.changed){g.removeCls("owf-form-valid-field");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-unchanged-field");g.addCls(Ext.baseCSSPrefix+"form-invalid-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);g.dom.setAttribute("data-errorqtip",f.getActiveError()||"");g.setDisplayed(f.hasActiveError())}else{if(f.hasActiveWarning&&f.hasActiveWarning()&&f.changed){g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("owf-form-valid-field");g.removeCls("owf-form-unchanged-field");g.addCls("x-form-warning-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);g.dom.setAttribute("data-errorqtip",f.getActiveWarning()||"");g.setDisplayed(f.hasActiveWarning())}else{if(f.changed){if(d.tip){d.tip.unregister(g)}g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-unchanged-field");g.addCls("owf-form-valid-field");g.dom.setAttribute("data-errorqtip","");g.setDisplayed(true)}else{g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-valid-field");g.dom.setAttribute("data-errorqtip","");g.setDisplayed(false)}}}},adjustHorizInsets:function(f,g){if(f.autoFitErrors){g.insets.right+=f.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(f,g){f.errorEl.setStyle("left",g.width-g.insets.right+"px")},layoutVert:function(f,g){f.errorEl.setStyle("top",g.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:b}}},items:[{xtype:"component",hidden:a==null||a=="",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(a&&a.length>0)?"dialogHeader":"",message:a?a:""}},{xtype:"hidden",value:this.username,name:"username"},{xtype:"textfield",itemId:"nameField",value:this.path,fieldLabel:Ozone.util.createRequiredLabel("Preference Name"),labelWidth:140,allowBlank:false,name:"path",maxLength:200,enforceMaxLength:true},{xtype:"textfield",value:this.namespace,fieldLabel:Ozone.util.createRequiredLabel("Namespace"),labelWidth:140,allowBlank:false,name:"namespace",maxLength:200,enforceMaxLength:true},{xtype:"textarea",value:this.value,fieldLabel:Ozone.util.createRequiredLabel("Value"),labelWidth:140,allowBlank:false,name:"value"}]}],buttons:[{text:"OK",itemId:"ok",disabled:true,handler:function(d,g){this.closeButton=d;var f=d.ownerCt.ownerCt;this.submitValues=f.getComponent("form").getValues();var c=f.getComponent("form").getForm().getFields().items;for(field in c){if(c[field].name){this.submitValues["original"+c[field].name.charAt(0).toUpperCase()+c[field].name.slice(1)]=c[field].originalValue}}this.close()},scope:this},{text:"Cancel",itemId:"cancel",handler:function(c,d){this.closeButton=c;this.close()},scope:this}]}]}]});this.callParent(arguments);this.on("afterrender",function(){this.setupFocus(this.down("#nameField").getFocusEl(),this.down("#cancel").getFocusEl())});this.on("beforeclose",function(c,d){this.callback.call(this.scope,this.submitValues,this.closeButton)})}});Ext.define("Ozone.components.admin.EditDashboardWindow",{extend:"Ext.window.Window",alias:["widget.editdashboardwindow","widget.Ozone.components.admin.EditDashboardWindow"],mixins:{widget:"Ozone.components.focusable.CircularFocus"},cls:"editdashboardwindow",callback:Ext.emptyFn,scope:undefined,guid:undefined,name:undefined,description:undefined,definition:undefined,resizable:false,modal:true,initComponent:function(){var b=this;var a=Ozone.config.freeTextEntryWarningMessage;if(!this.scope){this.scope=this}Ext.apply(this,{layout:"fit",items:[{xtype:"panel",cls:"usereditpanel",layout:"fit",items:[{xtype:"panel",cls:"adminEditor",bodyCls:"adminEditor-body",layout:"fit",border:false,items:[{xtype:"form",itemId:"form",layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,defaults:{anchor:"100%",msgTarget:"side",labelSeparator:"",margin:"5 5 0 5",listeners:{blur:{fn:function(c){c.changed=true;c.doComponentLayout()},scope:b},change:{fn:function(j,i,d,e){var h=j.ownerCt;var g=h.getForm(),c=h.ownerCt.getDockedItems()[0].getComponent("ok");if(!j.changed&&j.isDirty()){j.changed=true}if(g.isDirty()&&!g.hasInvalidField()){c.enable()}else{c.disable()}},scope:b},afterrender:{fn:function(e,c){var d=e.getComponentLayout();if(d.errorStrategies!=null){d.previousBeforeLayout=d.beforeLayout;d.beforeLayout=function(g,f){return this.previousBeforeLayout()||!this.owner.preventMark};d.errorStrategies.side={prepare:function(f){var g=f.errorEl;if(f.hasActiveError()&&f.changed){g.removeCls("owf-form-valid-field");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-unchanged-field");g.addCls(Ext.baseCSSPrefix+"form-invalid-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);g.dom.setAttribute("data-errorqtip",f.getActiveError()||"");g.setDisplayed(f.hasActiveError())}else{if(f.hasActiveWarning&&f.hasActiveWarning()&&f.changed){g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("owf-form-valid-field");g.removeCls("owf-form-unchanged-field");g.addCls("x-form-warning-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);g.dom.setAttribute("data-errorqtip",f.getActiveWarning()||"");g.setDisplayed(f.hasActiveWarning())}else{if(f.changed){if(d.tip){d.tip.unregister(g)}g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-unchanged-field");g.addCls("owf-form-valid-field");g.dom.setAttribute("data-errorqtip","");g.setDisplayed(true)}else{g.removeCls(Ext.baseCSSPrefix+"form-invalid-icon");g.removeCls("x-form-warning-icon");g.removeCls("owf-form-valid-field");g.dom.setAttribute("data-errorqtip","");g.setDisplayed(false)}}}},adjustHorizInsets:function(f,g){if(f.autoFitErrors){g.insets.right+=f.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(f,g){f.errorEl.setStyle("left",g.width-g.insets.right+"px")},layoutVert:function(f,g){f.errorEl.setStyle("top",g.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:b}}},items:[{xtype:"component",hidden:a==null||a=="",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(a&&a.length>0)?"dialogHeader":"",message:a?a:""}},{xtype:"hidden",value:this.guid,name:"guid",preventMark:true,itemId:"guid"},{xtype:"textfield",itemId:"nameField",value:this.name,fieldLabel:Ozone.util.createRequiredLabel("Name"),labelWidth:140,allowBlank:false,name:"name",maxLength:200,enforceMaxLength:true},{xtype:"textarea",value:this.description,fieldLabel:"Description",labelWidth:140,allowBlank:true,name:"description",maxLength:255,enforceMaxLength:true},{xtype:"textarea",value:this.definition,fieldLabel:Ozone.util.createRequiredLabel("Definition"),labelWidth:140,allowBlank:true,name:"definition",height:130,minHeight:130,validator:function(d){try{Ext.decode(d)}catch(c){return"This field must be a valid JSON Object string"}if(d!=null&&d.length>0&&d.charAt(0)=="["&&d.charAt(d.length-1)=="]"){return"This field must be a valid JSON Object string"}return true}}]}],buttons:[{text:"OK",itemId:"ok",disabled:true,handler:function(d,g){this.closeButton=d;var f=d.ownerCt.ownerCt;this.submitValues=f.getComponent("form").getValues();var c=f.getComponent("form").getForm().getFields().items;for(field in c){if(c[field].name){this.submitValues["original"+c[field].name.charAt(0).toUpperCase()+c[field].name.slice(1)]=c[field].originalValue}}this.close()},scope:this},{text:"Cancel",itemId:"cancel",handler:function(c,d){this.closeButton=c;this.close()},scope:this}]}]}]});this.callParent(arguments);this.on("afterrender",function(){this.setupFocus(this.down("#nameField").getFocusEl(),this.down("#cancel").getFocusEl())});this.on("beforeclose",function(c,d){this.callback.call(this.scope,this.submitValues,this.closeButton)})}});Ext.define("Ozone.components.admin.grid.DashboardsGrid",{extend:"Ext.grid.Panel",alias:["widget.dashboardsgrid"],quickSearchFields:["name"],plugins:new Ozone.components.focusable.FocusableGridPanel(),mixins:["Ozone.components.WidgetAlerts"],cls:"grid-dashboard",defaultPageSize:50,forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"admindashboardstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"guid",header:"GUID",dataIndex:"guid",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"name",header:"Dashboard Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(j,b,d,g,e,k,h){var i=j;var a=d.get("EDashboardLayoutList");var c=d.get("layout");var f="grid-dashboard-default-icon-layout";return'<p class="grid-dashboard-title '+f+'">'+Ext.htmlEncode(i)+"</p>"}},{itemId:"widgets",header:"Widgets",dataIndex:"layoutConfig",width:250,sortable:false,renderer:function(g,a,c,e,d,h,f){var b=0;if(g){var i=function(k){if(!k||!k.items){return}if(k.items.length===0){if(k.widgets&&k.widgets.length>0){b+=k.widgets.length}}else{for(var l=0,j=k.items.length;l<j;l++){i(k.items[l])}}return b};b=i(g)}return'<div class="grid-text grid-dashboard-widget-count">'+b+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"dashboard-grid-paging"})]});this.callParent(arguments)},getSelectedDashboards:function(){return this.getSelectionModel().getSelection()},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},doMoveRow:function(h){var g=this.getSelectedDashboards();if(g&&g.length>0){var c=this.store;g.sort(function(j,i){return j.get("dashboardPosition")-i.get("dashboardPosition")});if("up"===h){var f=1;for(var e=0;e<g.length;e++){if(g[e].get("dashboardPosition")===f){f++}else{var a=g[e].get("dashboardPosition"),d=a-1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==d){i.set("dashboardPosition",a)}else{if(j==a){i.set("dashboardPosition",d)}}}})}}}else{var b=c.getCount();for(var e=g.length-1;e>=0;e--){if(g[e].get("dashboardPosition")===b){b--}else{var a=g[e].get("dashboardPosition"),d=a+1;c.each(function(i){var j=i.get("dashboardPosition");if(j){if(j==a){i.set("dashboardPosition",d)}else{if(j==d){i.set("dashboardPosition",a)}}}})}}}if(c.getUpdatedRecords().length){c.sync();c.on("write",function(){this.refresh()},this,{single:true});c.on("load",function(l,k,n,j){for(var m=0;m<g.length;m++){this.getSelectionModel().select(l.indexOfId(g[m].get("id")),true)}},this,{single:true})}}else{this.showAlert("Error","You must select at least one dashboard to move.")}}});Ext.define("Ozone.components.admin.GroupsGrid",{extend:"Ext.grid.Panel",alias:["widget.groupsgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),title:"Groups",columns:[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"Group Name",dataIndex:"displayName",flex:3,renderer:function(e,b,a,f,d,c){return this.renderCell(Ext.htmlEncode(e?e:a.data.name),b,a)}},{header:"Users",dataIndex:"totalUsers",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}},{header:"Widgets",dataIndex:"totalWidgets",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}},{header:"Stacks",dataIndex:"totalStacks",flex:1,sortable:false,renderer:function(e,b,a,f,d,c){return this.renderCell(e,b,a)}}],defaultPageSize:50,multiSelect:true,initComponent:function(){Ext.apply(this,{columnLines:true});this.store=Ext.create("Ozone.data.GroupStore",{id:"groupstore",autoLoad:false,pageSize:this.defaultPageSize});this.bbar=Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",store:this.store,pageSize:this.pageSize,displayInfo:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.pageSize}})},clearFilter:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.pageSize}})},renderCell:function(b,c,a){if(a.get("status")=="inactive"){c.tdCls+=" x-item-disabled"}return b},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)}});Ext.define("Ozone.components.admin.grid.PreferencesGrid",{extend:"Ext.grid.Panel",alias:["widget.preferencesgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-preference",defaultPageSize:50,forceFit:true,baseParams:null,multiSelect:true,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"preferencestore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"name",header:"Preference Name",dataIndex:"path",flex:1,width:210,minWidth:210,sortable:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"namespace",header:"Namespace",dataIndex:"namespace",flex:1,minWidth:200,sortable:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"value",header:"Value",dataIndex:"value",width:250,sortable:false,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"preferences-grid-paging"})]});this.callParent(arguments)},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}}});Ext.define("Ozone.components.admin.StacksGrid",{extend:"Ext.grid.Panel",alias:["widget.stacksgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-stack",title:"Stacks",columns:[{itemId:"id",header:"ID",dataIndex:"id",sortable:true,hidden:true},{header:"Title",dataIndex:"name",flex:8,renderer:function(a){return a?Ext.htmlEncode(a):""}},{header:"URL Name",dataIndex:"stackContext",flex:4,hidden:true,renderer:function(e,b,a,f,d,c){return Ext.htmlEncode(e)}},{header:"Dashboards",dataIndex:"totalDashboards",flex:3,sortable:false},{header:"Widgets",dataIndex:"totalWidgets",flex:3,sortable:false},{header:"Groups",dataIndex:"totalGroups",flex:3,sortable:false},{header:"Users",dataIndex:"totalUsers",flex:3,sortable:false}],defaultPageSize:50,multiSelect:true,initComponent:function(){Ext.apply(this,{columnLines:true});this.store=Ext.create("Ozone.data.StackStore",{id:"stackstore",autoLoad:false,pageSize:this.defaultPageSize});this.bbar=Ext.create("Ext.toolbar.Paging",{itemId:"bottomBar",store:this.store,pageSize:this.pageSize,displayInfo:true});this.relayEvents(this.store,["datachanged"]);this.callParent(arguments)},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.pageSize}})},clearFilter:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)}});Ext.define("Ozone.components.admin.grid.WidgetsGrid",{extend:"Ext.grid.Panel",alias:["widget.widgetsgrid"],plugins:new Ozone.components.focusable.FocusableGridPanel(),cls:"grid-widget",defaultPageSize:50,forceFit:true,baseParams:null,initComponent:function(){if(this.store==null){this.store=Ext.StoreMgr.lookup({type:"adminwidgetstore",pageSize:this.defaultPageSize})}if(this.baseParams){this.setBaseParams(this.baseParams)}Ext.apply(this,{columnLines:true,columns:[{itemId:"universalName",header:"Universal Name",dataIndex:"universalName",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f?Ext.htmlEncode(f):"</div>"}},{itemId:"widgetGuid",header:"GUID",dataIndex:"widgetGuid",flex:1,width:210,minWidth:210,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"name",header:"Title",dataIndex:"name",flex:1,minWidth:200,sortable:true,renderer:function(m,b,f,j,g,n,k){var l=m;var a=f.get("headerIcon");var d=Ozone.util.contextPath();if(!a.match(new RegExp("^/?"+d+"/.*$","i"))&&!a.match(new RegExp("^https?://.*","i"))){if(a.indexOf("/")==0){a=d+a}else{a=d+"/"+a}var i=/admin\/64x64_blue_dashboard.png/g;var h=/admin\/64x64_blue_group.png/g;var e=/admin\/64x64_blue_user.png/g;var o=/admin\/64x64_blue_widget.png/g;if(a.match(i)){a=a.replace(i,"admin/24x24_blue_dashboard.png")}else{if(a.match(h)){a=a.replace(h,"admin/24x24_blue_group.png")}else{if(a.match(e)){a=a.replace(e,"admin/24x24_blue_user.png")}else{if(a.match(o)){a=a.replace(o,"admin/24x24_blue_widget.png")}}}}}var c='<div class="grid-icon-and-text-title-box"><div class="grid-icon-and-text-icon"><img class="grid-icon-and-text-icon-image" src="'+Ext.htmlEncode(a)+'">';c+="</div>";c+='<div class="grid-icon-and-text-title">'+Ext.htmlEncode(l)+"</div>";return c}},{itemId:"widgetUrl",header:"URL",dataIndex:"url",width:250,sortable:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"type",header:"Type",dataIndex:"widgetTypes",width:75,sortable:false,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f[0]?f[0].name:"</div>"}},{itemId:"version",header:"Version",dataIndex:"version",width:75,sortable:true,hidden:true,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+Ext.htmlEncode(f)+"</div>"}},{itemId:"totalUsers",header:"Users",dataIndex:"totalUsers",width:75,hidden:this.hideTotalUsersCol,sortable:false,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}},{itemId:"totalGroups",header:"Groups",dataIndex:"totalGroups",width:75,hidden:this.hideTotalGroupsCol,sortable:false,renderer:function(f,c,b,g,e,d,a){return'<div class="grid-text">'+f+"</div>"}}]});Ext.apply(this,{multiSelect:true,dockedItems:[Ext.create("Ext.toolbar.Paging",{dock:"bottom",store:this.store,displayInfo:true,hidden:this.hidePagingToolbar,itemId:"widget-grid-paging"})]});this.callParent(arguments)},load:function(){this.store.loadPage(1)},refresh:function(){this.store.loadPage(this.store.currentPage)},getTopToolbar:function(){return this.getDockedItems('toolbar[dock="top"]')[0]},getBottomToolbar:function(){return this.getDockedItems('toolbar[dock="bottom"]')[0]},applyFilter:function(d,a){this.store.proxy.extraParams=undefined;if(d){var c=[];for(var b=0;b<a.length;b++){c.push({filterField:a[b],filterValue:d})}this.store.proxy.extraParams={filters:Ext.JSON.encode(c),filterOperator:"OR"}}if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.loadPage(1,{params:{offset:0,max:this.store.pageSize}})},clearFilters:function(){this.store.proxy.extraParams=undefined;if(this.baseParams){this.setBaseParams(this.baseParams)}this.store.load({params:{start:0,max:this.store.pageSize}})},setBaseParams:function(a){this.baseParams=a;if(this.store.proxy.extraParams){Ext.apply(this.store.proxy.extraParams,a)}else{this.store.proxy.extraParams=a}},setStore:function(b,c){this.reconfigure(b,c);var a=this.getBottomToolbar();if(a){a.bindStore(b)}}});Ext.define("Ozone.components.admin.DashboardsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.dashboardstabpanel"],layout:{type:"fit"},preventHeader:true,border:true,padding:5,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,isGroupDashboard:false,editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{items:[{xtype:"dashboardsgrid",itemId:"dashboardsgrid",preventHeader:true,border:false,listeners:{itemdblclick:{fn:this.doEdit,scope:this}}}],dockedItems:[{xtype:"toolbar",itemId:"tbDashboardsGridHdr",cls:"tbDashboardsGridHdr",dock:"top",items:[{xtype:"tbtext",cls:"tbDashboardsGridHdr",itemId:"lblDashboardsGrid",text:"Dashboards"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("dashboardsgrid");if(b!=null){b.applyFilter(d,["name"])}},scope:this}}}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("dashboardsgrid");var e=i.getDockedComponent("tbDashboardsGridHdr");var h=e.getComponent("lblDashboardsGrid");var g=i.ownerCt;var j=-1;c.setStore(Ext.create("Ozone.data.stores.AdminDashboardStore",i.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"dashboards",adminEnabled:true};d[i.componentId]=j;c.setBaseParams(d)}},single:true}});this.on({activate:{fn:function(f,e){var d=f.getComponent("dashboardsgrid");var c=d.getStore();if(f.ownerCt.record){var b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("title"),25));if(!b){b=Ext.htmlEncode(Ext.util.Format.ellipsis(f.ownerCt.record.get("name"),25))||"Dashboards"}var g=this.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblDashboardsGrid");g.setText(b)}if(c){c.load({params:{offset:0,max:c.pageSize}})}},scope:this}});OWF.Preferences.getUserPreference({namespace:"owf.admin.DashboardEditCopy",name:"guid_to_launch",onSuccess:function(b){a.guid_DashboardEditCopyWidget=b.value},onFailure:function(b){a.editPanel.showAlert("Preferences Error","Error looking up Dashboard Editor: "+b)}});this.callParent()},launchFailedHandler:function(a){if(a.error){this.editPanel.showAlert("Launch Error","Dashboard Editor Launch Failed: "+a.message)}},onStoreException:function(f,c,b,d){var a;try{a=Ext.JSON.decode(c)}catch(g){a=c}a&&this.editPanel.showAlert("Server Error",a)},onAddClicked:function(){var a=Ext.widget("admineditoraddwindow",{addType:"Dashboard",itemName:this.ownerCt.record.get("displayName"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("dashboardsgrid").getStore(),grid:Ext.widget("dashboardsgrid",{itemId:"dashboardsaddgrid",border:false,enableColumnHide:false,sortableColumns:false,listeners:{render:{fn:function(b){b.setBaseParams({adminEnabled:true,isGroupDashboard:true,isStackDashboard:false})},scope:this}}})});a.show()},doEdit:function(k,f,l,h,j){var a=this.getComponent("dashboardsgrid");var c=a.getSelectedDashboards();if(c&&c.length>0){for(var d=0;d<c.length;d++){var b=c[d].data.guid;var g=Ozone.util.toString({id:b,copyFlag:false,isGroupDashboard:this.isGroupDashboard});OWF.Launcher.launch({guid:this.guid_DashboardEditCopyWidget,title:"$1 - "+c[d].get("name"),titleRegex:/(.*)/,launchOnlyIfClosed:false,data:g},this.launchFailedHandler)}}else{this.editPanel.showAlert("Error","You must select at least one dashboard to edit")}},doDelete:function(d,f){var c=this.getComponent("dashboardsgrid");var b=c.getStore();var a=c.getSelectedDashboards();if(a&&a.length>0){b.remove(a);b.save()}else{this.editPanel.showAlert("Error","You must select at least one dashboard to remove.")}}});Ext.define("Ozone.components.EditWidgetPanel",{extend:"Ext.panel.Panel",alias:["widget.editwidgetpanel","widget.Ozone.components.EditWidgetPanel"],layout:"card",bodyCls:"editpanel-body",initComponent:function(){this.addEvents("itemcreated","itemupdated","initialdataloaded");this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();OWF.Eventing.subscribe(this.channel,Ext.bind(this.handleSubscriptionEvent,this));this.launchConfig=OWF.Launcher.getLaunchData();if(this.launchConfig!=null){this.launchData=Ozone.util.parseJson(this.launchConfig)}this.widgetState=Ozone.state.WidgetState.getInstance({autoInit:true,onStateEventReceived:Ext.bind(this.handleStateEvent,this)});this.store.on("write",function(d,e,a,c,b){OWF.Eventing.publish(this.channel,{action:e,domain:this.domain,records:a})},this);this.on("itemcreated",function(a){this.recordId=a;OWF.Eventing.publish(this.channel,{action:"created",id:a})},this);this.on("itemupdated",function(a){OWF.Eventing.publish(this.channel,{action:"modified",id:a})},this);this.on("afterrender",function(a,c){if(this.launchConfig!=null){if(!this.launchData.isCreate){this.store.load({params:{id:this.launchData.id},callback:function(){this.record=this.store.getById(this.launchData.id);this.recordId=this.record?this.record.getId():null;this.fireEvent("initialdataloaded",this.record);this.enableTabs()},scope:this})}}else{this.record={};this.fireEvent("initialdataloaded",this.record)}var d=[];for(var b=0;this.items&&b<this.items.getCount();b++){d.push({xtype:"button",pressed:b==0,disabled:this.items.getAt(b).initDisabled,toggleGroup:"editorTabs",allowDepress:false,text:this.items.getAt(b).title,iconCls:this.items.getAt(b).iconCls,icon:this.items.getAt(b).iconCls==undefined?this.items.getAt(b).icon:undefined,iconAlign:"top",scale:"xlarge",index:b,handler:function(f,g){this.getLayout().setActiveItem(f.index)},scope:this})}this.addDocked([{itemId:"editorToolbar",hidden:this.hideEditorToolbar,xtype:"toolbar",cls:"editor-tabs",dock:"top",items:d,enableOverflow:true,listeners:{afterlayout:function(e){e.setHeight(e.getHeight())}}}])},this);this.callParent(arguments)},handleStateEvent:function(a,b){if(b.eventName.indexOf("afterEventIntercept_")==-1){if(b.eventName=="beforeclose"){this.widgetState.removeStateEventOverrides({events:["beforeclose"],callback:Ext.bind(function(){this.widgetState.closeWidget()},this)})}}},handleSubscriptionEvent:function(a,b){if(b.action=="delete"&&b.id==this.recordId){this.closeWidget()}},closeWidget:function(){this.widgetStateHandler.handleWidgetRequest({fn:"closeWidget",params:{guid:Ozone.getInstanceId()}})},enableTabs:function(){var a=this.getDockedComponent("editorToolbar");for(var c=0;a.items&&c<a.items.getCount();c++){var b=a.items.getAt(c);if(b){b.setDisabled(false)}}}});Ext.define("Ozone.components.admin.GroupsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.groupstabpanel","widget.Ozone.components.admin.GroupsTabPanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:"fit",preventHeader:true,border:true,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,items:[{xtype:"groupsgrid",itemId:"groupsgrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbGroupsGridHdr",cls:"tbGroupsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblGroupsGrid",cls:"tbGroupsGridHdr",text:"Groups"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("groupsgrid");if(b!=null){b.applyFilter(d,["name","description"])}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"addButton",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"removeButton",handler:function(){var d=this.down("#groupsgrid");if(d){var c=d.getSelectionModel().getSelection();if(c&&c.length>0){var b=d.store;b.remove(c);b.on({save:{fn:function(f,e,g){b.reload()}}});b.save()}else{a.editPanel.showAlert("Error","You must select at least one group to remove.")}}},scope:this}]}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(g,b){var e=g.ownerCt;var c=g.down("#groupsgrid");c.setStore(Ext.create("Ozone.data.GroupStore",g.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&e){if(Ext.isNumeric(e.recordId)){e.record=e.recordId>-1?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}else{e.record=e.recordId?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}}if(e.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("title"),25));if(!j){j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("name"),25))||"Groups"}var h=g.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblGroupsGrid");h.setText(j)}OWF.Preferences.getUserPreference({namespace:"owf.admin.GroupEditCopy",name:"guid_to_launch",onSuccess:function(k){g.guid_EditCopyWidget=k.value},onFailure:function(k){a.editPanel.showAlert("Preferences Error","Error looking up Group Editor: "+k)}});if(c&&e){var i;if(Ext.isNumeric(e.recordId)){i=e.recordId>-1?e.recordId:-1}else{i=e.recordId?e.recordId:-1}var d={tab:"groups"};d[g.componentId]=i;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){g.doEdit(k[l].data.id,k[l].data.displayName)}}else{a.editPanel.showAlert("Error","You must select at least one group to edit.")}},scope:this}})}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("groupsgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent()},onAddClicked:function(b,f){var a=this.ownerCt.record,c=a.get("name")?a.get("name"):a.get("userRealName");var d=Ext.widget("admineditoraddwindow",{addType:"Group",itemName:c,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("groupsgrid").getStore(),searchFields:["displayName"],grid:Ext.widget("groupsgrid",{itemId:"groupsaddgrid",border:false,preventHeader:true,enableColumnHide:false,sortableColumns:false})});d.show()},doEdit:function(d,c){var a=this;var b=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({guid:this.guid_EditCopyWidget,title:"$1 - "+c,titleRegex:/(.*)/,launchOnlyIfClosed:false,data:b},function(e){if(e.error){a.editPanel.showAlert("Launch Error","Group Editor Launch Failed: "+e.message)}})},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}}});Ext.define("Ozone.components.admin.grid.PreferencesTabPanel",{extend:"Ext.panel.Panel",alias:["widget.preferencestabpanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:{type:"fit"},preventHeader:true,border:true,padding:5,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,initDisabled:true,items:[{xtype:"preferencesgrid",itemId:"preferencesGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbPreferencesGridHdr",cls:"tbPreferencesGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblPreferencesGrid",cls:"tbPreferencesGridHdr",text:"Preferences"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("preferencesGrid");if(b!=null){b.applyFilter(d,["namespace","path","value"])}},scope:this}}}]},{xtype:"toolbar",itemId:"tbPreferencesGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",itemId:"btnCreate",text:"Create",handler:this.onCreateClicked,scope:this},{xtype:"button",itemId:"btnEdit",text:"Edit",handler:function(){this.onEditClicked()},scope:this},{xtype:"button",itemId:"btnDelete",text:"Delete",handler:function(){var d=this.getComponent("preferencesGrid");var c=d.store;var b=d.getSelectionModel().getSelection();if(b&&b.length>0){a.editPanel.showConfirmation("Delete Preferences","This action will permanently delete the selected "+b.length+" preference(s)?",function(e,g,f){if(e=="ok"){c.remove(b);c.save()}})}else{a.editPanel.showAlert("Error","You must select at least one preferences to delete.")}},scope:this}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("preferencesGrid");var e=i.getDockedComponent("tbPreferencesGridHdr");var h=e.getComponent("lblPreferencesGrid");var g=i.ownerCt;c.setStore(Ext.create("Ozone.data.stores.PreferenceStore",i.storeCfg));var f=function(k){if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;if(c&&g){g.record=g.recordId?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;compId=g.recordId?g.record.data.username:"";var d={tab:"preferences"};d[i.componentId]=compId;c.setBaseParams(d)}if(g.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("title"),25))||"Preferences";h.setText(j)}if(c!=null){c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){i.onEditClicked()}}else{a.editPanel.showAlert("Error","You must select at least one preference to edit.")}},scope:this}})}},single:true}});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{fn:function(){var c=this.getComponent("preferencesGrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},onCreateClicked:function(b,a){a.stopPropagation();Ext.create("Ozone.components.admin.EditPreferenceWindow",{title:"Create Preference",username:this.ownerCt.record.data.username,width:Math.round(Ext.getBody().getViewSize().width*0.9),height:Math.round(Ext.getBody().getViewSize().height*0.9),scope:this,callback:function(d,e){if(d!=undefined){var c=this.getComponent("preferencesGrid").getStore();c.add(d);c.save()}}}).show()},onEditClicked:function(){var a=this.getComponent("preferencesGrid").getSelectionModel().getSelection();if(a.length==1){Ext.create("Ozone.components.admin.EditPreferenceWindow",{title:"Edit Preference",namespace:a[0].data.namespace,path:a[0].data.path,value:a[0].data.value,username:this.ownerCt.record.data.username,width:Math.round(Ext.getBody().getViewSize().width*0.9),height:Math.round(Ext.getBody().getViewSize().height*0.9),scope:this,callback:function(d,e){if(d!=undefined){var b=this.getComponent("preferencesGrid").getSelectionModel().getSelection()[0];var c=this.getComponent("preferencesGrid").getStore();b.beginEdit();for(var f in d){if(!Ext.isFunction(f)){b.set(f,d[f])}}b.endEdit();c.save();b.commit()}}}).show()}else{if(a.length<1){this.editPanel.showAlert("Error","You must select at least one preferences to edit.")}else{this.editPanel.showAlert("Error","You can only edit one preference at a time.")}}}});Ext.define("Ozone.components.PropertiesPanel",{extend:"Ext.form.Panel",alias:["widget.propertiespanel","widget.Ozone.components.PropertiesPanel"],layout:"anchor",bodyCls:"properties-body",border:false,bodyBorder:true,preventHeader:true,padding:5,autoScroll:true,editPanel:null,initComponent:function(){var b=this;b.buttonAlign=b.buttonAlign||"left";b.buttons=[{text:"Apply",itemId:"apply",handler:b.onApply,scope:b}];b.defaults=Ext.apply(b.defaults||{},{labelSeparator:"",margin:"5 5 0 5",msgTarget:"side",anchor:"100%",listeners:{blur:{fn:b.handleBlur},change:{fn:b.handleChange},afterrender:{fn:function(e,c){var d=e.getComponentLayout();if(d.errorStrategies!=null){d.previousBeforeLayout=d.beforeLayout;d.beforeLayout=function(g,f){return this.previousBeforeLayout()||!this.owner.preventMark};d.errorStrategies.side={prepare:function(f){var h=f.findParentByType("widgeteditpropertiestab");var g=h?h.loadedFromDescriptor:false;var j=f.errorEl;var i=f.fieldLabel.indexOf("required-label")<0?false:true;if((f.hasActiveError()&&f.changed)||(i&&Ext.isEmpty(f.getValue())&&g)){j.removeCls(["owf-form-valid-field","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls(Ext.baseCSSPrefix+"form-invalid-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{baseCls:Ext.baseCSSPrefix+"form-invalid-tip",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveError()||"");if(i&&Ext.isEmpty(f.getValue())){j.setDisplayed(true)}else{j.setDisplayed(f.hasActiveError())}}else{if(f.hasActiveWarning&&f.hasActiveWarning()&&f.changed){j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","owf-form-valid-field","owf-form-unchanged-field"]);j.addCls("x-form-warning-icon");d.tip=d.tip?d.tip:Ext.create("Ext.tip.QuickTip",{iconCls:"x-form-warning-icon",renderTo:Ext.getBody()});d.tip.tagConfig=Ext.apply({},{attribute:"errorqtip"},d.tip.tagConfig);j.dom.setAttribute("data-errorqtip",f.getActiveWarning()||"");j.setDisplayed(f.hasActiveWarning())}else{if(f.changed&&!g){if(d.tip){d.tip.unregister(j)}j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-unchanged-field"]);j.addCls("owf-form-valid-field");j.dom.setAttribute("data-errorqtip","");j.setDisplayed(true)}else{j.removeCls([Ext.baseCSSPrefix+"form-invalid-icon","x-form-warning-icon","owf-form-valid-field"]);j.dom.setAttribute("data-errorqtip","");j.setDisplayed(false)}}}},adjustHorizInsets:function(f,g){if(f.autoFitErrors){g.insets.right+=f.errorEl.getWidth()}},adjustVertInsets:Ext.emptyFn,layoutHoriz:function(f,g){f.errorEl.setStyle("left",g.width-g.insets.right+"px")},layoutVert:function(f,g){f.errorEl.setStyle("top",g.insets.top+"px")},onFocus:Ext.emptyFn}}},scope:b}}});b.on("afterrender",function(d){var e=d.ownerCt;if(e.record){d.initFieldValues(e.record)}else{e.on("initialdataloaded",d.initFieldValues,d)}if(e.store){e.store.on("write",function(g,f,i){var h=f.getRecords();if(h){var j=h[0];if(j){var k=j.get("id");if(k){e.recordId=k}}}e.enableTabs();b.showApplyAlert("Your changes have been saved.")});if(e.store.proxy){var c=d;e.store.proxy.on("exception",function(j,g,f,i){if("create"==f.action){e.store.removeAll();if(Ext.isFunction(c.initFieldValues)){c.initFieldValues({})}}var h;try{h=(typeof g)=="string"?Ext.JSON.decode(g):g}catch(k){h={errorMsg:g}}b.editPanel.showAlert("Server Error!",Ext.htmlEncode(h.errorMsg))})}}});if(Ozone.config.freeTextEntryWarningMessage!=null&&Ozone.config.freeTextEntryWarningMessage!=""){var a=Ozone.config.freeTextEntryWarningMessage;this.items=this.items||[];this.items.splice(0,0,{xtype:"component",renderTpl:'<div id="{id}" class="{cls}"><div class="headerSpacer"></div>{message}</div>',renderData:{cls:(a&&a.length>0)?"dialogHeader":"",message:a?a:""}})}this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();b.callParent()},initFieldValues:Ext.emptyFn,handleBlur:function(a){a.changed=true;a.doComponentLayout();if(a.getXType()=="textfield"){a.setValue(Ext.String.trim(a.getValue()))}},handleChange:function(d,c,a,b){if(!d.changed&&d.isDirty()){d.changed=true}},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},onApply:function(){this.validateFields();if(!this.getForm().hasInvalidField()){var b=this;var c=b.ownerCt;var e=this.getValues();if(c.store.data.length>0){var a=c.store.getById(c.recordId);a.beginEdit();for(var d in e){if(!Ext.isFunction(d)){a.set(d,e[d])}}a.endEdit()}else{c.store.add(e);c.store.data.items[0].phantom=true;if(Ext.isFunction(b.initFieldValues)){b.initFieldValues(c.store.data.items[0])}}if(c.store.getNewRecords().length===0&&c.store.getUpdatedRecords().length===0){b.showApplyAlert("Your changes have been saved.")}c.store.save()}else{this.showApplyAlert("Invalid field, changes cannot be saved.",3000)}},showApplyAlert:function(d,c){var b=this,a=this.getDockedItems()[0];if(!a.getComponent(b.applyAlert)){b.applyAlert=Ext.widget("displayfield",{itemId:"applyAlert",name:"applyAlert",cls:"applyAlert",width:450,html:d});a.add(b.applyAlert);Ext.defer(function(){a.remove(b.applyAlert)},c?c:2000)}},validateFields:function(){var a=this.query("textfield");for(var b=0;b<a.length;b++){var c=a[b];if(!Ext.isFunction(c)){c.isValid();this.handleBlur(c)}}}});Ext.define("Ozone.components.admin.StacksTabPanel",{extend:"Ext.panel.Panel",alias:["widget.stackstabpanel","widget.Ozone.components.admin.StacksTabPanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:"fit",preventHeader:true,border:true,initDisabled:true,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,items:[{xtype:"stacksgrid",itemId:"stacksgrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbStacksGridHdr",cls:"tbStacksGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblStacksGrid",cls:"tbStacksGridHdr",text:"Stacks"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("stacksgrid");if(b!=null){b.applyFilter(d,["name","description"])}},scope:this}}}]},{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Add",itemId:"addButton",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",text:"Remove",itemId:"removeButton",handler:function(){var d=this.down("#stacksgrid");if(d){var c=d.getSelectionModel().getSelection();if(c&&c.length>0){var b=d.store;b.remove(c);b.on({save:{fn:function(f,e,g){b.reload()}}});b.save()}else{a.editPanel.showAlert("Error","You must select at least one stack to remove.")}}},scope:this}]}]});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{scope:this,fn:function(g,b){var e=g.ownerCt;var c=g.down("#stacksgrid");c.setStore(Ext.create("Ozone.data.StackStore",g.storeCfg));var f=function(k){g.refreshWidgetLaunchMenu();if(k.action=="destroy"||k.action=="create"){var l=c.getBottomToolbar();l.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(n,o,k,m,l){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k})},this);if(c&&e){e.record=e.recordId?e.store.getAt(e.store.findExact("id",e.recordId)):undefined}if(e.record){var j=Ext.htmlEncode(Ext.util.Format.ellipsis(e.record.get("title"),25))||"Stacks";var h=g.getDockedItems('toolbar[dock="top"]')[0].getComponent("lblStacksGrid");h.setText(j)}OWF.Preferences.getUserPreference({namespace:"owf.admin.StackEditCopy",name:"guid_to_launch",onSuccess:function(k){g.guid_EditCopyWidget=k.value},onFailure:function(k){a.editPanel.showAlert("Preferences Error","Error looking up Stack Editor: "+k)}});if(c&&e){var i=e.recordId?e.recordId:-1;var d={tab:"stacks"};d[g.componentId]=i;c.setBaseParams(d);c.on({itemdblclick:{fn:function(){var k=c.getSelectionModel().getSelection();if(k&&k.length>0){for(var l=0;l<k.length;l++){g.doEdit(k[l].data.id,k[l].data.name)}}else{a.editPanel.showAlert("Error","You must select at least one stack to edit.")}},scope:this}})}},single:true}});this.on({activate:{fn:function(){var c=this.getComponent("stacksgrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent()},onAddClicked:function(b,f){var a=this.ownerCt.record,c=a.get("name")?a.get("name"):a.get("userRealName");var d=Ext.widget("admineditoraddwindow",{addType:"Stack",itemName:c,editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("stacksgrid").getStore(),searchFields:["displayName"],grid:Ext.widget("stacksgrid",{itemId:"stacksaddgrid",border:false,preventHeader:true,enableColumnHide:false,sortableColumns:false})});d.show()},doEdit:function(d,c){var a=this;var b=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+c,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:b},function(e){if(e.error){a.editPanel.showAlert("Launch Error","Stack Editor Launch Failed: "+e.message)}})},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}}});Ext.define("Ozone.components.admin.grid.WidgetsTabPanel",{extend:"Ext.panel.Panel",alias:["widget.widgetstabpanel"],editPanel:null,initComponent:function(){var a=this;Ext.apply(this,{layout:{type:"fit"},preventHeader:true,border:true,padding:5,widgetLauncher:null,widgetEventingController:null,widgetStateHandler:null,initDisabled:true,items:[{xtype:"widgetsgrid",itemId:"widgetsGrid",preventHeader:true,border:false}],dockedItems:[{xtype:"toolbar",itemId:"tbWidgetsGridHdr",cls:"tbWidgetsGridHdr",dock:"top",items:[{xtype:"tbtext",itemId:"lblWidgetsGrid",cls:"tbWidgetsGridHdr",text:"Widgets"},"->",{xtype:"searchbox",listeners:{searchChanged:{fn:function(c,d){var b=this.getComponent("widgetsGrid");if(b!=null){b.applyFilter(d,["displayName","universalName"])}},scope:this}}}]},{xtype:"toolbar",itemId:"tbWidgetsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",itemId:"btnAdd",text:"Add",handler:function(){this.onAddClicked()},scope:this},{xtype:"button",itemId:"btnRemove",text:"Remove",handler:function(){var d=this.getComponent("widgetsGrid");var c=d.store;var b=d.getSelectionModel().getSelection();if(b&&b.length>0){c.remove(b);c.save()}else{a.editPanel.showAlert("Error","You must select at least one widget to remove.")}},scope:this}]}]});this.on({activate:{scope:this,fn:function(i,b){var c=i.getComponent("widgetsGrid");var e=i.getDockedComponent("tbWidgetsGridHdr");var h=e.getComponent("lblWidgetsGrid");var g=i.ownerCt;var j=-1;OWF.Preferences.getUserPreference({namespace:"owf.admin.WidgetEditCopy",name:"guid_to_launch",onSuccess:function(l){i.guid_EditCopyWidget=l.value},onFailure:function(l){a.editPanel.showAlert("Preferences Error","Error looking up Widget Editor: "+l)}});c.setStore(Ext.create("Ozone.data.stores.AdminWidgetStore",i.storeCfg));var f=function(l){i.refreshWidgetLaunchMenu();if(l.action=="destroy"||l.action=="create"){var m=c.getBottomToolbar();m.doRefresh()}};c.store.proxy.callback=f;c.store.on("write",function(o,p,l,n,m){OWF.Eventing.publish(this.ownerCt.channel,{action:p,domain:this.ownerCt.domain,records:l})},this);if(c&&g){g.record=g.recordId>-1?g.store.getAt(g.store.findExact("id",g.recordId)):undefined;j=g.recordId>-1?g.recordId:-1;var d={tab:"widgets"};d[i.componentId]=j;c.setBaseParams(d)}if(g.record){var k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("title"),25));if(!k){k=Ext.htmlEncode(Ext.util.Format.ellipsis(g.record.get("name"),25))||"Widgets"}h.setText(k)}if(c!=null){c.on({itemdblclick:{fn:function(){var l=c.getSelectionModel().getSelection();if(l&&l.length>0){for(var m=0;m<l.length;m++){i.doEdit(l[m].data.id,l[m].data.name)}}else{a.editPanel.showAlert("Error","You must select at least one widget to edit.")}},scope:this}})}},single:true}});this.widgetStateHandler=Ozone.state.WidgetStateHandler.getInstance();this.on({activate:{fn:function(){var c=this.getComponent("widgetsGrid");var b=c.getStore();if(b){b.load({params:{offset:0,max:b.pageSize}})}},scope:this}});this.callParent(arguments)},refreshWidgetLaunchMenu:function(){if(this.widgetStateHandler){this.widgetStateHandler.handleWidgetRequest({fn:"refreshWidgetLaunchMenu"})}},doEdit:function(d,c){var b=this;var a=Ozone.util.toString({id:d,copyFlag:false});OWF.Launcher.launch({title:"$1 - "+c,titleRegex:/(.*)/,guid:this.guid_EditCopyWidget,launchOnlyIfClosed:false,data:a},function(e){if(e.error){b.editPanel.showAlert("Launch Error","Widget Editor Launch Failed: "+e.message)}})},onAddClicked:function(a,c){var b=Ext.widget("admineditoraddwindow",{addType:"Widget",itemName:this.ownerCt.record.get("title"),editor:this.editor,focusOnClose:this.down(),existingItemsStore:this.getComponent("widgetsGrid").getStore(),searchFields:["displayName"],grid:Ext.widget("widgetsgrid",{itemId:"widgetsaddgrid",border:false,enableColumnHide:false,sortableColumns:false})});b.show()}});Ext.define("Ozone.components.admin.user.UserEditDashboardsTab",{extend:"Ozone.components.admin.DashboardsTabPanel",alias:["widget.usereditdashboards","widget.usereditdashboardstab","widget.Ozone.components.admin.user.UserEditDashboardsTab"],cls:"usereditdashboardstab",editor:"User",initComponent:function(){Ext.apply(this,{layout:"fit",itemId:"tabDashboards",title:"Dashboards",iconCls:"dashboard-tab",componentId:"user_id",storeCfg:{api:{read:"/dashboard",create:"/dashboard",update:"/dashboard",destroy:"/dashboard"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"DELETE"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments);this.addDocked({xtype:"toolbar",itemId:"tbDashboardsGridFtr",dock:"bottom",ui:"footer",defaults:{minWidth:80},items:[{xtype:"button",text:"Create",itemId:"btnCreate",handler:function(b,a){a.stopPropagation();this.doCreate()},scope:this},{xtype:"splitbutton",text:"Edit",handler:function(){this.doEdit()},scope:this,menuAlign:"bl-tl?",menu:{xtype:"menu",plain:true,defaults:{minWidth:80},items:[{xtype:"owfmenuitem",text:"Copy To Group",handler:function(){this.doCopy()},scope:this}]}},{xtype:"button",text:"Delete",itemId:"btnDelete",handler:function(){this.doDelete()},scope:this}]})},doCreate:function(d,f){var c=this.getComponent("dashboardsgrid");var a=this.ownerCt;var b=a.recordId?a.recordId:-1;Ext.create("Ozone.components.admin.EditDashboardWindow",{title:"Dashboard Editor",width:Ext.getBody().getViewSize().width*0.9,height:Ext.getBody().getViewSize().height*0.9,scope:this,callback:function(h,i){if(h!=undefined){var j=Ext.decode(h.definition);if(j){j.guid=guid.util.guid();if(h.name){j.name=h.name}if(h.description){j.description=h.description}}var g=Ext.StoreMgr.lookup({type:"admindashboardstore"});g.proxy.extraParams.user_id=b;g.add(j);var e=g.data.items[0];e.phantom=true;g.on({write:{fn:function(n,o,k,m,l){if(c&&c.store){OWF.Eventing.publish(this.ownerCt.channel,{action:o,domain:this.ownerCt.domain,records:k});c.store.load()}},scope:this}});if(g.proxy){g.proxy.on({exception:{fn:this.onStoreException,scope:this}})}g.sync()}}}).show()},doEdit:function(i,d,k,g,h){var a=this.getComponent("dashboardsgrid");var b=a.getSelectedDashboards();var f=this.ownerCt.recordId;if(b&&b.length>0){var d=b[0];var c=d?d.data:d;var j=null;if(c){j=owfdojo.toJson(c,true)}Ext.create("Ozone.components.admin.EditDashboardWindow",{title:"Dashboard Editor - "+c.name?Ext.htmlEncode(c.name):"",guid:c.guid?c.guid:"",name:c.name?c.name:"",description:c.description?c.description:"",definition:j?j:"",width:Ext.getBody().getViewSize().width*0.9,height:Ext.getBody().getViewSize().height*0.9,scope:this,callback:function(m,n){if(m!=undefined){var o=Ext.decode(m.definition);if(o){if(m.guid){o.guid=m.guid}if(m.name){o.name=m.name}if(m.description){o.description=m.description}}var l=Ext.StoreMgr.lookup({type:"admindashboardstore"});l.proxy.extraParams.user_id=f;l.add(o);var e=l.data.items[0];e.phantom=true;l.on({write:{fn:function(q,p,r){if(a&&a.store){a.store.load()}},scope:this}});if(l.proxy){l.proxy.on({exception:{fn:this.onStoreException,scope:this}})}l.sync()}}}).show()}else{this.editPanel.showAlert("Error","You must select at least one dashboard to edit.")}},doCopy:function(d,g){var c=this.getComponent("dashboardsgrid");var a=c.getSelectedDashboards();if(a&&a.length>0){var f=[];for(var b=0;b<a.length;b++){f.push(Ozone.util.cloneDashboard(a[b].data,false,true))}this.openCopyWindow(f)}else{this.editPanel.showAlert("Error","You must select at least one dashboard to copy.")}},openCopyWindow:function(c){var a=this;var d="Select one or more groups and click 'OK':";if(a.editor){d="To copy the selected dashboards, select one or more groups and click 'OK':"}var b=Ext.widget("admineditoraddwindow",{addType:"Group",itemName:c.length===1?c[0].name:"Dashboards",editor:this.editor,focusOnClose:this.down(),instructions:d,searchFields:["name","description"],grid:Ext.widget("groupsgrid",{itemId:"groupsaddgrid",preventHeader:true,border:false,enableColumnHide:false,sortableColumns:false}),okFn:function(){var h=b.down("#groupsaddgrid");if(h){var e=h.getSelectionModel().getSelection();if(e&&e.length>0){var f=[];for(var g=0;g<e.length;g++){f.push(e[g].data)}Ozone.util.Transport.send({url:Ozone.util.contextPath()+"/group/copyDashboard",method:"POST",onSuccess:Ext.bind(function(j){var i=this.down("#dashboardsgrid");if(i){i.refresh()}},this),onFailure:function(i){a.editPanel.showAlert("Error","Error while copying dashboard(s): "+i)},autoSendVersion:false,content:{isGroupDashboard:true,groups:Ext.encode(f),dashboards:Ext.encode(c)}})}}}});b.show()},doDelete:function(c,f){var b=this.getComponent("dashboardsgrid"),a=b.getStore();records=b.getSelectedDashboards();if(records&&records.length>0){var g="This action will permanently delete the selected dashboard(s)";if(records.length==1){g='This action will permanently delete <span class="heading-bold">'+Ext.htmlEncode(records[0].data.name)+"</span>."}else{g='This action will permanently delete the selected <span class="heading-bold">'+records.length+" dashboards</span>."}var d=function(e,i,h){if(e=="ok"){a.remove(records);a.save()}};this.editPanel.showConfirmation("Warning",g,d)}else{this.editPanel.showAlert("Error","You must select at least one dashboard to delete.")}}});Ext.define("Ozone.components.admin.user.UserEditPreferencesTab",{extend:"Ozone.components.admin.grid.PreferencesTabPanel",alias:["widget.usereditpreferences","widget.usereditpreferencestab","widget.Ozone.components.admin.user.UserEditPreferencesTab"],cls:"usereditpreferencestab",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"tabPreferences",title:"Preferences",iconCls:"preferences-tab",editor:"User",componentId:"username",storeCfg:{api:{read:"/administration/listPreferences",create:"/administration/addCopyPreferenceSubmit",update:"/administration/updatePreference",destroy:"/administration/deletePreferences"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"},reader:{root:"rows"}}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.user.UserEditPropertiesTab",{extend:"Ozone.components.PropertiesPanel",alias:["widget.usereditproperties","widget.usereditpropertiestab","widget.Ozone.components.admin.user.UserEditPropertiesTab"],cls:"usereditpropertiestab",initComponent:function(){Ext.apply(this,{title:"Properties",iconCls:"properties-tab",items:[{xtype:"textfield",name:"username",fieldLabel:Ozone.util.createRequiredLabel("User Name"),disabledCls:"properties-field-disabled",maxLength:200,allowBlank:false,disable:function(a){var b=this;if(b.rendered){b.el.addCls(b.disabledCls);b.onDisable()}b.disabled=true;if(a!==true){b.fireEvent("disable",b)}return b},itemId:"username"},{xtype:"textfield",fieldLabel:Ozone.util.createRequiredLabel("Full Name"),name:"userRealName",itemId:"userRealName",allowBlank:false,maxLength:200},{xtype:"textfield",allowBlank:true,fieldLabel:"Email",name:"email",itemId:"email",vtype:"email",maxLength:200}]});this.callParent(arguments)},initFieldValues:function(a){var c=this;var e=a?a.data:a;if(e){var f=c.getComponent("username"),d=c.getComponent("userRealName"),b=c.getComponent("email");f.setValue(e.username).originalValue=e.username;f.setDisabled(true);d.setValue(e.userRealName).originalValue=e.userRealName;b.setValue(e.email).originalValue=e.email}}});Ext.define("Ozone.components.admin.user.UserEditGroupsTab",{extend:"Ozone.components.admin.GroupsTabPanel",alias:["widget.usereditgroups","widget.usereditgroupstab","widget.Ozone.components.admin.user.UserEditGroupsTab"],cls:"usereditgroupstab",initComponent:function(){Ext.applyIf(this,{layout:"fit",padding:5,itemId:"tabGroups",iconCls:"groups-tab",editor:"User",componentId:"user_id",title:"Groups",storeCfg:{api:{read:"/group",create:"/user",update:"/group",destroy:"/user"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"},pageSize:50},addFilter:{automatic:false}});this.callParent()},initBaseParams:function(a){this.baseParams={user_id:a.data.id};this.applyFilter()}});Ext.define("Ozone.components.admin.user.UserEditStacksTab",{extend:"Ozone.components.admin.StacksTabPanel",alias:["widget.usereditstacks","widget.usereditstackstab","widget.Ozone.components.admin.user.UserEditStacksTab"],cls:"usereditstackstab",initComponent:function(){Ext.apply(this,{padding:5,iconCls:"stacks-tab",editor:"Stack",componentId:"user_id",title:"Stacks",storeCfg:{api:{read:"/stack",create:"/user",update:"/stack",destroy:"/user"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"},pageSize:50}});this.callParent(arguments)},initBaseParams:function(a){this.baseParams={user_id:a.data.id};this.applyFilter()}});Ext.define("Ozone.components.admin.user.UserEditWidgetsTab",{extend:"Ozone.components.admin.grid.WidgetsTabPanel",alias:["widget.usereditwidgets","widget.usereditwidgetstab","widget.Ozone.components.admin.user.UserEditWidgetsTab"],cls:"usereditwidgetstab",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",itemId:"tabWidgets",title:"Widgets",iconCls:"widgets-tab",editor:"User",componentId:"user_id",storeCfg:{api:{read:"/widget",create:"/user",update:"/widget",destroy:"/user"},methods:{read:"GET",load:"GET",create:"PUT",update:"PUT",save:"POST",destroy:"PUT"},updateActions:{destroy:"remove",create:"add"}}});this.callParent(arguments)}});Ext.define("Ozone.components.admin.user.UserEditPanel",{extend:"Ext.panel.Panel",alias:["widget.useredit","widget.usereditpanel","widget.Ozone.components.admin.user.UserEditPanel"],mixins:["Ozone.components.WidgetAlerts"],cls:"usereditpanel",initComponent:function(){var a=this;Ext.applyIf(this,{layout:"fit",items:[{xtype:"editwidgetpanel",cls:"adminEditor",bodyCls:"adminEditor-body",dragAndDrop:false,launchesWidgets:false,domain:"User",channel:"AdminChannel",store:Ext.create("Ozone.data.UserStore",{}),items:[{xtype:"usereditproperties",itemId:"usereditproperties",editPanel:a},{xtype:"usereditgroups",itemId:"usereditgroups",editPanel:a},{xtype:"usereditwidgets",itemId:"usereditwidgets",editPanel:a},{xtype:"usereditdashboards",itemId:"usereditdashboards",editPanel:a},{xtype:"usereditstacks",itemId:"usereditstacks",editPanel:a},{xtype:"usereditpreferences",itemId:"usereditpreferences",editPanel:a}]}]});this.callParent(arguments)}});