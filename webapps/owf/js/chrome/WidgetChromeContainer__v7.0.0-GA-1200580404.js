var Ozone=Ozone?Ozone:{};Ozone.chrome=Ozone.chrome?Ozone.chrome:{};Ozone.chrome.WidgetChromeContainer=function(c){var n=this;this.channelName="Ozone._WidgetChromeChannel";this.dashboard=null;n.registerChromeMenuHandlers=function(o,q){if(o.menu){o.menu.componentCls="widgetmenubar";o.menu.tabIndex=0;for(var p=0;p<o.menu.items.length;p++){var r=o.menu.items[p];if(!r.menu){r.handler=function(){var s=gadgets.json.stringify({itemId:this.itemId});gadgets.rpc.call(q,n.channelName,null,"..",s)}}else{n.registerChromeMenuHandlers(r,q)}}}else{o.handler=function(){var s=gadgets.json.stringify({itemId:this.itemId});gadgets.rpc.call(q,n.channelName,null,"..",s)}}};var d=function(r,o){var p={};if(r===undefined){return}for(var q=0;q<o.length;q++){if(r[o[q]]){p[o[q]]=Ext.htmlEncode(r[o[q]])}}return p},m=function(o){var p=d(o,["itemId","xtype","type","icon","text","disabled"]);p.tooltip=d(o.tooltip,["title","text"]);return p},f=function(p){var o=d(p,["itemId","parentId","icon","text","disabled"]);if(p.menu){o.menu={};o.menu.items=Ext.Array.map(p.menu.items,f)}return o};var g=function(r,q){var o={success:false},y;var x=Ozone.util.parseJson(r);if(x!=null){var w=Ext.getCmp(x.id);if(w!=null){if(q.items!=null){var u=q.items;if(!Ext.isArray(q.items)){u=[q.items]}for(var s=0;s<u.length;s++){if(q.type==="button"){y=m(u[s]);y.handler=function(){var z=gadgets.json.stringify({itemId:this.itemId});gadgets.rpc.call(r,n.channelName,null,"..",z)};if(y.xtype==="button"){y.tabIndex=0}w.addTool(y);w.headerModified=true}else{if(q.type==="menu"){y=f(u[s]);n.registerChromeMenuHandlers(y,r);k(y);var v=w.getDockedComponent("menuBar");if(!v){v=Ext.create("Ext.toolbar.Toolbar",{itemId:"menuBar",cls:"widgetmenubar",enableOverflow:true,style:{overflow:"hidden"},layout:{overflowHandler:{type:"StyleableMenu"}},items:[]});w.addDocked(v)}if(y.parentId){var p=v.down("#"+y.parentId);if(p){p.menu.add(y);w.headerModified=true}}else{v.add(y);var t=v.items.length==1?true:false;if(t){w.forceComponentLayout()}w.headerModified=true}}}}}o.success=true}}return gadgets.json.stringify(o)};var l=function(r,q){var o={success:false},y;var x=Ozone.util.parseJson(r);if(x!=null){var w=Ext.getCmp(x.id);if(w!=null){if(q.items!=null){q.pos=q.pos?q.pos:0;var u=q.items;if(!Ext.isArray(q.items)){u=[q.items]}for(var s=0;s<u.length;s++){if(q.type==="button"){y=m(u[s]);y.handler=function(){var z=gadgets.json.stringify({itemId:this.itemId});gadgets.rpc.call(r,n.channelName,null,"..",z)};w.insertTool(y,q.pos+s);w.headerModified=true}else{if(q.type==="menu"){y=f(u[0]);n.registerChromeMenuHandlers(y,r);k(y);var v=w.getDockedComponent("menuBar");if(!v){v=Ext.create("Ext.toolbar.Toolbar",{itemId:"menuBar",cls:"widgetmenubar",enableOverflow:true,style:{overflow:"hidden"},layout:{overflowHandler:{type:"StyleableMenu"}},items:[]});w.addDocked(v)}if(y.parentId){var p=v.down("#"+y.parentId);if(p){p.menu.insert(q.pos+s,y);w.headerModified=true}}else{v.insert(q.pos+s,y);var t=v.items.length==1?true:false;if(t){w.forceComponentLayout()}w.headerModified=true}}}}o.success=true}}}return gadgets.json.stringify(o)};var a=function(r,q){var o={success:false},z;var y=Ozone.util.parseJson(r);if(y!=null){var x=Ext.getCmp(y.id);if(x!=null){o.success=true;var u=q.items;if(!Ext.isArray(q.items)){u=[q.items]}for(var s=0;s<u.length;s++){if(q.type==="button"){z=m(u[0]);z.handler=function(){var A=gadgets.json.stringify({itemId:this.itemId});gadgets.rpc.call(r,n.channelName,null,"..",A)};x.updateTool(z);x.headerModified=true}else{if(q.type==="menu"){z=f(u[0]);n.registerChromeMenuHandlers(z,r);k(z);var v=x.getDockedComponent("menuBar");if(v){var t=v.down("#"+z.itemId);var p=t.ownerCt;var w=p.items.indexOfKey(z.itemId);if(w>-1){p.remove(z.itemId,true);p.insert(w,z);x.headerModified=true}else{alert("Error updating menu. Invalid itemId")}}}}}}}return gadgets.json.stringify(o)};var b=function(r,q){var o={success:false};var x=Ozone.util.parseJson(r);if(x!=null){var w=Ext.getCmp(x.id);if(w!=null){o.success=true;var u=q.items;if(!Ext.isArray(q.items)){u=[q.items]}for(var s=0;s<u.length;s++){var y=Ext.apply({},u[s]);if(q.type==="button"){w.removeTool(y.itemId)}else{if(q.type==="menu"){var v=w.getDockedComponent("menuBar");if(v){var t=v.down("#"+y.itemId);if(t){var p=t.ownerCt;p.remove(y.itemId,true);if(v.items.items.length==0){w.removeDocked(v)}}}}}}}}return gadgets.json.stringify(o)};var i=function(r,q){var o={success:false};var w=Ozone.util.parseJson(r);if(w!=null){var u=Ext.getCmp(w.id);if(u!=null){o.success=true;o.items=[];if(q.type=="button"&&u.tools!=null){for(var s in u.tools){o.items.push(u.tools[s].id)}}else{if(q.type=="menu"){function v(x){var z=[];if(x.itemId){z.push(x.itemId)}if(x.menu){for(var y=0;y<x.menu.items.items.length;y++){z=z.concat(v(x.menu.items.items[y]))}}return z}var t=u.getDockedComponent("menuBar");if(t){for(var s=0;s<t.items.length;s++){var p=v(t.items.items[s]);o.items=o.items.concat(p)}}}}}}return gadgets.json.stringify(o)};var j=function(o,s){var p={success:false};var r=Ozone.util.parseJson(o);if(r!=null){var q=Ext.getCmp(r.id);if(q!=null){p.success=true;p.modified=(q.headerModified==true)}}return gadgets.json.stringify(p)};var k=function(o){if(o.menu){o.menu.listeners={hide:function(q){var p=Ext.getCmp(q.constrainTo.id);if(p){p.getFocusEl().focus()}}}}};var h=function(o){var p={success:false};var r=Ozone.util.parseJson(o);if(r!=null){var q=Ext.getCmp(r.id);if(q!=null){p.success=true;p.title=q.title}}return gadgets.json.stringify(p)};var e=function(o,s){var p={success:false};var r=Ozone.util.parseJson(o);if(r!=null){var q=Ext.getCmp(r.id);if(q!=null&&q.setTitle!=null){p.success=true;q.setTitle(s.title);p.title=q.title}}return gadgets.json.stringify(p)};if(c!=null&&c.eventingContainer!=null){this.eventingContainer=c.eventingContainer;this.eventingContainer.registerHandler(this.channelName,function(o,r){var p=true;var q=Ozone.util.parseJson(r);switch(q.action){case"isModified":p=j(o,q);break;case"addHeaderButtons":p=g(o,q);break;case"updateHeaderButtons":p=a(o,q);break;case"insertHeaderButtons":p=l(o,q);break;case"removeHeaderButtons":p=b(o,q);break;case"listHeaderButtons":p=i(o,q);break;case"addHeaderMenus":p=g(o,q);break;case"updateHeaderMenus":p=a(o,q);break;case"insertHeaderMenus":p=l(o,q);break;case"removeHeaderMenus":p=b(o,q);break;case"listHeaderMenus":p=i(o,q);break;case"getTitle":p=h(o,q);break;case"setTitle":p=e(o,q);break;default:}return p})}else{throw {name:"WidgetChromeContainerException",message:"eventingContainer is null"}}};