Ext.namespace("Ozone.form");Ozone.form.ComboBox=Ext.extend(Ext.form.ComboBox,{doQuery:function(c,b){if(Ext.isEmpty(this.queryField)){this.queryField=this.displayField}if(c===undefined||c===null){c=""}var a={query:c,forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false}c=a.query;b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode=="local"){this.selectedIndex=-1;if(b){this.store.clearFilter()}else{this.store.filter(this.queryField,c)}this.onLoad()}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},onTypeAhead:function(){if(Ext.isEmpty(this.queryField)){this.queryField=this.displayField}if(this.store.getCount()>0){var b=this.store.getAt(0);var c=b.data[this.queryField];var a=c.length;var d=this.getRawValue().length;if(d!=a){this.setRawValue(c);this.selectText(d,c.length)}}},assertValue:function(){var c=this.getRawValue();var b=null;if(this.value&&this.valueField){var a=this.findRecord(this.valueField,this.value);if(c==a.get(this.displayField)){b=a}}if(!b){b=this.findRecord(this.displayField,c)}if(!b&&this.forceSelection){if(c.length>0&&c!=this.emptyText){this.el.dom.value=Ext.value(this.lastSelectionText,"");this.applyEmptyText()}else{this.clearValue()}}else{if(b){if(c==b.get(this.displayField)&&this.value==b.get(this.valueField)){return}c=b.get(this.valueField||this.displayField)}this.setValue(c)}},setValue:function(a){if(Ext.isEmpty(this.queryField)){this.queryField=this.displayField}var c=a;if(this.valueField){var b=this.findRecord(this.valueField,a);if(b){c=b.data[this.queryField]}else{if(this.valueNotFoundText!==undefined){c=this.valueNotFoundText}}}this.lastSelectionText=c;if(this.hiddenField){this.hiddenField.value=a}Ext.form.ComboBox.superclass.setValue.call(this,c);this.value=a},restrictHeight:function(){this.innerList.dom.style.height="";var b=this.innerList.dom;var e=this.list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight;var c=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight);var a=this.getPosition()[1]-Ext.getBody().getScroll().top;var f=Ext.core.Element.getViewportHeight()-a-this.getSize().height;var d=Math.max(a,f,this.minHeight||0)-e-2;if((this.shadow!=undefined)&&(this.shadow!=false)){d-=this.list.shadow.offset}c=Math.min(c,d,this.maxHeight);if(Ext.isIE&&b.scrollWidth>b.offsetWidth){c+=20}this.innerList.setHeight(c+2);this.list.beginUpdate();this.list.setHeight(c+e);this.list.alignTo(this.el,this.listAlign);this.list.endUpdate()}});