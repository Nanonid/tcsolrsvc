Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.ux.layout.component.form.ItemSelector","Ext.button.Button"],hideNavIcons:false,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},multiselects:[],componentLayout:"itemselectorfield",fieldBodyCls:Ext.baseCSSPrefix+"form-itemselector-body",bindStore:function(b,c){var d=this,a=d.toField,f=d.fromField,e;d.callParent(arguments);if(a){a.store.removeAll();f.store.removeAll();e=[];d.store.each(function(g){e.push(g.copy(g.getId()))});f.store.add(e)}},onRender:function(e,c){var k=this,b=Ext.baseCSSPrefix,f="ItemSelectorDD-"+Ext.id(),d={displayField:k.displayField,valueField:k.valueField,dragGroup:f,dropGroup:f,flex:1,hideLabel:true},j=Ext.apply({listTitle:"Available",store:Ext.create("Ext.data.Store",{model:k.store.model}),listeners:{boundList:{itemdblclick:k.onItemDblClick,scope:k}}},k.multiselects[0],d),h=Ext.apply({listTitle:"Selected",store:Ext.create("Ext.data.Store",{model:k.store.model}),listeners:{boundList:{itemdblclick:k.onItemDblClick,scope:k},change:k.onToFieldChange,scope:k}},k.multiselects[1],d),l=Ext.widget("multiselect",j),g=Ext.widget("multiselect",h),a,i=[];Ext.ux.form.MultiSelect.superclass.onRender.call(k,e,c);k.fromField=l;k.toField=g;if(!k.hideNavIcons){Ext.Array.forEach(k.buttons,function(m){i.push({xtype:"button",tooltip:k.buttonsText[m],handler:k["on"+Ext.String.capitalize(m)+"BtnClick"],cls:b+"form-itemselector-btn",iconCls:b+"form-itemselector-"+m,scope:k});i.push({xtype:"component",height:3,width:1,style:"font-size:0;line-height:0"})})}a=k.innerCt=Ext.widget("container",{renderTo:k.bodyEl,layout:{type:"hbox",align:"middle"},items:[k.fromField,{xtype:"container",margins:"0 4",items:i},k.toField]});a.ownerCt=k;k.bindStore(k.store);k.setRawValue(k.rawValue)},onToFieldChange:function(){this.checkChange()},onTopBtnClick:function(){var a=this.toField.boundList;a.getStore().insert(0,a.getSelectionModel().getSelection())},onBottomBtnClick:function(){var b=this.toField.boundList,a=b.getStore();a.insert(a.getCount(),b.getSelectionModel().getSelection())},onUpBtnClick:function(){var c=this.toField.boundList,a=c.getStore(),b=c.getSelectionModel().getSelection();Ext.Array.each(b,function(e){var d=a.indexOf(e);if(d===0){return false}a.insert(d-1,e)})},onDownBtnClick:function(){var c=this.toField.boundList,a=c.getStore(),b=c.getSelectionModel().getSelection();Ext.Array.each(b.reverse(),function(e){var d=a.indexOf(e);if(d===a.getCount()-1){return false}a.insert(d+1,e)})},onAddBtnClick:function(){var b=this,c=b.fromField.boundList,a=c.getSelectionModel().getSelection();c.getStore().remove(a);this.toField.boundList.getStore().add(a)},onRemoveBtnClick:function(){var c=this,b=c.toField.boundList,a=b.getSelectionModel().getSelection();b.getStore().remove(a);this.fromField.boundList.getStore().add(a)},onItemDblClick:function(a){var b=this;if(a==b.toField.boundList){b.onRemoveBtnClick()}else{if(a==b.fromField.boundList){b.onAddBtnClick()}}},setRawValue:function(e){var c=this,b=Ext.Array,d,a,f;e=b.from(e);c.rawValue=e;if(c.toField){d=c.toField.boundList.getStore();a=c.fromField.boundList.getStore();a.add(d.getRange());d.removeAll();f=[];Ext.Array.forEach(e,function(i){var h,g=a.findRecord(c.valueField,i,h,h,true,true);if(g){f.push(g)}});a.remove(f);d.add(f)}return e},getRawValue:function(){var b=this,a=b.toField,c=b.rawValue;if(a){c=Ext.Array.map(a.boundList.getStore().getRange(),function(d){return d.get(b.valueField)})}b.rawValue=c;return c},updateReadOnly:function(){var a=this,b=a.readOnly||a.disabled;if(a.rendered){a.toField.setReadOnly(b);a.fromField.setReadOnly(b);Ext.Array.forEach(a.innerCt.query("button"),function(c){c.setDisabled(b)})}},onDestroy:function(){Ext.destroyMembers(this,"innerCt");this.callParent()}});