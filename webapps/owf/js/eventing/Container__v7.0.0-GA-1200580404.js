var Ozone=Ozone?Ozone:{};Ozone.eventing=Ozone.eventing?Ozone.eventing:{};(function(b,a,c){Ozone.eventing.Container=function(){var g={widgetEventingReady:[],onRoute:[],onPublish:[],onSubscribe:[],onUnsubscribe:[]},f={},e={};function d(m,r){if((b.name==="undefined")||(b.name==="")){b.name="ContainerWindowName"+Math.random()}var h=gadgets.json.parse(r);var p=h.useMultiPartMessagesForIFPC;var j=null;if(h.id.charAt(0)!="{"){j=h.id}else{var l=gadgets.json.parse(h.id);var k=l.id;j=gadgets.json.stringify({id:l.id})}gadgets.rpc.setRelayUrl(j,h.relayUrl,false,p);gadgets.rpc.setAuthToken(j,0);for(var n=0,o=g.widgetEventingReady.length;n<o;n++){g.widgetEventingReady[n].fn.call(g.widgetEventingReady[n].scope,m,r)}var q='{"id":"'+b.name+'"}';gadgets.rpc.call(j,"after_container_init",null,b.name,q)}return{name:"OWF",version:Ozone.version.owfversion+Ozone.version.eventing,init:function(h){e=h||{};this.setContainerRelay(e.containerRelay!=null?e.containerRelay:Ozone.util.getContainerRelay());if(e.widgetEventingReady!=null){g.widgetEventingReady.push(e.widgetEventingReady)}if(e.onRoute!=null){g.onRoute.push(e.onRoute)}if(e.onPublish!=null){g.onPublish.push(e.onPublish)}if(e.onSubscribe!=null){g.onSubscribe.push(e.onSubscribe)}if(e.onUnsubscribe!=null){g.onUnsubscribe.push(e.onUnsubscribe)}if(e.getIframeId!=null){this.getIframeId=owfdojo.hitch(e.getIframeId.scope,e.getIframeId.fn)}if(e.getOpenedWidgets!=null){this.getOpenedWidgets=owfdojo.hitch(e.getOpenedWidgets.scope,e.getOpenedWidgets.fn)}gadgets.rpc.register("LIST_WIDGETS",this.getOpenedWidgets);Ozone.eventing.rpc.init({getIframeId:this.getIframeId});gadgets.rpc.register("container_init",function(i,j,k){Ozone.eventing.rpc.priv.clientToldUsFunctionsHandler(i,j,k);d(i,j)});gadgets.pubsubrouter.init(function(i){return i},{onRoute:function(l,n,p,o){var m=true;for(var k=0,j=g.onRoute.length;k<j;k++){m=m&&!(g.onRoute[k].fn.call(g.onRoute[k].scope,l,n,p,o)===false)}return !m},onPublish:function(l,o,n){var m=true;for(var k=0,j=g.onPublish.length;k<j;k++){m=m&&!(g.onPublish[k].fn.call(g.onPublish[k].scope,l,o,n)===false)}return !m},onSubscribe:function(l,n){var m=true;for(var k=0,j=g.onSubscribe.length;k<j;k++){m=m&&!(g.onSubscribe[k].fn.call(g.onSubscribe[k].scope,l,n)===false)}return !m},onUnsubscribe:function(l,n){var m=true;for(var k=0,j=g.onUnsubscribe.length;k<j;k++){m=m&&!(g.onUnsubscribe[k].fn.call(g.onUnsubscribe[k].scope,l,n)===false)}return !m}})},widgetEventingReady:function(i,h){g.widgetEventingReady.push({fn:i,scope:h})},onRoute:function(i,h){g.onRoute.push({fn:i,scope:h})},onPublish:function(i,h){g.onPublish.push({fn:i,scope:h})},onSubscribe:function(i,h){g.onSubscribe.push({fn:i,scope:h})},onUnsubscribe:function(i,h){g.onUnsubscribe.push({fn:i,scope:h})},addListener:function(j,i,h){if(g[j]!=null){g[j].push({fn:i,scope:h})}},removeListener:function(m,l,k){if(g[m]!=null){for(var j=0;j<g[m].length;j++){var h=g[m][j];if(h.fn==l&&h.scope==k){g[m].splice(j,1)}}}},clearListeners:function(h){if(g[h]!=null){g[h]=[]}},clearAllListeners:function(){g={widgetEventingReady:[],onRoute:[],onPublish:[],onSubscribe:[],onUnsubscribe:[]}},getIframeId:function(h){return f[h]},getOpenedWidgets:function(){return f.length!=null?f:0},getIframeProperties:function(p,u,o,t,j,s){p||(p=o.url);var v=Ozone.util.toString(this.generateIframeId(u));var k=this.generateIframeName(p,u,o,t,j,s);var i=Ozone.util.toString(k);var h=Ozone.util.HTMLEncodeReservedJS(v);var l=Ozone.util.HTMLEncodeReservedJS(i);var x=p.split("?");var q=Ozone.util.HTMLEncodeReservedJS(x[0]);var n="";if(x[1]){n="&"+x[1]}n=Ozone.util.HTMLEncodeReservedJS(n);var y='id = "'+h+'" name = "'+l+'" src= "'+q+"?lang="+Ozone.lang.getLanguage()+"&owf=true"+n;if(k.currentTheme){var m=Ozone.util.HTMLEncodeReservedJS(k.currentTheme.themeName);var r=Ozone.util.HTMLEncodeReservedJS(k.currentTheme.themeContrast);var w=k.currentTheme.themeFontSize;y+="&themeName="+m;y+="&themeContrast="+r;y+="&themeFontSize="+w}y+='" ';f[u]=v;f.length!=null?f.length++:f.length=0;return y},generateIframeName:function(i,h,m,l,k,n){var j={id:h,containerVersion:Ozone.version.owfversion,webContextPath:Ozone.config.webContextPath,preferenceLocation:Ozone.config.prefsLocation,relayUrl:this.getContainerRelay(),lang:Ozone.lang.getLanguage(),currentTheme:Ozone.config.currentTheme,owf:true,layout:l||"",url:i,guid:m.widgetGuid,version:m.version||1,locked:n||false};if(k){j.data=k}return j},generateIframeId:function(h){return{id:h}},getContainerRelay:function(){return this.containerRelay},setContainerRelay:function(i){if(i===c||i===""){throw"Ozone.eventing.Container.setContainerRelay was called with a null or empty string. Please provide a valid URL."}var j=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;var h=j.exec(i);if(h[1]===c||h[1]===null||h[1]===""){this.containerRelay=b.location.protocol+"//"+(b.location.host+"/"+i).replace(/\/{2,}/,"/")}else{this.containerRelay=b.location.protocol+"//"+(b.location.host+"/"+h[5]).replace(/\/{2,}/,"/")}},registerHandler:function(h,i){if(this.containerRelay===null){throw"A call was made to Ozone.eventing.Container.registerHandler before the container relay was set. Please call setContainerRelay before attempting to register any handlers."}gadgets.rpc.register(h,i)},send:function(){gadgets.rpc.call.apply(gadgets.rpc,arguments)},subscribe:function(h,i){gadgets.pubsubrouter.subscribe(h,i)},unsubscribe:function(h){gadgets.pubsubrouter.unsubscribe(h)},publish:function(h,j,i){gadgets.pubsubrouter.publish(h,j,i)}}}()}(window,document));